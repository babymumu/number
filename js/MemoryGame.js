!function(e){function t(t){for(var r,a,s=t[0],u=t[1],c=t[2],d=0,f=[];d<s.length;d++)a=s[d],o[a]&&f.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);for(l&&l(t);f.length;)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==o[u]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={19:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/js/";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var l=u;i.push([813,0]),n()}({0:function(e,t,n){var r=n(56),o=n(131);o.default&&(o=o.default);var i={ADD_ATTR:["target","autocorrect","marker"]},a=o();r.fn.extend({sanitizeHtml:function(e,t){return a.sanitize(e,t||i)},safeHtml:function(e,t){return null==e?this.html():this.html(this.sanitizeHtml(e,t))},safeAppend:function(e,t){return null==e?this.append(null):this.append(this.sanitizeHtml(e,t))},safeAttr:function(e,t){var n=this.get(0).tagName;return a.isValidAttribute(n,e,t)?this.attr(e,t):this},isSafeURLForNavigation:function(e){return a.isValidAttribute("a","href",e)}}),e.exports=r},10:function(e,t,n){"use strict";n.r(t);var r=n(16),o=n.n(r),i=n(14),a=n.n(i),s=n(17),u=n.n(s),c=n(38),l=n.n(c),d=n(60),f=n.n(d),p=n(19),g=n.n(p),h=n(2),m=n.n(h),v=n(68),b=n.n(v),w=n(9),y=n(62),D=n.n(y),C=n(26),E=n.n(C),A=function(){function e(t,n,r,o){this.message=t,this.expected=n,this.found=r,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,e)}return function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(e,Error),{SyntaxError:e,parse:function(t){var r,o=arguments.length>1?arguments[1]:{},i={},a={Expression:H},s=H,u=function(e){return e},c=function(e){return m()(e,function(e){return e[0]})},l="^",d={type:"literal",value:"^",description:'"^"'},f=function(){return{cmd:"^"}},p="_",g={type:"literal",value:"_",description:'"_"'},h=function(){return{cmd:"_"}},v="\\",b={type:"literal",value:"\\",description:'"\\\\"'},w=/^[A-Za-z]/,y={type:"class",value:"[A-Za-z]",description:"[A-Za-z]"},D=function(e){return{cmd:"\\"+e.join("")}},C=/^[\\ {}|'."~=\^`&#]/,E={type:"class",value:"[\\\\ {}|'.\"~=^`&#]",description:"[\\\\ {}|'.\"~=^`&#]"},A=function(e){return{cmd:"\\"+e}},_="{",S={type:"literal",value:"{",description:'"{"'},k="}",x={type:"literal",value:"}",description:'"}"'},O=function(e){return{grp:e}},I=/^[A-Za-z0-9\xC0-\u10FFFF.*\/+\-!=><&()[\]|\xB0,;:'\uFFFD"]/,T={type:"class",value:"[A-Za-z0-9\\u00c0-\\u10FFFF.*/+\\-!=><&()\\[\\]|°,;:' \"]",description:"[A-Za-z0-9\\u00c0-\\u10FFFF.*/+\\-!=><&()\\[\\]|°,;:' \"]"},F=function(e){return e},B=/^[ \t\n\r]/,P={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},N=0,L=[{line:1,column:1,seenCR:!1}],R=0,W=[],U=0;if("startRule"in o){if(!(o.startRule in a))throw new Error("Can't start parsing from rule \""+o.startRule+'".');s=a[o.startRule]}function M(e){var n,r,o=L[e];if(o)return o;for(n=e-1;!L[n];)n--;for(o={line:(o=L[n]).line,column:o.column,seenCR:o.seenCR};n<e;)"\n"===(r=t.charAt(n))?(o.seenCR||o.line++,o.column=1,o.seenCR=!1):"\r"===r||"\u2028"===r||"\u2029"===r?(o.line++,o.column=1,o.seenCR=!0):(o.column++,o.seenCR=!1),n++;return L[e]=o,o}function j(e,t){var n=M(e),r=M(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function q(e){N<R||(N>R&&(R=N,W=[]),W.push(e))}function z(t,n,r,o){return null!==n&&function(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}(n),new e(null!==t?t:function(e,t){var n,r=new Array(e.length);for(n=0;n<e.length;n++)r[n]=e[n].description;return"Expected "+(e.length>1?r.slice(0,-1).join(", ")+" or "+r[e.length-1]:r[0])+" but "+(t?'"'+function(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0100-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1000-\uFFFF]/g,function(e){return"\\u"+t(e)})}(t)+'"':"end of input")+" found."}(n,r),n,r,o)}function H(){var e,t,n,r;return e=N,(t=K())===i&&(t=null),t!==i&&(n=function(){var e,t,n,r;if(N,e=[],t=N,(n=V())!==i?((r=K())===i&&(r=null),r!==i?t=n=[n,r]:(N=t,t=i)):(N=t,t=i),t!==i)for(;t!==i;)e.push(t),t=N,(n=V())!==i?((r=K())===i&&(r=null),r!==i?t=n=[n,r]:(N=t,t=i)):(N=t,t=i);else e=i;return e!==i&&(e=c(e)),e}())!==i?((r=K())===i&&(r=null),r!==i?e=t=u(n):(N=e,e=i)):(N=e,e=i),e}function V(){var e,n;return(e=function(){var e,n,r,o;if(e=N,94===t.charCodeAt(N)?(n=l,N++):(n=i,0===U&&q(d)),n!==i&&(n=f()),(e=n)===i&&(e=N,95===t.charCodeAt(N)?(n=p,N++):(n=i,0===U&&q(g)),n!==i&&(n=h()),(e=n)===i)){if(e=N,92===t.charCodeAt(N)?(n=v,N++):(n=i,0===U&&q(b)),n!==i){if(r=[],w.test(t.charAt(N))?(o=t.charAt(N),N++):(o=i,0===U&&q(y)),o!==i)for(;o!==i;)r.push(o),w.test(t.charAt(N))?(o=t.charAt(N),N++):(o=i,0===U&&q(y));else r=i;r!==i?(n=D(r),e=n):(N=e,e=i)}else N=e,e=i;e===i&&(e=N,92===t.charCodeAt(N)?(n=v,N++):(n=i,0===U&&q(b)),n!==i?(C.test(t.charAt(N))?(r=t.charAt(N),N++):(r=i,0===U&&q(E)),r!==i?(n=A(r),e=n):(N=e,e=i)):(N=e,e=i))}return e}())===i&&(e=function(){var e,n,r,o;return e=N,123===t.charCodeAt(N)?(n=_,N++):(n=i,0===U&&q(S)),n!==i&&(r=H())!==i?(125===t.charCodeAt(N)?(o=k,N++):(o=i,0===U&&q(x)),o!==i?(n=O(r),e=n):(N=e,e=i)):(N=e,e=i),e}())===i&&(I.test(t.charAt(N))?(n=t.charAt(N),N++):(n=i,0===U&&q(T)),n!==i&&(n=F(n)),e=n),e}function K(){var e,n;if(e=[],B.test(t.charAt(N))?(n=t.charAt(N),N++):(n=i,0===U&&q(P)),n!==i)for(;n!==i;)e.push(n),B.test(t.charAt(N))?(n=t.charAt(N),N++):(n=i,0===U&&q(P));else e=i;return e}if(window._=n(15),(r=s())!==i&&N===t.length)return r;throw r!==i&&N<t.length&&q({type:"end",description:"end of input"}),z(null,W,R<t.length?t.charAt(R):null,R<t.length?j(R,R+1):j(R,R))}}}().parse;function _(e){return e.hasOwnProperty("grp")}function S(e){return e.hasOwnProperty("cmd")}function k(e,t){return E()(t)?e===t:!(!_(t)||1!==t.grp.length)&&k(e,t.grp[0])}function x(e,t){return S(t)?e.cmd===t.cmd&&I(e.opt,t.opt)&&I(e.params,t.params):!(!_(t)||1!==t.grp.length)&&x(e,t.grp[0])}function O(e,t){return E()(e)?k(e,t):E()(t)?k(t,e):S(e)?x(e,t):S(t)?x(t,e):_(e)?_(t)&&I(e.grp,t.grp):(console.error("Unknown latex node type",e),!1)}function I(e,t){if(null==e)return null==t;if(null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!1===O(e[n],t[n]))return!1;return!0}var T=["\\left","\\right","\\limits"],F={"\\leq":function(){return{cmd:"\\le"}},"\\geq":function(){return{cmd:"\\ge"}},"\\neq":function(){return{cmd:"\\ne"}},"\\vee":function(){return{cmd:"\\lor"}},"\\wedge":function(){return{cmd:"\\land"}},"\\":function(){return{cmd:"\\ne"}},"\\overrightarrow":function(){return{cmd:"\\vec"}},"\\dfrac":function(){return{cmd:"\\frac"}},"\\notin":function(){return[{cmd:"\\not"},{cmd:"\\in"}]}},B={" ":function(){return[{cmd:"^"},{cmd:"\\circ"}]},"°":function(){return[{cmd:"^"},{cmd:"\\circ"}]},'"':function(){return["'","'"]}};var P={"\\frac":2,"\\sum":2,"\\prod":2,"\\coprod":2,"\\int":2,"\\sqrt":1,"^":1,_:1,"\\bar":1,"\\dot":1,"\\hat":1,"\\tilde":1,"\\vec":1,"\\begin":1,"\\end":1};function N(e){var t=0;return u()(m()(e,function(e){return S(e)?("\\begin"===e.cmd?++t:"\\end"===e.cmd&&--t,function(e){var t={cmd:e.cmd};e.opt&&(t.opt=N(e.opt));e.params&&(t.params=m()(e.params,L));return t}(e)):_(e)?0===t?N(e.grp):L(e):e}))}function L(e){return _(e)?{grp:N(e.grp)}:e}function R(e){return N(function e(t){if(null==t)return null;for(var n=[],r=0;r<t.length;++r){var o=t[r];if(E()(o))n.push(o);else if(S(o)){if("\\sqrt"===o.cmd&&r<t.length-2&&"["===t[r+1]){for(var i=[],a=r+2;a<t.length&&"]"!==t[a];)i.push(t[a++]);"]"===t[a]&&(o.opt=e(i),r=a)}var s=P[o.cmd]||0,u=Math.min(s,t.length-r-1);if(u>0){for(var c=[],l=0;l<u;++l)c.push(t[++r]);o.params=e(c)}n.push(o)}else _(o)?n.push({grp:e(o.grp)}):(console.error("mapCommandParams simply copies",o),n.push(o))}return n}(function(e){return u()(m()(e,function(e){if(E()(e))return B.hasOwnProperty(e)?B[e]():e;if(S(e))return-1!==l()(T,e.cmd)?[]:F.hasOwnProperty(e.cmd)?F[e.cmd]():e;if(_(e)){var t=R(e.grp);return 0===t.length?[]:{grp:t}}return e}))}(e)))}var W=n(6),U=n(27);function M(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function j(e){return e?parseFloat(e.replace(",",".")):0}function q(e,t){return null==t?e:e instanceof Array?function(e,t,n){for(var r=e.length,o=[],i=0;i<r;i++)o[i]=n(e[i],t[i]);return o}(e,t,function(e,t){return null!=t?t:e}):t}function z(e){return"no"===e.needs_correction?0:j(e["scoring-weight"])}function H(e){var t=z(e);if(!e.hasOwnProperty("scoring-wrong-answer-weight")||""===e["scoring-wrong-answer-weight"])return t;var n=j(e["scoring-wrong-answer-weight"]);return isNaN(n)?t:n}function V(e,t,n){r=null===t?-1:parseInt(t)===parseInt(e.Valid)?1:0;var r,o=z(e),i=r;return{correctness:r=q(i,n),autoCorrectness:i,score:1===r?o:0,outof:o}}function K(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1}function J(e,t){for(var n=0,r=0;r<e.length;++r)e[r]===t&&++n;return n}function Y(e,t,n){return"each"===t?J(e,1)*n:J(e,1)===e.length?n:0}function Q(e,t,n){return"each"===t?e.length*n:n}function G(e,t,n,r,o,i){if(i){for(var a=0,s=0;s<e.length;++s)e[s]&&1===t[s]&&++a;return a*r}if("each"===n){a=0;var u=0;for(s=0;s<e.length;++s)e[s]&&1===t[s]?++a:e[s]||0!==t[s]||++u;return Math.max(a*r-u*o,0)}return"eachcorrect"===n?J(t,1)*r:J(t,1)===t.length?r:0}function $(e,t,n,r,o){return o?J(e,!0)*r:"each"===n?J(e,!0)*r:"eachcorrect"===n?e.length*r:r}function X(e,t,n){for(var r,o=e.policy,i="yes"===e.limited_selection,a=e.Answers||[],s=K(t=t||g()(Array(a.length),!1),!0)||"eachcorrect"===o,u=e.hasOwnProperty("Valid")?(r=e.Valid,r.replace(/\D/g," ")).split(/\s+/):"",c=[],l=0;l<u.length;++l)c.push(parseInt(u[l],10));var d=[];for(l=0;l<a.length;++l)d.push(K(u,l+1+""));var f=[];for(l=0;l<a.length;++l)s?!K(u,l+1+"")^!t[l]?f.push(0):f.push(1):f.push(-1);var p=z(e),h=f;return{correctness:f=q(h,n),autoCorrectness:h,correctAnswers:c,score:G(d,f,o,p,H(e),i),outof:$(d,0,o,p,i)}}function Z(e){var t,n,r=Object(W.trimAll)(e.split(":"));r.length>=2?0===(t=r[0]).indexOf("text")||0===t.indexOf("select")?(r.shift(),n=r.join(":")):(t="text",n=e):r.length<2&&(t="text",n=e);var o=t.match(/(.+)\((.*)\)/),i=[],a=[];if(o&&3===o.length){t=o[1].trim(),i=Object(W.trimAll)(o[2].split(";")).map(function(e){return Object(W.trimAll)(e.split("="))});for(var s=0;s<i.length;++s){var u=i[s];"width"===u[0]?a.push(u.join(":")):console.error("FIT: Ignoring unsupported parameter "+u[0])}}return{type:t,typeconfig:n,style:a}}function ee(e,t,n){for(var r,o=0,i=e.indexOf("&lt;&lt;"),a="",s=0;i>=0;){var u=e.substring(o,i),c=e.indexOf("&gt;&gt;",i);if(c<0){o=e.length;break}a+=null!=(r=t(u,n(e.substring(i+8,c)),s))?u+r:e.substring(o,c+8),o=c+8,i=e.indexOf("&lt;&lt;",c),s+=1}return a+=null!=(r=t(e.substring(o),null,s))?r:e.substring(o)}function te(e,t){return ee(e,t,Z)}function ne(e){return"undefined"!=typeof window&&window.$?window.$(document.createElement("div")).html(e).text():n(75).default(e)}function re(e){return!e.hasOwnProperty("Sentence")||null==e.Sentence||""===e.Sentence.trim()}function oe(e){return re(e)?e.Question||"":e.Sentence||""}function ie(e,t){return ee(e,t,function(e){return e})}function ae(e,t){return ee(e,t,function(e){return e})}function se(e){var t=f()(e);return"Image"===e.Type?(delete t.image.sources,delete t.image.alttext):"Audio"===e.Type&&(t.audio=function(e){var t=e.lastIndexOf("/");if(-1===t)return e;var n=e.lastIndexOf("/",t-1);return-1===n?e.substr(t):e.substr(n)}(e.audio)),t}function ue(e){return JSON.stringify(m()(e,function(e){return b()(se(e))}).sort())}function ce(e,t,n){for(var r="",o=0;o<e.length;++o){var i=e.charAt(o);/[\s]/.test(i)||/[~`!#$%^&*+=\-[\]\\;,./{}()|\\":<>?]/.test(i)?(r.length>0&&(t(r),r=""),n(i)):r+=i}r.length>0&&t(r)}function le(e,t,n){for(var r=0,o=e.indexOf("<<");o>=0;){t(e.substring(r,o));var i=e.indexOf(">>",o);if(i<0){r=e.length;break}n(e.substring(o+2,i)),r=i+2,o=e.indexOf("<<",i)}t(e.substring(r))}function de(e,t,n,r){le(e,function(e){ce(e,n,t)},function(e){var t=Object(W.trimAll)(e.split(":"));1!==t.length?""!==t[0]?""!==t[1]?r({type:t[0],word:t[1]}):n(t[0]):n(t[1]):n(t[0])})}function fe(e){var t=e.hasOwnProperty("filename")?e.filename:e;return e.hasOwnProperty("origbase")?e.origbase:t}function pe(e){return e}function ge(e,t){return null==e||""===e?"":t+""}function he(e){return J(e.correctness,1)===e.correctness.length}function me(e){return null==e||""===e}function ve(e,t,n,r,o){t=t||[];for(var i=[],a=e.pairs?e.pairs:[],s=0;s<a.length;++s){var u=a[s],c=n(u.source,s);if(!me(c)){for(var l=r(u.target),d=!1,f=0;f<t.length;++f)if(t[f].source===c){t[f].target===l?i.push(1):i.push(0),d=!0;break}d||(me(l)?i.push(2):i.push(-1))}}var p=J(i,1)>0||J(i,0)>0?1:-1;for(s=0;s<i.length;++s)2===i[s]&&(i[s]=p);var g=z(e),h=i;return{correctness:i=q(h,o),autoCorrectness:h,score:J(i,1)*g,outof:i.length*g}}function be(e){return e.hasOwnProperty("name")?e.name:e}function we(e,t,n,r){t=t||[];for(var o=z(e),i=[],a=e.Boxes?e.Boxes:[],s=0;s<a.length;++s){var u=a[s],c=ne(u.name);if(u.Items)for(var l=0;l<u.Items.length;++l){var d=n(u.Items[l]);i.push({pair:[d,c],correct:!1,answer:null})}}var f=[];for(s=0;s<t.length;++s)f.push({pair:t[s],used:!1});for(s=0;s<i.length;++s){var p=i[s];for(l=0;l<f.length;++l){if(!(g=f[l]).used&&(be(p.pair[0])===be(g.pair[0])&&p.pair[1]===g.pair[1])){p.correct=!0,p.answer=g.pair[1],g.used=!0;break}}}for(s=0;s<i.length;++s){if(!(p=i[s]).correct)for(l=0;l<f.length;++l){var g;if(!(g=f[l]).used&&be(p.pair[0])===be(g.pair[0])){p.answer=g.pair[1],g.used=!0;break}}}var h=!1;for(s=0;s<i.length;++s){if(null!==(p=i[s]).answer){h=!0;break}}if(h)for(s=0;s<i.length;++s){null===(p=i[s]).answer&&""===p.pair[1]&&(p.correct=!0,p.answer="")}var m=[];for(s=0;s<i.length;++s){(p=i[s]).correct?m.push(1):null===p.answer?m.push(-1):m.push(0)}var v=e.policy,b=(o=z(e),m);return{correctness:m=q(b,r),autoCorrectness:b,items:i,score:Y(m,v,o),outof:Q(m,v,o)}}function ye(e,t,n){var r=z(e),o=t?-2:-1;return{correctness:q(o,n),autoCorrectness:o,score:0,outof:r}}function De(e){var t=/^ *(-?[0-9.,]+([eE]-?[0-9]+)?) *(E|P|T|G|M|k|h|da|d|c|m|u|n|p|f|a)?([^\d]+) *$/.exec(e.trim());if(null===t)return null;var n,r=t[3];switch(r){case void 0:n=0;break;case"E":n=18;break;case"P":n=15;break;case"T":n=12;break;case"G":n=9;break;case"M":n=6;break;case"k":n=3;break;case"h":n=2;break;case"da":n=1;break;case"d":n=-1;break;case"c":n=-2;break;case"m":n=-3;break;case"u":n=-6;break;case"n":n=-9;break;case"p":n=-12;break;case"f":n=-15;break;case"a":n=-18}return{value:t[1],prefix:r,scale:n,unit:null!=t[3]&&t[3].normalize?t[4].normalize("NFKC"):t[4]}}function Ce(e){if(null==e)return null;for(var t=e.length,n=1,r=0;r<t;++r){var o=e[r].split(" ");n=Math.max(n,o.length)}return{rows:t,columns:n}}function Ee(e,t){for(var n=[],r=0;r<e.length;++r){for(var o=0;o<e[r].length;++o){var i=e[r][o];null==i||""===i.trim()?n.push("{}"):n.push(i.trim()),o!==e[r].length-1&&n.push("&")}r!==e.length-1&&n.push("\\\\")}return"$$\\leftLEFT \\begin{array} {cc} VALUES \\end{array} \\rightRIGHT$$".replace("LEFT","parentheses"===t?"(":"[").replace("RIGHT","parentheses"===t?")":"]").replace("VALUES",n.join(" "))}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"parentheses",n=Ce(e.matrix);if(null==n)return null;for(var r=[],o=0;o<n.rows;++o){for(var i=[],a=e.matrix[o].split(" "),s=0;s<n.columns;++s)i.push(a[s]);r.push(i)}return Ee(r,t)}function _e(e,t,n){var r,o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"parentheses",a=n.answer_style;if("Single"===a)r=t?"":e.single,o="$$"+(n.unit&&""!==n.unit?n.single_number+n.unit:n.single_number)+"$$";else if("Fraction"===a)r=t?"":"$$\\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$\\frac{"+n.numerator+"}{"+n.denominator+"}$$";else if("Mixed"===a)r=t?"":"$$"+e.wholenumber+" \\frac {"+e.numerator+"}{"+e.denominator+"}$$",o="$$"+n.whole_number+" \\frac {"+n.numerator+"}{"+n.denominator+"}$$";else if("Exponential"===a)r=t?"":"$$ {"+e.base+"} ^ {"+e.exponent+"}$$",o="$$ {"+n.base+"} ^ {"+n.exponent+"}$$";else if("Matrix"===a){var s=[],u=Ce(n.matrix);if(null!=u){for(var c=0;c<u.rows;++c){for(var l=[],d=0;d<u.columns;++d)l.push(e["c_"+c+"_"+d]);s.push(l)}r=t?"":Ee(s,i),o=Ae(n,i)}}return{answer:r,canonicalAnswer:o}}function Se(e,t,n,r,o){function i(e){t?o(e,e,!1):r(e,e)}le(function(e){for(var t=[],n=e.split("<br>"),r=0;r<n.length;++r)t.push(ne(n[r]));return t.join("\n")}(e),function(e){return ce(e,i,n)},function(e){var t=e.split("/");2===t.length?o(t[0],t[1],!0):o(e,e,!0)})}n.d(t,"toFloat",function(){return j}),n.d(t,"getWrongAnswerWeight",function(){return H}),n.d(t,"arrayCount",function(){return J}),n.d(t,"scoreForValidPolicyAndWeight",function(){return G}),n.d(t,"processFillInText",function(){return te}),n.d(t,"isLegacyFITStyle",function(){return re}),n.d(t,"getFITText",function(){return oe}),n.d(t,"processDragWordsInSentence",function(){return ie}),n.d(t,"processEquations",function(){return ae}),n.d(t,"cleanGroupElemPaths",function(){return se}),n.d(t,"processText",function(){return ce}),n.d(t,"processMarkSentence",function(){return de}),n.d(t,"pictureId",function(){return fe}),n.d(t,"wordId",function(){return pe}),n.d(t,"audioId",function(){return ge}),n.d(t,"allCorrect",function(){return he}),n.d(t,"dragDropKey",function(){return be}),n.d(t,"splitNumberAndMetric",function(){return De}),n.d(t,"getMatrixDimensions",function(){return Ce}),n.d(t,"canonicalMatrix",function(){return Ae}),n.d(t,"createNumericQuestionAnswer",function(){return _e}),n.d(t,"processCorrectSentence",function(){return Se}),n.d(t,"check",function(){return ke}),n.d(t,"linkifyLinks",function(){return xe}),n.d(t,"isNotAutoCorrectingQuestionType",function(){return Oe});var ke={TextDescription:function(){return{}},TextMultpleChoice:V,RatedMultipleChoice:function(e,t){for(var n=0,r=e.Answers?e.Answers:[],o=0;o<r.length;++o)j(r[o].value)>n&&(n=j(r[o].value));if(null===t)return{correctness:-1,autoCorrectness:-1,score:0,outof:n};var i=j(r[t].value);return{correctness:i===n?1:0,autoCorrectness:0===i?0:1,score:i,outof:n}},TextMultiSelect:X,QuestionTable:function(e,t,n){var r=e.rows||[];function o(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[1].trim():null}function i(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[0]:n}t=t||g()(Array(r.length),!1);for(var a={},s=e.columns?e.columns:[],u=0;u<s.length;++u)a[s[u].trim()]=u;for(var c=[],l=[],d=[],f=0;f<t.length;++f){var p=parseInt(t[f]),h=o(e,f);d.push(i(e,f)),null!=a[h]?l.push(a[h]):l.push(null),isNaN(p)?c.push(-1):null!==h&&a.hasOwnProperty(h)?a[h]===p?c.push(1):c.push(0):c.push(-2)}var m=z(e),v=c;return{correctness:c=q(v,n),autoCorrectness:v,score:J(c,1)*m,outof:c.length*m,correctAnswers:l,questions:d}},MultiSelectQuestionTable:function(e,t,n){var r=e.rows||[];t=t||g()(Array(r.length),!1);for(var o="yes"===e.limited_selection,i={},s=e.columns?e.columns:[],c=0;c<s.length;++c)i[s[c].trim()]=c;var l=[],d=[],f=[];a()(t,function(t,n){var r=function(e,t){for(var n=function(e,t){return e.rows[t].split(/##/)}(e,t),r=g()(Array(s.length),!1),o=1;o<n.length;++o){var a=n[o].trim();i.hasOwnProperty(a)&&(r[i[a]]=!0)}return r}(e,n);f.push(function(e,t){var n=e.rows[t].split(/##/);return n.length>1?n[0]:n}(e,n)),d.push(r),l.push(m()(t,function(e,t){return 1===e===r[t]?1:0}))});var p=z(e),h=0,v=0;if(o){var b=u()(d),w=u()(l),y=0;a()(b,function(e,t){e&&(v+=p),e&&1===w[t]&&(y+=1)}),h=y*p}else if("each"===e.policy){var D=H(e),C=u()(d),E=u()(l),A=0,_=0;a()(C,function(e,t){e&&(v+=p),e&&1===E[t]?A+=1:e||0!==E[t]||(_+=1)}),h=Math.max(0,A*p-_*D)}else a()(l,function(e){J(e,1)===e.length&&(h+=p)}),v=l.length*p;var S=l;return{correctness:l=q(S,n),autoCorrectness:S,score:h,outof:v,correctAnswers:d,questions:f}},PictureMultpleChoice:V,PictureMultiSelect:X,MultiLine:function(e,t,n){var r=z(e);if(t=t||"",!e.hasOwnProperty("Keywords")||0===e.Keywords.length)return{correctness:u=q(s=""===t?-1:-2,n),autoCorrectness:s,score:1===u?r:0,outof:r,keywords:[]};var i=e.Keywords,a=e["case-sensitive"];t=Object(W.prepareForCompare)(t,a),t=Object(W.replaceBadQuotes)(t);for(var s,u,c=0,l=0,d=0,f=0,p=[],g=0;g<i.length;++g){for(var h=o()(Object(W.trimAll)(i[g].split(/##/)),function(e){return""!==e}),m=[],v=h.length>1&&!1===isNaN(h[h.length-1]),b=0;b<(v?h.length-1:h.length);++b)m[b]=Object(W.prepareForCompare)(h[b],a);var w,y=function(e,t,n,r){for(var o=0;o<r;++o)if(-1!==e.indexOf(Object(W.replaceBadQuotes)(n[o])))return t[o];return null};v?(++c,null!=(w=y(t,h,m,h.length-1))?(l+=j(h[h.length-1]),++f,p.push({keyword:w,match:!0,points:h[h.length-1]})):p.push({keyword:h[0],match:!1})):(++d,null!=(w=y(t,h,m,h.length))?(++f,p.push({keyword:w,match:!0})):p.push({keyword:h[0],match:!1}))}return c>0&&d>0&&console.error("Info: multiline question with keywords with and without points, keywords without points don't contribute to score."),""===t?{correctness:u=q(s=-1,n),autoCorrectness:s,score:0,outof:r,keywords:p}:c>0?l>=r?{correctness:u=q(s=1,n),autoCorrectness:s,score:r,outof:r,keywords:p}:{correctness:u=q(s=0,n),autoCorrectness:s,score:l,outof:r,keywords:p}:f===i.length?{correctness:u=q(s=1,n),autoCorrectness:s,score:r,outof:r,keywords:p}:{correctness:u=q(s=0,n),autoCorrectness:s,score:l,outof:r,keywords:p}},RichText:function(e,t,n){var r=z(e),o=null!=t&&""!==t?-2:-1;return{correctness:q(o,n),autoCorrectness:o,score:0,outof:r}},ExtraMultiLine:function(){return null},ExtraCheckbox:function(){return null},FillInText:function(e,t,n){t=t||[];var r=e["case-sensitive"];function o(e,t){return"text"===e.type?function(e,t){if(""===t)return-1;var n=ne(e.typeconfig);return""===n?-2:Object(W.matchesOneOfAnswers)(t,n,r)?1:0}(e,t):"select"===e.type?function(e,t){return null==t||"-"===t?-1:""!==t||function(e){for(var t=e.split(/##/,1),n=0;n<t.length;++n)if(""===t[n])return!0;return!1}(e.typeconfig)?t===ne((n=e.typeconfig,(r=n.split(/##/,1)).length>0?r[0].trim():""))?1:0:-1;var n,r}(e,t):null}var i=0,a=[];te(oe(e),function(e,n){if(null!==n)if(i<t.length){var r=o(n,t[i++].trim());null!==r&&a.push(r)}else t.length>0&&console.error("Error: FIT has more input fields than answers"),a.push(-1)});var s=z(e),u=a,c=(a=q(u,n),e.policy||"each");return{correctness:a,autoCorrectness:u,score:Y(a,c,s),outof:Q(a,c,s)}},FillInTable:function(e,t,n){function r(e,n){for(var r=0;r<t.length;++r){var o=t[r];if(o.row===e&&o.column===n)return o.value.trim()}return null}t=t||[];for(var o=e["case-sensitive"],i=e.tabledata,a=[],s=[],u=i&&i.values?i.values:[],c=0;c<u.length;++c)for(var l=u[c],d=0;d<l.length;++d){var f=l[d];if(f.hasOwnProperty("CellRole"))if("input"===f.CellRole)null===(p=r(c,d))||""===p?(a.push(-1),s.push({row:c,column:d,answer:"",correctness:-1})):(a.push(-2),s.push({row:c,column:d,answer:p,correctness:-2}));else if("checked"===f.CellRole){var p=r(c,d),g=f.value;if(""===p&&""===g){a.push(1),s.push({row:c,column:d,answer:"",correctness:1});continue}if(null===p||""===p){a.push(-1);var h={row:c,column:d,answer:"",correctness:-1};""!==g&&(h.correct=g),s.push(h);continue}if(""===f.value){a.push(-2),s.push({row:c,column:d,answer:p,correctness:-2});continue}Object(W.matchesOneOfAnswers)(p,f.value,o)?(a.push(1),s.push({row:c,column:d,answer:p,correct:g,correctness:1})):(a.push(0),s.push({row:c,column:d,answer:p,correct:g,correctness:0}))}}var m=z(e),v=a;a=q(v,n);var b=e.policy||"each";return{correctness:a,autoCorrectness:v,correctioninfo:s,score:Y(a,b,m),outof:Q(a,b,m)}},AnnotatePicture:function(e,t,n){t=t||[];for(var r=[],o=e["case-sensitive"],i=e.EditFields?e.EditFields:[],a=0;a<i.length;++a){var s=i[a],u=a<t.length?t[a].trim():"";""===u?r.push(-1):s.Valid&&""!==s.Valid?Object(W.matchesOneOfAnswers)(u,s.Valid,o)?r.push(1):r.push(0):r.push(-2)}var c=z(e),l=r,d=(r=q(l,n),e.policy||"each");return{correctness:r,autoCorrectness:l,score:Y(r,d,c),outof:Q(r,d,c)}},SingleLine:function(e,t,n){t=(t=t||"").trim();var r,o=z(e);if(""===t)r=-1;else{var i=e.Valid;if(""===i)r=-2;else{var a=e["case-sensitive"];r=Object(W.matchesOneOfAnswers)(t,i,a)?1:0}}var s=q(r,n);return{correctness:s,autoCorrectness:r,score:1===s?o:0,outof:o}},PictureOrdering:function(e,t,n){var r=e.Pictures||[];t=t||g()(Array(r.length),null);for(var o=z(e),i=[],a=0;a<r.length;++a)a>=t.length||null===t[a]?i.push(-1):t[a]===fe(r[a])?i.push(1):i.push(0);var s=i,u=(i=q(s,n),e.policy);return{correctness:i,autoCorrectness:s,score:Y(i,u,o),outof:Q(i,u,o)}},WordOrdering:function(e,t,n){var r=e.Words||[],o=z(e);if("each"===e.policy){for(var i=[],a=0;a<r.length;++a)null===t?i.push(-1):t[a]===r[a]?i.push(1):i.push(0);return{correctness:i=q(s=i,n),autoCorrectness:s,score:J(i,1)*o,outof:i.length*o}}if(null===t)return{correctness:i=q(s=-1,n),autoCorrectness:s,score:0,outof:o};var s,u="Sentences"===e.order_type?"\n":" ",c=r.join(u),l=t?t.join(u):"",d=!1;if(l===c)d=!0;else if(e.AlternateAnswers){l=t.join(" ");var f=e.AlternateAnswers;for(a=0;a<f.length;++a)l.replace(/ /g,"")===f[a].replace(/ /g,"")&&(d=!0)}return{correctness:i=q(s=i=d?1:0,n),autoCorrectness:s,score:i*o,outof:o}},Match:ve,WordMatch:function(e,t,n){return ve(e,t,pe,pe,n)},WordPictureMatch:function(e,t,n){return ve(e,t,pe,fe,n)},AudioWordMatch:function(e,t,n){return ve(e,t,ge,pe,n)},AudioPictureMatch:function(e,t,n){return ve(e,t,ge,fe,n)},PicturePictureMatch:function(e,t,n){return ve(e,t,fe,fe,n)},DragDrop:we,TextDragDrop:function(e,t,n){return we(e,t,pe,n)},PictureDragDrop:function(e,t,n){return we(e,t,fe,n)},Whiteboard:ye,Photo:ye,AudioRecording:ye,Numeric:function(e,t,n){var r=e.answer_style;if("Single"===r){var o=(t=t||{single:""}).single;if(""===o)v=-1;else if(null!=(m=e.single_number)&&(m=m.trim()),""===m)v=-2;else if(isNaN(m)&&isNaN(m.replace(",",".")))v=function(e,t,n){try{if(void 0!==n&&""!==n){var r=De("0"+n);if(null!==r){if(null===(o=De(t)))return!1;if(o.unit!==r.unit)return!1;t=o.value*Math.pow(10,o.scale-r.scale)}}else{var o;if(null!==(o=De(t)))return!1}return e=(e=(e=(e=e.replace(/NOT/g,"!")).replace(/AND/g,"&&")).replace(/OR/g,"||")).replace(/X/g,t),!0===D()({},e)}catch(n){return console.log("Problem calculating expression, returning false",e,t),!1}}(m,o.replace(",","."),e.unit)?1:0;else if(void 0===e.unit||""===e.unit)v=null===(i=De(o))&&j(o)===j(m)?1:0;else{var i=De(o),a=De("0"+e.unit);v=null===i||null===a||i.unit!==a.unit||j(o)*Math.pow(10,i.scale-a.scale)!==j(m)?0:1}}else{var s=[],u=[];if("Fraction"===r)t=t||{numeragor:"",denominator:""},s.push(t.numerator),s.push(t.denominator),u.push(e.numerator),u.push(e.denominator);else if("Mixed"===r)t=t||{wholenumber:"",numeragor:"",denominator:""},s.push(t.wholenumber),s.push(t.numerator),s.push(t.denominator),u.push(e.whole_number),u.push(e.numerator),u.push(e.denominator);else if("Exponential"===r)t=t||{base:"",exponent:""},s.push(t.base),s.push(t.exponent),u.push(e.base),u.push(e.exponent);else{if("Matrix"!==r)return console.error("Wrong type for Numeric question type: ",r),null;t=t||{};var c=Ce(e.matrix);if(null!=c)for(var l=0;l<c.rows;++l)for(var d=e.matrix[l].trim().split(" "),f=0;f<c.columns;++f)s.push(t["c_"+l+"_"+f]),u.push(d[f])}var p=!0,g=!0,h=!1;for(l=0;l<s.length;++l){var m;""!==s[l]&&(p=!1),null!=(m=u[l])&&(m=m.trim()),""===m&&(h=!0),m!==s[l]&&(g=!1)}v=p?-1:h?-2:g?1:0}var v,b=z(e),w=v;return{correctness:v=q(w,n),autoCorrectness:w,score:1===v?b:0,outof:b}},BalanceChemicalEquation:function(e,t,n){var r=e.Equation||"",i=w.parseEquation(r),a=w.reduceReactantsAndProducts(i);t=t||("type3"===e.SubType?[]:{balanced:"",reactantsTable:"type1"===e.SubType?[]:o()(m()(a.reactants,function(e,t){return{row:t,value:""}}),function(e,t){return t%2==1}),productsTable:"type1"===e.SubType?m()(a.products,function(e,t){return{row:t,value:""}}):o()(m()(a.products,function(e,t){return{row:t,value:""}}),function(e,t){return t%2==0})});var s=[];function u(e,t){for(var n=0;n<e.length;++n){var r=e[n];""===r.value?s.push(-1):s.push(parseInt(r.value)===t[r.row].qty?1:0)}}switch(e.SubType){case"type1":case"type2":""===t.balanced?s.push(-1):w.isBalanced(r)===("yes"===t.balanced)?s.push(1):s.push(0),u(t.reactantsTable,a.reactants),u(t.productsTable,a.products);break;case"type3":for(var c=i.reactants.concat(i.products),l=0;l<c.length;++l)l<t.length?s.push(c[l].qty===parseInt(t[l])?1:0):s.push(-1)}var d=z(e),f=s;return{correctness:s=q(f,n),autoCorrectness:f,score:J(s,1)*d,outof:s.length*d}},IonicCompoundBuilder:function(e,t,n){t=t||{posIons:[],negIons:[]};var r=w.parseFormula(e.Valid||""),o=t.posIons.concat(t.negIons),i=w.joinIonsToFormula(o),a=w.totalCharge(o);s=0===i.length?-1:0!==a?0:w.equalFormulas(i,r)?1:0;var s,u=z(e),c=s;return{correctness:s=q(c,n),autoCorrectness:c,score:1===s?u:0,outof:u}},CorrectSentence:function(e,t,n){t=t||[];var r=[],o=[],i=[],a=e["case-sensitive"],s="each"===e.policy,u="yes"===e["all-words-editable"],c=0;Se(e.Sentence||"",u,function(){},function(){},function(e,n,u){var l=c<t.length?t[c++]:"";s?(i.push(1),r.push(l),Object(W.matchesOneOfAnswers)(l,n,a)?o.push(1):l===e?o.push(-1):o.push(0)):(i.push(u?1:-1),r.push(l),Object(W.matchesOneOfAnswers)(l,n,a)?o.push(1):u?o.push(l===e?-1:0):o.push(0))});var l=z(e),d=H(e),f=o,p=(o=q(f,n),J(i,1)),g=0,h=0;for(c=0;c<i.length;++c)1===i[c]?1===o[c]&&++g:1!==o[c]&&++h;var m=Math.max(g*l-h*d,0);return{correctness:o,autoCorrectness:f,score:m,answers:r,outof:p*l}},DragWordsInSentence:function(e,t,n){t=t||[];var r=0,o=[];ie(e.Sentence||"",function(e,n){if(null!==n)if(r<t.length){var i=function(e,t){return""===t?-1:t.trim()===e.trim()?1:0}(n,t[r++].trim());null!==i&&o.push(i)}else o.push(-1),t.length>0&&console.error("Error: DWIS has more input fields than answers")});var i=z(e),a=o;return{correctness:o=q(a,n),autoCorrectness:a,score:J(o,1)*i,outof:o.length*i}},Equations:function(e,t,n){function r(e,t){return""===(t=t.trim())?-1:""===(e=e.trim())?-2:-1===e.split("##").map(function(e){return(e=e.trim()).startsWith("$$")&&(e=e.substring(2)),e.endsWith("$$")&&(e=e.substring(0,e.length-2)),function(e,t){var n,r;try{n=A(e)}catch(e){n=null}try{r=A(t)}catch(e){r=null}return null==n?null==r&&e===t:null!=r&&I(R(n),R(r))}(t,e.trim())?1:0}).indexOf(1)?0:1}t=t||[];var o=0,i=[];ae(e.Sentence||"",function(e,n){if(null!==n)if(o<t.length){var a=t[o++].trim(),s=r(ne(n),a);null!==s&&i.push(s)}else i.push(-1),t.length>0&&console.error("Error: EQ has more input fields than answers")});var a=z(e),s=i,u=(i=q(s,n),e.policy||"each");return{correctness:i,autoCorrectness:s,score:Y(i,u,a),outof:Q(i,u,a)}},Group:function(e,t,n){t=t||[];var r=[],o=[],i=e.groups||[];if(Math.max.apply(0,m()(t,function(e){return e.length}))<=1)r=g()(Array(i.length),-1),o=g()(Array(t.length),-1);else{var a=m()(i,function(e){return ue(e.elements||[])}),s=m()(t,function(e){return ue(e)});r=m()(a,function(e){return-1===s.indexOf(e)?0:1}),o=m()(s,function(e){return-1===a.indexOf(e)?0:1})}var u=q(r,n),c=z(e);return{correctness:u,autoCorrectness:r,score:J(u,1)*c,outof:u.length*c,answerCorrectness:o}},MarkSentence:function(e,t,n){var r=[],o=[],i=0,a=J(t=t||[],"")===t.length;de(e.Sentence||"",function(){},function(){a?(r.push(-1),o.push(-1)):""===t[i]?(r.push(1),o.push(1)):(r.push(0),o.push(0)),++i},function(n){if("yes"===e.mark_individual_words){var s=!0;ce(n.word,function(){a?o.push(-1):t[i]===n.type?o.push(1):(o.push(0),s=!1),++i},function(){}),a?r.push(-1):s?r.push(1):r.push(0)}else a?(r.push(-1),o.push(-1)):t[i]===n.type?(r.push(1),o.push(1)):(r.push(0),o.push(0)),++i});var s=r;r=q(s,n);var u=0,c=0,l=0,d=null;i=0,de(e.Sentence||"",function(){},function(){0===r[i]&&d!==t[i]?(++u,d=t[i]):d="",++i},function(){++l,1===r[i]?(++c,d=""):0===r[i]&&(d=t[i]),++i});var f=z(e),p=H(e);return{correctness:r,autoCorrectness:s,wordcorrectness:o,score:Math.max(0,c*f-u*p),outof:f*l}},CrossWord:function(e,t,n){t=t||[];var r=[],o=e["case-sensitive"],i=e.words,a=Object(U.k)([],t),s=[];if(i&&i.length>0)for(var u=0;u<i.length;u++){var c=i[u],l=Object(U.f)(a,c);s.push(l),0===l.replace(" ","").length?r.push(-1):Object(W.matchesOneOfAnswers)(c.word,l,o)?r.push(1):r.push(0)}var d=Object(U.j)(a,i,o),f=z(e),p=r;return{correctness:r=q(p,n),autoCorrectness:p,score:J(r,1)*f,outof:r.length*f,correctedCrossword:d,answerWords:s}},Rubric:function(e,t,n){var r=e.rubric,o=0,i=[],a=0;if(r){var s=r.labels,u=r.rows;if(s&&s.length&&u&&u.length){var c=s.map(function(e){return j(e.weight)||0}),l=0;u.forEach(function(e){var t=e.cells.map(function(e,t){return"0"===e.weight?j(e.weight):j(e.weight)||c[t]||0});n&&e.cells.forEach(function(e,r){1===n[l]&&(a+=t[r]),l++});var r=Math.max.apply(Math,M(t));o+=r}),i=u.map(function(){return s.map(function(){return-2})}).reduce(function(e,t){return e.concat(t)})}}var d=i;return i=q(d,n),"no"===e.needs_correction?{correctness:i,autoCorrectness:-2,score:0,outof:0}:{correctness:i,autoCorrectness:d,score:a,outof:o}}};function xe(e){return e.replace(/\b(?:https?):\/\/[a-z0-9-+&@#/%?=~_|!:,.;]*[a-z0-9-+&@#/%=~_|]/gim,'<a href="$&" target="_blank" class="weblink">$&</a>')}function Oe(e){return-1!==l()(["RichText","Photo","Whiteboard","AudioRecording","Rubric"],e)}},101:function(e,t,n){e.exports=function(e,t,n,r){function o(e,t){return r('<svg class="'+e+'" xmlns="http://www.w3.org/2000/svg" version="1.1">'+t+"</svg>")}function i(e,t,n,r){return'<line x1="'+e+'" y1="'+t+'" x2="'+n+'" y2="'+r+'" />'}function a(n){var a=r(document.createElement("div")).addClass("bw-popup-zoomable-image"),s=r(document.createElement("div")).addClass("bw-zoomable-image").css({background:"black url("+n.replace(/ /g,"%20")+") no-repeat center center","background-size":"contain"}).appendTo(a);r(document.createElement("div")).addClass("bw-button bw-popup-closebutton").append(r(document.createElement("div")).addClass("bw-icon-small bw-icon-close")).makeButton(t("close")).click(function(e){setTimeout(a.remove.bind(a),0)}).appendTo(a);var u=o("bw-zoomable-image-zoomin",i(14.5,4,14.5,26)+i(4,14.5,26,14.5)).appendTo(a),c=o("bw-zoomable-image-zoomout",i(4,14.5,26,14.5)).appendTo(a);e.bwMakeDragAndResizable(s,u,c),a.appendTo(r("body"))}return{create:function(e){var t,o,i=e.hasOwnProperty("img")?e.img:e,s=i.sources&&i.sources.length>0?n(i.sources[0].src):"",u=s;e.type&&"img"!==e.type?t=r(document.createElement("div")).attr("role","image").css({background:(e.background||"")+" url("+s.replace(/ /g,"%20")+") no-repeat center center","background-size":(o=e.resize_policy,o?"Contain entire picture, keep aspect ratio"===o?"contain":"Cover entire area, keep aspect ratio"===o?"cover":"No resize"===o?"":"Cover entire area with entire picture"===o?"100% 100%":"contain":"contain")}):(t=r(document.createElement("img")),e.loadcb&&t.on("load",e.loadcb),t.attr("src",s));var c=i.alttext||e.alttext;return null!=c&&""!==c&&t.attr("alt",c),t.on("zoom",function(){a(u)}),e.disable_click||t.clickOnDraggable(function(){a(u)}),e.disable_press||t.hammer().on("press",function(){a(u)}),t},showPopup:a}}(n(164),n(18),n(57),n(0))},105:function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return d});var r=n(50),o=n.n(r),i=n(5),a=n(28),s=n(15).extend,u=n(71),c=a.createLogger("ProgressLogger"),l=new o.a;function d(e){var t=void 0!==e||"ibw-platform-ipad-bookwidgets"===i.getPlatform();e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var n={};function r(e,t){n.callObjC("progress",s({cmd:e},t),function(){c.error("ProgressLogger: OK for:"+e)},function(){c.error("ProgressLogger: ERROR for:",e)})}n.resultForCallback=function(e,t){l.processCallback(e,t)},n.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},n.callObjC=function(t,r,o,i){var a=u.url(t,r),s=l.registerCallbacks(o,i),c="'"+s.ok+"'",d="'"+s.error+"'",f="ProgressLogger.resultForCallback";n.runningInIframe()&&(f="function ProgressLogger_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; ProgressLogger_callback_wrapper"),e(a+"&okCallbackId="+c+"&errorCallbackId="+d+"&callbackFunc="+f)},n.restart=function(){t&&r("restart")},n.registerScore=function(e,n,o,i,a){return t?(r("registerScore",{identifier:e,title:n,score:i,maxScore:o,primary:!0===a}),{lastval:i,update:function(t){return t!==this.lastval&&(r("updateScore",{identifier:e,title:n,score:t,maxScore:o,primary:!0===a}),this.lastval=t,!0)}}):{update:function(){return!1}}},n.registerBinary=function(e,t,n,r,o){return{update:function(){return!1}}},n.registerQuantity=function(e,n,o,i){return t?(r("registerQuantity",{identifier:e,title:n,quantity:o,primary:!0===i}),{lastval:o,update:function(t){return t!==this.lastval&&(r("updateQuantity",{identifier:e,title:n,quantity:t,primary:!0===i}),this.lastval=t,!0)}}):{update:function(){return!1}}};var o=0;return n.setProgress=function(e,n){if(t){var i=Math.max(0,Math.min(1,e/n));i!==o&&(r("setProgress",{progress:i}),o=i)}},n.registerSet=function(e,n,r,o){if(!t)return{registerAccess:function(){return!1}};var i=this;return{elements:[],accesscount:0,accessedcount:0,accessedLogger:this.registerQuantity(e+"accessed",n,0),accessesLogger:this.registerQuantity(e+"accesses",r,0),registerAccess:function(e){return this.accessesLogger.update(++this.accesscount),this.elements.hasOwnProperty(e)||(this.elements[e]=!0,this.accessedLogger.update(++this.accessedcount),i.setProgress(this.accessedcount,o)),!0}}},window.ProgressLogger=n,n}l.startListening()},106:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"setState",function(){return l}),n.d(r,"create",function(){return d}),n.d(r,"hide",function(){return f});var o=n(21),i=n.n(o),a=n(88),s=n.n(a),u=n(0),c=n(42);function l(e,t){var n=u("#loginbutton");if((n.safeHtml()!==t||n.attr("state")!==e)&&(n.safeHtml(t).attr({state:e}),"offline"===e||"online"===e)){var r=u(document.createElement("div")).addClass("login-change-wrapper").appendTo("#top-container"),o=n.clone();o.attr("id","login-change-alert").appendTo(r).fadeIn(400,"swing",function(){setTimeout(function(){o.fadeOut(400,"swing",function(){r.remove()})},1e3)}),n.effect&&n.effect("pulsate",{times:4},500)}c.centerTitle()}function d(e){var t=u(document.createElement("div")).addClass("loginbutton bw-tooltext").attr("id","loginbutton");c.prependToTitleToolbar(t),t.tapOrClick(e)}function f(){u("#loginbutton").hide()}var p=n(89),g=n.n(p),h=n(81),m=n.n(h),v=n(90),b=n.n(v),w=n(91),y=n.n(w),D=n(92),C=n.n(D),E=n(93),A=n.n(E),_=n(94),S=n.n(_),k=n(95),x=n.n(k),O=n(87),I=n.n(O),T=n(96),F=n(97),B=n.n(F),P=n(98),N=n.n(P),L=n(22),R=n.n(L),W=n(18),U=n.n(W),M=n(99),j=n.n(M);function q(e){e=e||{};var t={bwConfig:i.a,StudentAccountButtonUI:e.StudentAccountButtonUI||r,dialog:R.a,throbber:m.a};return t.tr=U.a,t.credentialstorage=s()(),t.studentaccountui=B.a,t.studentaccount=b.a.bindToContext(t),t.studentaccountbutton=y.a.bindToContext(t),t.bwds=I.a,t.blob=N.a,t.bwdsstorage=S.a.bindToContext(t),t.onlinestorage=A.a.bindToContext(t),t.writecachingonlinestorage=x.a.bindToContext(t),t.studentinfo=g.a.bindToContext(t),t.StorageBusyMarker=e.StorageBusyMarker||T,e.nostorage||(t.widgetstorage=C.a.bindToContext(t)),e.nosubmitter||(t.StudentWorkSubmitter=j.a.bindToContext(t)),t}n.d(t,"createDefaultContext",function(){return q})},109:function(e,t,n){var r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n(66);function r(e){return"iBookWidgets/"+e}var o=e.createLogger("BWKSLocal");return{getItem:function(e){return o.debug("getItem "+r(e)),t.GetItem(r(e))},setItem:function(e,n){o.debug("setItem "+r(e));try{return t.SetItem(r(e),n),!0}catch(e){return!1}},removeItem:function(e){o.debug("removeItem "+r(e)),t.RemoveItem(r(e))},clear:function(){o.debug("clear"),t.Clear()}}}.bind(null,n(28));e.exports={f:r}},110:function(e,t,n){e.exports=function(e){var t=n(28).createLogger("WebSQLAsyncKeyStore");function r(e,n,r){t.error("WebSQL Error: executeSQL triggered error: "+r.message),null!=e&&e(r)}var o=function(e,t){this.name=e||"BWDS1",this.initialized=!1,this.valid=!1,this.db=null,this.openDatabase=void 0!==t?t:window.openDatabase?window.openDatabase.bind(window):function(){console.error("webSQL not supported")}};return o.prototype._prepareDatabase=function(e,n){var r=this.openDatabase(this.name,"","Offline BW storage",5242880);return""==r.version&&(t.debug("WebSQL: creating db"),r.changeVersion(r.version,"1.0",function(e){t.debug("WebSQL: creating table"),e.executeSql("CREATE TABLE keyvalue (keyname PRIMARY KEY, dir, name, value, attribs)")},n)),r},o.prototype._initializeAndRun=function(e,n){if(this.initialized)this.valid?void 0!==e&&e():(t.debug("WebSQL Error: Database is initialized but not valid, calling error"),void 0!==n&&n(this.error));else if(this.initialized=!0,this.openDatabase){try{t.debug("WebSQL: initializing database"),this.db=this._prepareDatabase(function(e){t.debug("WebSQL Error: Received error while preparing database: "+e.message)}),this.valid=!0}catch(e){switch(e.code){case e.SECURITY_ERR:t.debug("WebSQL Error: Received security error: "+e.message);break;case e.INVALID_STATE_ERR:t.debug("WebSQL Error: Received invalid state error: "+e.message);break;default:t.debug("WebSQL Error: Received error "+e.code+": "+e.message)}return this.valid=!1,this.error=e,void n(e)}e()}else t.debug("WebSQL Error: No WebSQL database available"),this.valid=!1,this.error={code:9999,message:"WebSQL Error: No WebSQL database available"},n(this.error)},o.prototype._initializeAndRunTransaction=function(e,n,r){var o=this;this._initializeAndRun(function(){o.db[e?"readTransaction":"transaction"](function(e){try{n(e)}catch(e){t.error("Error while executing transaction: "+e.code+": "+e.message),null!=r&&r(e)}},function(e){t.error("WebSQL Error: "+e.code+" starting transaction :"+e.message),o.valid=!1,o.initialized=!1,null!=r&&r(e)})},function(e){t.error("WebSQL Error: database not valid"),null!=r&&r(e)})},o.prototype._initializeAndRunReadTransaction=function(e,t){this._initializeAndRunTransaction(!0,e,t)},o.prototype._initializeAndRunReadWriteTransaction=function(e,t){this._initializeAndRunTransaction(!1,e,t)},o.prototype.getItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: getItemsAsync without names"),void o({code:9999,message:"WebSQL Error: getItemsAsync without names"});this._initializeAndRunReadTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("SELECT keyname, value, attribs FROM keyvalue where keyname IN ("+a+")",e,function(e,r){for(var o={},i=0;i<r.rows.length;++i){var a=r.rows.item(i);o[a.keyname]=a,t.debug("WebSQL: read ("+a.keyname+") = "+a.value)}n(o)},r.bind(null,o))},o)},o.prototype.getDirAttribs=function(e,t,n){this._initializeAndRunReadTransaction(function(o){o.executeSql("SELECT keyname, attribs FROM keyvalue where dir = ?",[e],function(e,n){for(var r={},o=0;o<n.rows.length;++o){var i=n.rows.item(o);r[i.keyname]=i.attribs}t(r)},r.bind(null,n))},n)},o.prototype.setItemsAsync=function(e,n,o){if(0===e.length)return t.error("WebSQL Error: setItemsAsync without names"),void o({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("WebSQL Error: setItemsAsync can only handle 1 item"),void o({code:9999,message:"setItemsAsync can only handle 1 item"});var i=e[0];this._initializeAndRunReadWriteTransaction(function(a){var s,u=i.key,c=u.lastIndexOf("/"),l="";-1!=c&&(l=u.substring(0,c)),s=u.substring(c+1),a.executeSql("INSERT OR REPLACE INTO 'keyvalue' ( 'keyname', 'dir', 'name', 'value', 'attribs' ) VALUES ( ? , ? , ?, ? , ? )",[i.key,l,s,i.value,i.attribs],function(r,a){a.rowsAffected!=e.length?(t.error("WebSQL Error: store error on key "+name),o({code:9999,message:"WebSQL store error: wrong # rows affected"})):null!=n?(t.debug("WebSQL: wrote ("+i.key+")"),n()):t.error("WebSQL Error: setItemsAsync no OK function")},r.bind(null,o))},o)},o.prototype.removeItemsAsync=function(e,n,o){if(0===e.length)return t.debug("WebSQL Error: removeItemsAsync without names"),void o({code:9999,message:"WebSQL Error: removeItemsAsync without names"});this._initializeAndRunReadWriteTransaction(function(i){for(var a="",s=0;s<e.length;++s)a+=(""==a?"":", ")+"?";i.executeSql("DELETE FROM keyvalue where keyname IN ("+a+")",e,function(r,o){t.debug("WebSQL: removed "+e.join(", ")),null!=n&&n()},r.bind(null,o))},o)},o.prototype.clearAllAsync=function(e,n){this._initializeAndRunReadWriteTransaction(function(o){o.executeSql("DELETE FROM keyvalue",[],function(n,r){t.debug("WebSQL: Cleared all"),null!=e&&e()},r.bind(null,n))},n)},o}()},111:function(e,t,n){var r=n(15).each,o=n(112);e.exports=function(e){var t=n(28).createLogger("IndexedDBAsyncKeyStore");var i=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;this.idbstore=t};return i.prototype.getItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore getItemsAsync"),0===e.length)return t.debug("IndexedDB Error: getItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: getItemsAsync without names"});var i={};e.reduce(function(e,n){return e.then(function(){return function(e){var n=this;return t.debug("readelem ",e),new Promise(function(r,o){n.idbstore.get(e).then(function(n){t.debug("read elem: "+e),null!=n&&(i[e]=n),r()},function(n){t.debug("error accessing elem: "+e),o(n)}).catch(function(e){t.error("Caught idb exception",e),o(e)})})}.bind(o,n)()})},Promise.resolve()).then(function(){n(i)},r)},i.prototype.getDirAttribs=function(e,n,o){t.debug("IndexedDBAsyncKeyStore getDirAttribs"),this.idbstore.direlems(e).then(function(e){var t={};r(e,function(e){t[e.keyname]=e.attribs}),n(t)},o)},i.prototype.setItemsAsync=function(e,n,r){if(t.debug("IndexedDBAsyncKeyStore setItemsAsync"),0===e.length)return t.error("IndexedDB Error: setItemsAsync without names"),void r({code:9999,message:"setItemsAsync without names"});if(e.length>1)return t.error("IndexedDB Error: setItemsAsync can only handle 1 item"),void r({code:9999,message:"setItemsAsync can only handle 1 item"});var o,i,a=e[0];this.idbstore.set(a.key,{keyname:a.key,value:a.value,attribs:a.attribs,dir:(o=a.key,i=o.lastIndexOf("/"),-1!=i?o.substring(0,i):"")}).then(function(){n()},r).catch(r)},i.prototype.removeItemsAsync=function(e,n,r){var o=this;if(t.debug("IndexedDBAsyncKeyStore removeItemsAsync"),0===e.length)return t.debug("IndexedDB Error: removeItemsAsync without names"),void r({code:9999,message:"IndexedDB Error: removeItemsAsync without names"});e.reduce(function(e,t){return e.then(function(){return o.idbstore.del(t)})},Promise.resolve()).then(function(){n()},r)},i.prototype.clearAllAsync=function(e,n){t.debug("IndexedDBAsyncKeyStore clearAllAsync"),this.idbstore.clear().then(e,n)},i}()},112:function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t),n.d(t,"Store",function(){return a}),n.d(t,"get",function(){return u}),n.d(t,"set",function(){return c}),n.d(t,"del",function(){return l}),n.d(t,"clear",function(){return d}),n.d(t,"direlems",function(){return f});var o,i=n(160),a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"bwds-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storeName=n,this._dbp=new i(function(e,r){var o=indexedDB.open(t,1);o.onerror=function(){return r(o.error)},o.onsuccess=function(){return e(o.result)},o.onupgradeneeded=function(){o.result.createObjectStore(n).createIndex("dir_idx","dir")}})}var t,n,o;return t=e,(n=[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then(function(r){return new i(function(o,i){var a=r.transaction(n.storeName,e);a.oncomplete=function(){return o()},a.onabort=a.onerror=function(){return i(a.error)},t(a.objectStore(n.storeName))})})}}])&&r(t.prototype,n),o&&r(t,o),e}();function s(){return o||(o=new a),o}function u(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.get(e)}).then(function(){return t.result})}function c(e,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:s())._withIDBStore("readwrite",function(n){n.put(t,e)})}function l(e){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readwrite",function(t){t.delete(e)})}function d(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:s())._withIDBStore("readwrite",function(e){e.clear()})}function f(e){var t;return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:s())._withIDBStore("readonly",function(n){t=n.index("dir_idx").getAll(e)}).then(function(){return t.result})}},113:function(e,t,n){var r,o;e.exports=(r=n(50),(o=function(e,t){this.name=e,this.origin=t,this.callbackBridge=new r,this.callbackBridge.startListening()}).prototype.send=function(e,t,n){e.to=this.name,e.cb=this.callbackBridge.registerCallback(t,n),window.parent.postMessage(e,this.origin)},o)},114:function(e,t,n){var r,o,i;e.exports=(r=n(84),o=n(47),i=n(28).createLogger("AsyncKeyStoreToBWDSAdapter"),function(e){var t={};function n(e,n){t.queue.executeSequential(function(t){try{e(t)}catch(e){console.error("AsyncBWDS: Uncaught error: "+e),r.handleException(e,n,t)}})}return t.async=e,t.queue=r.newCallbackQueue(),t.readNoSync=function(e,n,r){i.debug("readNoSync "+e),t.async.getItemsAsync([e],function(r){if(r.hasOwnProperty(e)){var o=JSON.parse(r[e].attribs);!1===o.removed?n(r[e].value,t.fileStat(e,o)):n(null,t.fileStat(e,o))}else n(null,null)},function(e){r(e)})},t.read=function(e,i){n(function(n){t.readNoSync(e,function(e,t){null==e?r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"),null,t):r.callSafe(i,null,e,t),n()},function(e){r.handleException(e,i,n)})},i)},t.writeNoSync=function(e,n,o,a){i.debug("writeNoSync "+e+" "+n);var s=null==n?0:n.length;t.async.getItemsAsync([e],function(i){var u,c=r.getDateTime();i.hasOwnProperty(e)?((u=JSON.parse(i[e].attribs)).updated_at=c,u.filesize=s,u.isdir=null==n,u.removed=!1,u.version=u.version+1,u.offline=!1):u={created_at:c,updated_at:c,filesize:s,isdir:null==n,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1},t.async.setItemsAsync([{key:e,value:null==n?"":n,attribs:JSON.stringify(u)}],function(n){if(""!=e){var r=e.lastIndexOf("/"),i="";-1!=r&&(i=e.substring(0,r)),t.writeNoSync(i,null,o,a)}else o(t.fileStat(e,u))},function(e){a(e)})},function(e){a(e)})},t.write=function(e,o,i){n(function(n){t.writeNoSync(e,null==o?"":o,function(e){r.callSafe(i,null,e),n()},function(e){r.handleException(e,i,n)})},i)},t.removeFiles=function(e,n,o){if(0==e.length)null!=n&&n();else{var a=e.shift(),s=a.attribs,u=r.getDateTime();s.removed=!0,s.offline=!1,s.updated_at=u,t.async.setItemsAsync([{key:a.name,value:"",attribs:JSON.stringify(s)}],function(){t.removeFiles(e,function(){n(s)},o)},function(){i.error("removeFiles, could not write new file attribs to clear, removing including attribs"),t.async.removeItemsAsync([a.name],function(){t.removeFiles(e,function(){n(s)},o)},o)})}},t.removeRecurse=function(e,n,r){if(0==e.length)null!=n&&n();else{var o=e.shift();t.async.getDirAttribs(o,function(o){var i=[];for(var a in o){var s=JSON.parse(o[a]);!1===s.removed&&(!0===s.isdir&&e.push(a),i.push({name:a,attribs:s}))}t.removeFiles(i,function(){t.removeRecurse(e,n,r)},r)},r)}},t.removeNoSync=function(e,n,a){i.debug("removeNoSync "+e),""==e?t.removeRecurse([e],n,function(e){r.handleException(e,a)}):t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var s=JSON.parse(i[e].attribs);!1===s.removed?s.isdir?t.removeFiles([{name:e,attribs:s}],function(){t.removeRecurse([e],n,function(e){r.handleException(e,a)})},function(e){r.handleException(e,a)}):t.removeFiles([{name:e,attribs:s}],function(r){n(t.fileStat(e,r))},function(e){r.handleException(e,a)}):a(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))}else a(r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file"))},function(e){r.handleException(e,a)})},t.remove=function(e,o){n(function(n){t.removeNoSync(e,function(){r.callSafe(o,null),n()},function(e){r.callSafe(o,e),n()})},o)},t.dirNoSync=function(e,n,o){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(t){var o=[];for(var i in t)!1===JSON.parse(t[i]).removed&&""!=i&&o.push(r.trimLeadingSlash(i.substr(e.length)));o.length>0?n(o):n(null)},function(e){o(e)})},t.dir=function(e,i){n(function(n){t.dirNoSync(e,function(t){null!==t?r.callSafe(i,null,t):""===e?r.callSafe(i,null,[]):r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,i,n)})},i)},t.fileStat=function(e,t){return{name:e,size:t.filesize,created:t.created_at,modified:t.updated_at,isdir:t.isdir,removed:t.removed,version:t.version,backup_version:t.backup_version,backup_date:t.hasOwnProperty("backup_date")?t.backup_date:null,offline:!!t.hasOwnProperty("offline")&&t.offline}},t.dirStat=function(e,n,r,o){i.debug("dirNoSync "+e),t.async.getDirAttribs(e,function(e){var o=[];for(var i in e)""!==i&&o.push(t.fileStat(i,JSON.parse(e[i])));r(n,o)},function(e){o(e)})},t.statNoSync=function(e,n,r){i.debug("statNoSync "+e),t.async.getItemsAsync([e],function(o){if(o.hasOwnProperty(e)){var i=JSON.parse(o[e].attribs),a=t.fileStat(e,i);i.isdir?t.dirStat(e,a,n,r):n(a)}else n(null)},function(e){r(e)})},t.stat=function(e,i){n(function(n){t.statNoSync(e,function(e,t){null!==e?void 0===t?r.callSafe(i,null,e):r.callSafe(i,null,e,t):r.callSafe(i,r.error(o.BWDS_ERROR_UNKNOWN,"AsyncBWDS Error: no such file")),n()},function(e){r.handleException(e,i,n)})},i)},t.setStatNoSync=function(e,n,a,s){i.debug("setStatNoSync "+e),t.async.getItemsAsync([e],function(i){if(i.hasOwnProperty(e)){var u=JSON.parse(i[e].attribs);for(var c in n)if("backup_date"==c)u.backup_date=n.backup_date;else{if("backup_version"!=c)return void s(r.error(o.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+c));u.backup_version=n.backup_version}t.async.setItemsAsync([{key:e,value:i[e].value,attribs:JSON.stringify(u)}],function(n){a(t.fileStat(e,u))},function(e){r.handleException(e,s)})}else s(r.error(o.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},function(e){s(e)})},t.setStat=function(e,o,i){n(function(n){t.setStatNoSync(e,o,function(e){r.callSafe(i,null,e),n()},function(e){r.callSafe(i,e),n()})},i)},t.executeSync=function(e,n){t.queue.executeSequential(e,n)},t.removeAll=function(e){var n=[""],r=[],o=null;!function i(){if(r.length>0){var a=r.shift();t.removeNoSync(a,function(){i()},function(){console.log("Could not remove ",a),o="Could not remove file",i()})}else if(0!==n.length){var s=n.shift();t.dirStat(s,null,function(e,t){for(var o=0;o<t.length;++o){var a=t[o];a.removed||(a.isdir?n.push(a.name):r.push(a.name))}i()},function(){console.log("Error getting stat for ",s),o="Error removing files",i()})}else e(o)}()},t.clearAll=function(e){i.debug("clearAll"),t.async.clearAllAsync?t.async.clearAllAsync(function(){i.debug("AsyncBWDS.clearAll OK callback"),r.callSafe(e)},function(t){r.handleException(t,e)}):t.removeAll(e)},t})},115:function(e,t,n){e.exports=function(e,t,r){var o=n(28).createLogger("SyncKeyStoreToBWDSAdapter");function i(t,n){try{t()}catch(t){o.error("Uncaught error: "+t),e.handleException(t,n)}}return function(n){var r={};function a(n,o,i){return!1!==r.keystore.setItem(n,o)||(e.callSafe(i,e.error(t.BWDS_ERROR_FULL,"KeyStoreBWDS error: storage full"),null),!1)}return r.keystore=n,r.write=function(t,n,s){i(function(){o.debug("write "+t);var i,u,c=n.length,l=t.lastIndexOf(".");if(-1==l?(i=t,u=""):(i=t.substr(0,l),u=t.substr(l+1)),a(i,n,s))if(""!=i){var d,f=i.lastIndexOf("/"),p="";-1!=f&&(p=i.substring(0,f)),d=i.substring(f);var g,h=r.keystore.getItem(p),m=e.getDateTime();null===h?(g={})[d]={type:u,created_at:m,updated_at:m,filesize:c,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1}:(g=JSON.parse(h))[d]?(g[d].type=u,g[d].updated_at=m,g[d].filesize=c,g[d].version=g[d].hasOwnProperty("version")?g[d].version+1:2,g[d].removed=!1,g[d].offline=!1):g[d]={type:u,created_at:m,updated_at:m,filesize:c,removed:!1,version:1,backup_version:0,backup_date:null,offline:!1};var v=r.fileStat(p,d,g[d]);r.write(p+".dir",JSON.stringify(g),function(t){e.callSafe(s,t,v)})}else e.callSafe(s,null,null)},s)},r.read=function(n,a){i(function(){var i,s;o.debug("read "+n);var u=n.lastIndexOf(".");-1==u?(i=n,s=""):(i=n.substr(0,u),s=n.substr(u+1));var c,l=i.lastIndexOf("/"),d="";-1!=l&&(d=i.substring(0,l)),c=i.substring(l);var f=r.keystore.getItem(d);if(null!==f){var p=JSON.parse(f);if(p[c])if(s&&p[c].type!=s)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null);else if(!0===p[c].removed)e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: removed file"),null,r.fileStat(d,c,p[c]));else{var g=r.keystore.getItem(i);e.callSafe(a,null,g,r.fileStat(d,c,p[c]))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"BWKDLocal Error: unknown file"),null,null)}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"),null,null)},a)},r.clearDir=function(e){var t=r.keystore.getItem(e);if(null!=t){var n=JSON.parse(t);for(var i in n)"dir"==n[i].type&&""!=i&&r.clearDir(e+i),o.debug("Clearing: "+e+i),r.keystore.removeItem(e+i);r.keystore.removeItem(e)}},r.clear=function(t,n){i(function(){if(o.debug("clear "+t),t)throw Error("clear(): Unexpected parameter");r.clearDir(""),e.callSafe(n,null)},n)},r.removeDir=function(t,n){o.debug("removeDir("+t+")");var i=r.keystore.getItem(t);if(null!=i){var s=JSON.parse(i),u=e.getDateTime();for(var c in s){var l=s[c];!1===l.removed&&("dir"===l.type?""!==c&&r.removeDir(t+c,n):(o.debug("Clearing: "+t+c),r.keystore.removeItem(t+c)),s[c].version=s[c].hasOwnProperty("version")?s[c].version+1:2,s[c].removed=!0,s[c].updated_at=u)}if(!a(t,JSON.stringify(s),n))return}},r.remove=function(n,a){i(function(){if(o.debug("remove "+n),""==n||null==n||null==n)return r.removeDir("",a),void e.callSafe(a,null);var i,s,u=n.lastIndexOf("."),c=(i=-1==u?n:n.substr(0,u)).lastIndexOf("/"),l="";-1!=c&&(l=i.substring(0,c)),s=i.substring(c);var d=r.keystore.getItem(l);if(null!==d){var f=JSON.parse(d);if(!f[s])return o.error("unknown file"),void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"));"dir"==f[s].type?r.removeDir(n,a):r.keystore.removeItem(i),f[s].removed=!0,f[s].version=f[s].hasOwnProperty("version")?f[s].version+1:2;var p=e.getDateTime();f[s].updated_at=p;var g=r.fileStat(l,s,f[s]);r.write(l+".dir",JSON.stringify(f),function(t){e.callSafe(a,t,g)})}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))},a)},r.dir=function(n,a){i(function(){var i,s;if(o.debug("dir "+n),""!=n){var u,c=n.lastIndexOf("/"),l="";if(-1!=c&&(l=n.substring(0,c)),u=n.substring(c),null===(i=r.keystore.getItem(l)))return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"));if(!1===(s=JSON.parse(i)).hasOwnProperty(u)||"dir"!==s[u].type)return void e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown directory"))}i=r.keystore.getItem(n),s=JSON.parse(i);var d=[];for(var f in s)!0!==s[f].removed&&d.push(e.trimLeadingSlash(f)+("dir"==s[f].type?"":"."+s[f].type));e.callSafe(a,null,d)},a)},r.fileStat=function(e,t,n){return{name:e+t+("dir"==n.type?"":"."+n.type),size:n.hasOwnProperty("filesize")?n.filesize:null==r.keystore.getItem(e+t)?0:r.keystore.getItem(e+t).length,created:n.created_at,modified:n.updated_at,isdir:"dir"==n.type,removed:n.hasOwnProperty("removed")&&!0===n.removed,version:n.version,backup_version:n.backup_version,backup_date:n.hasOwnProperty("backup_date")?n.backup_date:null,offline:!!n.hasOwnProperty("offline")&&n.offline}},r.dirStat=function(t,n,o){var i=r.keystore.getItem(t),a=JSON.parse(i),s=[];for(var u in a)s.push(r.fileStat(t,u,a[u]));e.callSafe(n,null,o,s)},r.stat=function(n,a){i(function(){if(o.debug("stat "+n),""!=n){var i,s,u=n.lastIndexOf("."),c=(i=-1==u?n:n.substr(0,u)).lastIndexOf("/"),l="";-1!=c&&(l=i.substring(0,c)),s=i.substring(c);var d=r.keystore.getItem(l);if(null!==d&&""!==d){var f=JSON.parse(d);if(f[s])return"dir"==f[s].type?void r.dirStat(n,a,r.fileStat(l,s,f[s])):void e.callSafe(a,null,r.fileStat(l,s,f[s]));e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(a,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else r.dirStat(n,a,{isdir:!0,name:""})},a)},r.setStat=function(n,s,u){i(function(){if(o.debug("stat "+n),""!=n){var i,c,l=n.lastIndexOf("."),d=(i=-1==l?n:n.substr(0,l)).lastIndexOf("/"),f="";-1!=d&&(f=i.substring(0,d)),c=i.substring(d);var p=r.keystore.getItem(f);if(null!==p){var g=JSON.parse(p);if(g[c]){if("dir"==g[c].type)return void e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"));for(var h in s)if("backup_date"==h)g[c].backup_date=s.backup_date;else{if("backup_version"!=h)return void e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attribute "+h));g[c].backup_version=s.backup_version}if(!a(f,JSON.stringify(g),u))return;e.callSafe(u,null,r.fileStat(f,c,g[c]))}else e.callSafe(u,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(u,e.error(t.BWDS_ERROR_UNKNOWN,"KeyStoreBWDS Error: unknown file"))}else e.callSafe(u,e.error(t.BWDS_ERROR_WRONG_ATTRIB,"KeyStoreBWDS Error: Can't set attributes for directory"))},u)},r.executeSync=function(e,t){e(function(){})},r.clearAll=function(e){i(function(){r.clear("",e)},e)},r}}(n(84),n(47))},117:function(e,t){e.exports={GetItem:function(e){return sessionStorage.getItem(e)},RemoveItem:function(e){sessionStorage.removeItem(e)},SetItem:function(e,t){sessionStorage.setItem(e,t)},Clear:function(){sessionStorage.clear()}}},118:function(e,t,n){"use strict";function r(e){return e.firstName&&""!==e.firstName&&e.lastName&&""!==e.lastName?e.firstName+" "+e.lastName:e.firstName&&""!==e.firstName?e.firstName:e.lastName&&""!==e.lastName?e.lastName:e.providerHumanID&&""!==e.providerHumanID&&e.providerHumanID!==e.providerID?e.providerHumanID:e.email&&""!==e.email?e.email.substring(0,e.email.indexOf("@")):e.providerID}n.r(t),n.d(t,"displayName",function(){return r})},119:function(e,t,n){var r;e.exports=(r=n(21).getConfigSync(),{getAJAXHeaders:function(){return null!=r.widget_language&&r.widget_language.length>0?{"Accept-Language":r.widget_language}:{}}})},13:function(e,t){e.exports=function(){var e=["context_id","course_id","hide_account","lfq","lti","login_hint","no_logout","q","sso","smartschool_platform","student_class_id","submit_url","teacher_email","teacher_id"];function t(e){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var n=0;n<e.length;++n){var r=e[n];r.length>1?t.push(encodeURIComponent(r[0])+"="+encodeURIComponent(r[1])):t.push(encodeURIComponent(r[0]))}else for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")}function n(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var i=[n[r].substr(0,o),n[r].substr(o+1)],a=decodeURIComponent(i[0]);if(void 0===t[a])t[a]=decodeURIComponent(i[1]);else if("string"==typeof t[a]){var s=[t[a],decodeURIComponent(i[1])];t[a]=s}else t[a].push(decodeURIComponent(i[1]))}}return t}function r(e){for(var t=[],n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(o<0)t.push([n[r]]);else{var i=[n[r].substr(0,o),n[r].substr(o+1)];t.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])])}}return t}function o(e){return!e||e.length<1||"?"!==e[0]?{}:n(e.substr(1))}function i(e){return!e||e.length<1||"?"!==e[0]?[]:r(e.substr(1))}function a(e,t){return e.split("&").filter(function(e){return decodeURIComponent(e.split("=")[0])!==t}).join("&")}function s(e){return(e=e||window.location.href).indexOf("#")>=0?"#"+(e.split("#")[1]||""):""}!function(){if(!window.WidgetParams){var n=i(window.location.search),o=[],a=s();if(a.length>=1&&"#"===a[0])for(var u=r(a.substr(1)),c=0;c<u.length;++c){var l=u[c];e.indexOf(l[0])>=0?n.push(l):o.push(l)}var d=window.location.pathname;n.length>0&&(d+="?"+t(n)),o.length>0&&(d+="#"+t(o)),"undefined"!=typeof history&&history.replaceState("",document.title,d)}}();var u=s(),c=window.location.search;return{split:n,splitList:r,getUrlParams:function(e){return-1===e.indexOf("?")?{}:n(e.replace(/[^?]*\?/,"").replace(/#.*/,""))},getQueryParams:o,getParameters:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=window.WidgetParams?{}:o(c);if(e){var r=function(e){return!e||e.length<1||"#"!==e[0]?{}:n(e.substr(1))}(u);for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}if(window.WidgetParams)for(var a in window.WidgetParams)t[a]=window.WidgetParams[a];return t},removeQueryStringParameter:function(e,t){return e.length>0&&("?"===e[0]||"#"===e[0])?e[0]+a(e.substring(1),t):a(e,t)},updateWindowQueryParameter:function(e,n){for(var r=i(window.location.search),o=!1,a=0;a<r.length;++a)if(r[a][0]===e){r[a].length>1?r[a][1]=n:r[a].push(n),o=!0;break}o||r.push([e,n]),history.replaceState("",document.title,window.location.pathname+"?"+t(r)+s())},urlencode:t,getHash:s,LEGACY_HASH_PARAMETERS:e}}()},139:function(e,t){e.exports=window.Hammer},141:function(e,t){e.exports=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},16:function(e,t,n){var r=n(121),o=n(134),i=n(58),a=n(12);e.exports=function(e,t){return(a(e)?r:o)(e,i(t,3))}},164:function(e,t,n){var r,o,i;e.exports=(r=n(0),o=n(139),i=n(5),{bwMakeDragAndResizable:function(e,t,n,a,s){var u=-1!==i.getPlatform().indexOf("ibooks"),c=new o.Manager(e.get(0));c.add(new o.Pan({threshold:0,pointers:0})),u||c.add(new o.Pinch({threshold:0})).recognizeWith([c.get("pan")]);var l=null;function d(t){null===l&&(l={pos:e.offset(),width:e.width(),height:e.height(),center:{x:e.offset().left,y:e.offset().top}}),t&&!l.hasOwnProperty("last_rotation")&&(l.center=t.center)}function f(t){var n=t.scale;e.offset({top:l.pos.top+t.deltaY+(l.center.y-l.pos.top)*(1-n),left:l.pos.left+t.deltaX+(l.center.x-l.pos.left)*(1-n)}),u||(e.width(l.width*n),e.height(l.height*n))}function p(t){var n=e.width(),o=e.height(),i=e.position(),a=r(window).width(),u=r(window).height();e.width(n*t),e.height(o*t),e.css("left",(i.left-a/2)*t+a/2),e.css("top",(i.top-u/2)*t+u/2),s&&s()}c.on("hammer.input",function(e){e.isFinal&&(l=null)}),c.on("panstart panmove",function(e){"panstart"===e.type?d():(f(e),a&&a())}),u||(c.on("pinchstart pinchmove",function(e){"pinchstart"===e.type?d(e):(f(e),s&&s())}),c.on("pinchend pinchcancel",function(){l&&(l=null,d())})),t.tapOrClick(function(){p(1.25)}),n.tapOrClick(function(){p(.8)})}})},169:function(e,t,n){var r,o,i=n(15).map,a=n(170).makeLabeledToolButton,s=n(141);e.exports=(r=n(18),o=n(0),function(e,t,n){var u=e.config,c=e.hasOwnProperty("submitName")?e.submitName:""==u.id?""==u.title?e.defaultName:u.title:u.id;function l(n){var r=t.createStudentWorkSubmitter(c,u.book_title,u.uuid2,u.WA);r.setCompanyInfo(u.company_name,u.company_address,u.company_phone,u.company_website);var o=[],i=[];function a(e){return{data:e(),mimetype:"image/png"}}e.assetFetcherCB&&e.assetUploadCompleteCB?(o=[e.assetFetcherCB],i=[e.assetUploadCompleteCB]):e.assetFetcherLister&&e.assetUploadCompleteLister&&(o=e.assetFetcherLister(),i=e.assetUploadCompleteLister());for(var s=0;s<o.length;++s)r.scheduleAssetUpload(a.bind(null,o[s]),i[s]);return r.setAnswersComposer(function(){return e.getAnswers(n)}),r}function d(t){var o=l(t);return o.on(o.EVT_SUBMIT_SUCCEEDED,function(){var t=e.submitSuccessMessage,a=o.getLastServerData();a&&a.messages&&(t+="<br><br>"+i(a.messages,function(e){return s(e.message)}).join("<br>")),n.showAlert(t,r("Sent successfully"))}),o.on(o.EVT_SUBMIT_FAILED,o.afterSubmitFailed.bind(o,e.submitFailedTitle,e.submitFailedMessage)),o}"yes"!=u.submit_answers&&"yes"!=u.send_drawing||(o("#sendbutton").show().click(function(){var t=d(!0);t.setEndpoint(u.action),t.setIncludeGrading("yes"==u.email_should_have_grading),t.showSendDialog(e.sendDialogMessage)}),a(o("#sendbutton"),r("Submit"))),"yes"==u.allow_sharing&&o("#sharebutton").show().click(function(){var t=d(!1);t.setEndpoint(u.share_action),t.setIncludeGrading(!1),t.showShareDialog(e.shareDialogMessage)}),"yes"==u.allow_download&&o("#downloadbutton").show().click(function(){var e=l(!1);e.setEndpoint(u.download_action),e.setIncludeGrading(!1),e.showDownloadDialog(r("Enter your name and click 'Generate' to generate the PDF."))})})},170:function(e,t,n){"use strict";n.r(t),n.d(t,"makeLabeledToolButton",function(){return a});var r=n(13),o=n(0),i=n.n(o);function a(e,t){"1"===Object(r.getParameters)().lsb&&(i()(document.createElement("span")).text(t).prependTo(e),e.addClass("bw-labeled-toolbutton"))}},18:function(e,t,n){e.exports=(n(21),function(e){try{return window.bwlocalizationmap&&window.bwlocalizationmap[e]&&""!==window.bwlocalizationmap[e]?window.bwlocalizationmap[e]:e}catch(t){return e}})},2:function(e,t,n){var r=n(116),o=n(58),i=n(133),a=n(12);e.exports=function(e,t){return(a(e)?r:i)(e,o(t,3))}},20:function(e,t,n){"use strict";n.r(t),n.d(t,"addYoutubePlayerIFrame",function(){return c}),n.d(t,"resolveYoutubePlaceholdersNew",function(){return d}),n.d(t,"loadYouTubePlayer",function(){return g}),n.d(t,"pollStartVideos",function(){return h}),n.d(t,"playYouTube",function(){return m}),n.d(t,"createHtml5VideoPlayer",function(){return v}),n.d(t,"adjustRichTextVideoSize",function(){return b}),n.d(t,"resolveYoutubePlaceholders",function(){return w});var r=n(34),o=n(8);n.d(t,"isYoutubeUrl",function(){return o.l}),n.d(t,"getVimeoId",function(){return o.d});var i=n(5),a=n(0),s=n.n(a),u=n(23);function c(e,t){var n=s()(e);if("ibw-platform-win32-preview"===i.getPlatform()||"ibw-platform-osx-preview"===i.getPlatform())return n.safeHtml("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});var r=Object(u.default)("http://www.youtube.com/embed/")+Object(o.g)(t)+Object(o.h)(t);s()(document.createElement("iframe")).attr({seamless:"",id:"playeriframe",src:r}).appendTo(n)}var l=0;function d(e){e.find(".youtubeplaceholder").each(function(){var e=s()(this);if(void 0===e.attr("id")){var t="YTP_"+l++;e.attr("id",t),c("#"+t,e.attr("src"))}})}var f=!1,p=[];function g(e,t,n){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",Object(u.default)("http://www.youtube.com/player_api")),document.getElementsByTagName("body")[0].appendChild(r)}function h(){if(void 0!==window.YT&&void 0!==window.YT.Player)for(var e=0;e<p.length;++e)p[e]();else setTimeout(h,100)}function m(e,t){var n=s()(e),a=n.attr("id");if(null==a&&(a=Object(r.randomId)(20),n.attr("id",a)),"ibw-platform-win32-preview"===i.getPlatform()||"ibw-platform-osx-preview"===i.getPlatform())return n.safeHtml("<br>Youtube videos are not supported in preview mode."),void n.css({"background-color":"black",color:"white","text-weight":"bold","text-align":"center"});function u(){var n=s()(e),r={rel:0},i=Object(o.f)(t);0!==i&&(r.start=i);var u=Object(o.e)(t);0!==u&&(r.end=u);var c=Object(o.a)(t);null!=c&&(r.cc_lang_pref=c);var l=Object(o.b)(t);null!=l&&(r.cc_load_policy=l);var d=Object(o.g)(t);new window.YT.Player(a,{height:n.height(),width:n.width(),videoId:d,playerVars:r})}void 0!==window.YT&&void 0!==window.YT.Player?u():(p.push(u),f||(f="true",g(),setTimeout(h,100)))}function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"video/mp4",o=s()(document.createElement("video")).attr({controls:"",preload:"auto",poster:""});return null!=t&&o.attr("width",t),null!=n&&o.attr("height",n),s()(document.createElement("source")).attr({src:e,type:r}).appendTo(o),o}function b(e){"0px"===e.css("width")&&null==e.css("float")||"none"===e.css("float")?e.css({width:"640px",height:"400px","max-width":"90%"}):e.css({width:"320px",height:"240px"})}function w(e){function t(e,t){var n=t.width(),r=t.height(),o=s()(document.createElement("div")).addClass("videodiv").css({width:n,height:r}).appendTo(t);return s()(document.createElement("iframe")).attr({frameborder:"0",webkitAllowFullScreen:"",mozallowfullscreen:"",allowFullScreen:""}).css({width:n,height:r}).appendTo(o).attr("src",e.trim()),o}e.find(".youtubeplaceholder").each(function(){var e=s()(this);if(void 0===e.attr("id")){var n="YTP_"+l++;e.attr("id",n);var r=e.attr("src");b(e),Object(o.k)(r)?m("#"+n,r):Object(o.j)(r)?function(e,n){t(Object(u.default)("http://player.vimeo.com/video")+"/"+Object(o.d)(e),n).addClass("bw-vimeo-wrapper")}(r,s()("#"+n)):Object(o.i)(r)?function(e,n){t(Object(u.default)("http://giphy.com/embed")+"/"+Object(o.c)(e),n).addClass("bw-giphy-wrapper")}(r,s()("#"+n)):console.error("Unsupported video URL: "+r)}})}},21:function(e,t,n){function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=n(73).default,a=n(15).map;e.exports=function(e,t){var n={},s=t.Deferred();function u(){var e=".";return window.WidgetResourceBase?window.WidgetResourceBase:(0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?e=window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets":window.location.host.startsWith("widgets-eu.")&&(e=window.location.host.replace("widgets-eu.","//widget-assets-eu.")),e)}function c(e){return function e(n,r){if("string"==typeof n)return n.replace(/\$RESOURCEDIR/g,r);if(t.isArray(n)){for(var i=[],a=0;a<n.length;++a)i.push(e(n[a],r));return i}if("object"===o(n)){var s={};for(var u in n)n.hasOwnProperty(u)&&(s[u]=e(n[u],r));return s}return n}(e,u())}return i().then(function(r){var i=function(e){var n=function e(n){if("string"==typeof n)return function(e){for(var t="",n=0;n<e.length;++n)2*n<e.length?t+=e.charAt(2*n):t+=e.charAt(2*(e.length-n)-1);return t}(n);if(t.isArray(n)){for(var r=[],i=0;i<n.length;++i)r.push(e(n[i]));return r}if("object"===o(n)){var a={};for(var s in n)n.hasOwnProperty(s)&&(a[s]=e(n[s]));return a}return n}(e);return n=c(n)}(r);for(var a in i)n[a]=i[a];e(n),s.resolve(n)}),{fixResourcePaths:c,extractOnlineResources:function(e){if("."===u())return[];try{return function e(n,i,s){var u=[];if("string"==typeof n)n.startsWith(i)?u.push({resource:n,type:"full",path:s}):(u.push.apply(u,r(a(r(n.matchAll(new RegExp("(')("+i+"[^']+)'","g"))),function(e){return{resource:e[2],type:e[1],path:s}}))),u.push.apply(u,r(a(r(n.matchAll(new RegExp('(")('+i+'[^"]+)"',"g"))),function(e){return{resource:e[2],type:e[1],path:s}}))));else if(t.isArray(n))for(var c=0;c<n.length;++c)u.push.apply(u,r(e(n[c],i,s+"/"+c)));else if("object"===o(n))for(var l in n)n.hasOwnProperty(l)&&u.push.apply(u,r(e(n[l],i,s+"/"+l)));return u}(e,u(),"")}catch(e){return console.error("Could not extract resources: ",e),[]}},getConfig:function(){return s},getConfigSync:function(){return n}}}(n(74),n(0))},22:function(e,t,n){var r=n(11);e.exports=function(e,t){function n(n,r,o,i,a){a=a||a+" custom_alert",o=o||e("Ok"),r=r||"Alert",n=n||"No Message to Display";var s=t(document.createElement("div")),u={};return u[o]=function(){t(this).dialog("close"),t(this).remove(),i&&i()},s.safeHtml(n).dialog({title:r,dialogClass:"bw-dialog no-close "+a,resizable:!1,modal:!0,width:"auto",buttons:u}),s}return{showAlert:n,navigateAlert:function(e,r,o,i){var a=n(e,r,o,function(){});return a.parent().find("button").replaceWith(t(document.createElement("a")).safeHtml(o).attr({href:i,target:"_top"}).addClass("ui-button")),a},showCriticalAlert:function(e,r){var o={message:e,title:r};function i(){n(o.message,o.title)}0===t("#critical-alert-button").length&&t(document.createElement("div")).attr("id","critical-alert-button").addClass("bw-toolbutton").append(t(document.createElement("div")).addClass("bw-icon bw-icon-critical-error")).prependTo(t("#title-toolbar")).click(i),i()},showFatalAlert:function(e,n){t(document.createElement("div")).safeHtml(e).dialog({title:n,dialogClass:"bw-dialog no-close",resizable:!1,modal:!0,width:"auto"})},showConfirmationDialog:function(e,n,o,i,a,s,u){n||(n="Please confirm"),e||(e=""),a||(a="OK"),s||(s="Cancel"),t("#BwConfirmationDalog").remove();var c=t(document.createElement("div")).attr("id","BwConfirmationDialog"),l={};return l[a]=function(){t(this).dialog("close"),t(this).remove(),o&&o()},l[s]=function(){t(this).dialog("close"),t(this).remove(),i&&i()},c.safeHtml(e).dialog({title:n,dialogClass:r("bw-dialog BwConfirmationDialog no-close",u&&"bw-confirmation-warning"),open:function(){t(this).parent().find(".ui-dialog-buttonpane button:eq(1)").focus()},resizable:!1,modal:!0,width:500,buttons:l}),c},showInfoMessage:function(e){console.log("ShowInfoMessage");var n=t(document.createElement("div"));function r(){n.removeClass("bw-dialog-animate-in").addClass("bw-dialog-animate-out"),setTimeout(function(){n.remove()},500)}n.safeHtml(e).addClass("bw-dialog bw-info-dialog bw-dialog-animate-in").click(function(e){e.stopPropagation(),r()}).appendTo(t("body")),setTimeout(r,1e4)}}}(n(18),n(0))},23:function(e,t,n){"use strict";function r(e){var t="file:";window&&window.location&&window.location.protocol&&(t=window.location.protocol);var n="";return 0===e.indexOf("http://")?n="http://":0===e.indexOf("https://")?n="https://":0===e.indexOf("//")&&(n="//"),""!==n?"file:"===t?"//"===n?"http:"+e:e:"http:"===t?"//"===n?"http:"+e:e:"https:"===t&&"http://"===n?e.replace("http://","https://"):"//"===n?"https:"+e:e:e}n.r(t),n.d(t,"default",function(){return r})},231:function(e,t,n){n(232),n(233);var r=n(32),o=n(0);e.exports={createRewardWord:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t||""===t)return{show:function(){},adjustPosition:function(){},hide:function(){}};var i=o(document.createElement("div")).attr("id","reward").safeHtml(t).appendTo(e).makeButton().click(function(){i.hide()}),a=null!=n&&""!==n?r.addElement(n,o("body")):null;function s(){i.offset({top:(i.parent().outerHeight()-i.outerHeight())/2,left:(i.parent().outerWidth()-i.outerWidth())/2})}return null!=a&&i.append(o(document.createElement("div")).makeButton("play").addClass("playbtn bw-icon bw-icon-music-play-3").click(function(e){e.preventDefault(),e.stopPropagation(),a.toggle(),o(this).removeClass("click-me")})),s(),{show:function(){if(i.show(),s(),i.addClass("animated bounceIn"),null!=a){var e=a.play();null!=e&&e.catch(function(e){i.find(".playbtn").addClass("click-me")})}},hide:function(){i.hide(),i.removeClass("animated bounceIn"),null!=a&&(a.pause(),a.rewind())},adjustPosition:s}}}},232:function(e,t,n){},233:function(e,t,n){},25:function(e,t,n){var r,o,i,a,s,u=n(33).loadJS;e.exports=(r=n(21),o=n(5),i=n(0),a=n(41),s={},window.BWMATH=s,s.disabled=!1,s.nextUniqueId=1,s.queue=[],s.customCssClasses=[],s.initialized=!1,s.initialize=function(){if(!1===this.initialized&&-1!==o.getPlatform().indexOf("chrome")){var e=i(document.createElement("div")).attr("id","chromemathjaxhack").css({position:"absolute","pointer-events":"none"}).prependTo(i("body")),t=i(document.createElement("canvas")).attr({width:300,height:300}).appendTo(e)[0];t.getContext("2d").clearRect(0,0,t.width,t.height),this.initialized=!0}},s.prepare=function(e){if(this.disabled)return e;var t="",n=0,r=e.indexOf("$$"),o=0;for(r>=0&&this.initialize();r>=0&&!(++o>1e4);){t+=e.substring(n,r);var i=e.indexOf("$$",r+2);if(i<0){n=r;break}t+='<span class="bwmathquill" style="direction:ltr; visibility: hidden">\\('+e.substring(r+2,i)+"\\)</span>",n=i+2,r=e.indexOf("$$",n)}return t+=e.substring(n)},s._createCssClass=function(e,t){var n=document.createElement("style");n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),(n.sheet||{}).insertRule?n.sheet.insertRule("."+e+"{"+t+"}",0):(n.styleSheet||n.sheet).addRule(e,t),s.customCssClasses.push(e)},s._copyColorToStrokeAndFill=function(e){var t=e.css("color");e.find("g[stroke]").attr("stroke",null).attr("fill",null);var n="bw-math-jax-expression-"+s.nextUniqueId++,r="stroke: "+t+"; fill: "+t+";";s._createCssClass(n,r),e.addClass(n)},s.schedule=function(e){void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")?window.MathJax.Hub.Queue(e):s.queue.push({cb:e})},s.findMathElems=function(e){return e.find(".bwmathquill")},s.allMathElems=function(){return i(".bwmathquill")},s.processMathElems=function(e){var t=this.findMathElems(e);return t.length>0&&(this.process(t),!0)},s.redrawMathElems=function(e){this.redraw(this.findMathElems(e))},s.processAll=function(){this.process(this.allMathElems())},s.redrawAll=function(){this.redraw(this.allMathElems())},s.process=function(e){this.disabled||e.each(function(){if(void 0!==window.MathJax&&window.MathJax.hasOwnProperty("Hub")&&window.MathJax.Hub.hasOwnProperty("Queue")){var e=this;window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub,e],function(){s._copyColorToStrokeAndFill(i(e)),i(e).css("visibility","")})}else s.queue.push({obj:i(this)})})},s.processqueue=function(){for(;s.queue.length>0;){var e=s.queue.shift();e.obj&&s.process(e.obj),e.cb&&s.schedule(e.cb)}},window.MathJax={showMathMenu:!1,skipStartupTypeset:!0},"ibw-platform-win32-preview"==o.getPlatform()&&(window.MathJax.SVG={scale:200}),s.loadMathJax=function(){u("external/MathJax24/MathJax.js?config=TeX-AMS-MML_SVG").then(s.processqueue.bind(s))},s.widgetUsesLatex=function(e){return e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("MathJax24")},s.scheduleOrExecuteIfNoLatex=function(e){r.getConfig().then(function(t){s.widgetUsesLatex(t)?s.schedule(e):e()})},r.getConfig().then(function(e){s.widgetUsesLatex(e)?s.loadMathJax():s.disabled=!0}),s.redraw=function(e){},a.CssUpdateCallbacks&&a.CssUpdateCallbacks.push(function(){var e=s.customCssClasses;s.customCssClasses=[];for(var t=0;t<e.length;++t){var n=e[t],r=i("."+n);r.removeClass(n),s._copyColorToStrokeAndFill(r)}}),s.isOnlyMath=function(e){var t=e.trim();return t.startsWith("$$")&&t.endsWith("$$")&&-1===t.substring(2,e.length-4).indexOf("$$")},s)},27:function(e,t,n){"use strict";n.d(t,"i",function(){return c}),n.d(t,"d",function(){return p}),n.d(t,"c",function(){return g}),n.d(t,"g",function(){return m}),n.d(t,"f",function(){return b}),n.d(t,"b",function(){return _}),n.d(t,"o",function(){return k}),n.d(t,"n",function(){return x}),n.d(t,"l",function(){return I}),n.d(t,"m",function(){return T}),n.d(t,"h",function(){return F}),n.d(t,"e",function(){return B}),n.d(t,"a",function(){return P}),n.d(t,"k",function(){return N}),n.d(t,"j",function(){return L});var r=n(40),o=n.n(r),i=n(6);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var u=new o.a,c=function(e){return!!(e&&e.length>=1)},l=function(e,t){var n=s(e);return n[t]||(n[t]=[]),n},d=function(e,t,n){var r=s(e);return r=function(e,t,n){var r=s(e);return r[n]||(r=l(r,n)),r[n][t]||(r[n]=s(e[n]),r[n][t]={x:t,y:n}),r}(r=l(r,n),t,n)},f=function(e,t){return"V"===e.dir?{x:parseInt(e.x),y:parseInt(e.y)+t}:{x:parseInt(e.x)+t,y:parseInt(e.y)}},p=function(e){var t=[],n={H:[],V:[]},r=1;return e&&e.forEach(function(e,o){var i={direction:e.dir,coords:[],description:e.description,id:o},a=h(t,parseInt(e.x),parseInt(e.y));a&&a.number?i.number=a.number:(t=d(t,parseInt(e.x),parseInt(e.y)),(a=h(t,parseInt(e.x),parseInt(e.y)))&&(a.number=r,t=y(t,parseInt(e.x),parseInt(e.y),a)),i.number=r,r++),u.splitGraphemes(e.word).forEach(function(n,r){var o=f(e,r);t=d(t,o.x,o.y),i.coords.push(o)}),t=A(t,parseInt(e.x),parseInt(e.y),"firstOfWord",!0),n[e.dir].push(i)}),{wordlist:n,crosswordArray:t}},g=function(e){var t=[];return e&&e.forEach(function(e){u.splitGraphemes(e.word).forEach(function(n,r){var o=f(e,r);t=d(t,o.x,o.y),t=A(t,o.x,o.y,"letter",n)})}),t},h=function(e,t,n){return e[n]?Object.assign({},e[n][t]):void 0},m=function(e){if(e)return[].concat(s(e.V?e.V:[]),s(e.H?e.H:[])).find(function(e){return e.selected})},v=function(e,t){return function(e){return u.splitGraphemes(e.word).map(function(t,n){return f(e,n)})}(t).map(function(t){return h(e,t.x,t.y)})},b=function(e,t){return v(e,t).map(function(e){return(null==e?void 0:e.letter)||" "}).join("")},w=function(e,t){return function(e){return e?e.map(function(e,t){var n={direction:e.dir,coords:[],description:e.description,id:t};return u.splitGraphemes(e.word).forEach(function(t,r){var o=f(e,r);n.coords.push(o)}),n}):[]}(t).filter(function(t){return!t.coords.some(function(t){var n=h(e,t.x,t.y);return void 0===(null==n?void 0:n.letter)||""===n.letter})})},y=function(e,t,n,r){var o=s(e);return o[n]&&o[n][t]||(o=d(o,t,n)),o[n][t]=r,o},D=function(e,t){var n=Object.assign({},e);return Object.keys(e).forEach(function(r){e[r].forEach(function(e){n=function(e,t,n){var r=s(e[t.direction]);return r=r.map(function(e){if(e&&e.id===t.id){var r=Object.assign({},t);return delete r[n],r}return e}),Object.assign(Object.assign({},e),a({},t.direction,r))}(n,e,t)})}),n},C=function(e,t,n,r){var o=s(e[t.direction]);return o=o.map(function(e){return e&&e.id===t.id?Object.assign(Object.assign({},e),a({},n,r)):e}),Object.assign(Object.assign({},e),a({},t.direction,o))},E=function(e,t){var n=s(e);return e.forEach(function(r){r.forEach(function(r){r&&r[t]&&(n=function(e,t,n,r){var o=s(e);if(o[n]&&o[n][t]){var i=Object.assign({},o[n][t]);delete i[r],o[n][t]=i}return o}(e,r.x,r.y,t))})}),n},A=function(e,t,n,r,o){var i=s(e);return i[n]&&i[n][t]?i[n][t][r]=o:(i=d(i,t,n))[n][t][r]=o,i},_=function(e,t){var n=D(e,"selected");n=D(n,"unclear");var r=E(t,"selected");return r=E(r,"unclear"),{wordlist:n,crosswordArray:r=E(r,"hasInput")}},S=function(e,t,n){var r=s(e);return t.coords.forEach(function(e){r=A(r,e.x,e.y,n,!0)}),r},k=function(e,t,n){var r=_(e,t),o=r.wordlist,i=r.crosswordArray;return o=C(o,n,"selected",!0),i=S(i,n,"selected"),O(o,i,n)},x=function(e,t,n){var r=_(e,t),o=r.wordlist,i=r.crosswordArray,a=function(e,t){return[].concat(s(e.H),s(e.V)).filter(function(e){return e.coords.filter(function(e){return e.x===t.x&&e.y===t.y}).length>0})}(e,n);return 1===a.length?(o=C(o,a[0],"selected",!0),i=S(i,a[0],"selected"),O(o,t,a[0])):(a.length>1&&a.forEach(function(e){o=C(o,e,"unclear",!0),o=C(o,e,"selected",!0),i=S(i,e,"unclear")}),{wordlist:o,crosswordArray:i})},O=function(e,t,n){var r=E(s(t),"hasInput"),o=D(Object.assign({},e),"inputIndex"),i=n.coords[0];return r=A(r,i.x,i.y,"hasInput",!0),o=C(o,n,"selected",!0),{wordlist:o=C(o,n,"inputIndex",0),crosswordArray:r}},I=function(e,t){var n=m(e),r=s(t),o=Object.assign({},e);if(n&&n.selected&&void 0!==n.inputIndex){var i=n.inputIndex,a=n.coords[i+1];a&&(o=D(Object.assign({},o),"inputIndex"),r=E(s(r),"hasInput"),r=A(r,a.x,a.y,"hasInput",!0),o=C(o,n,"inputIndex",i+1)),i+1===n.coords.length&&(o=C(o,n,"inputIndex",i+1))}return{wordlist:o,crosswordArray:r}},T=function(e,t,n){var r=m(e),o=s(t),i=Object.assign({},e);if(r&&r.selected&&void 0!==r.inputIndex&&r.inputIndex<r.coords.length&&1===n.length){var a=r.coords[r.inputIndex];o=A(o,a.x,a.y,"letter",n)}return{wordlist:i,crosswordArray:o}},F=function(e,t){var n=function(e,t){var n=m(e),r=s(t),o=Object.assign({},e);if(n&&n.selected&&void 0!==n.inputIndex){var i=n.inputIndex;if(i>0){var a=n.coords[i-1];a&&(o=D(Object.assign({},o),"inputIndex"),r=E(s(r),"hasInput"),r=A(r,a.x,a.y,"hasInput",!0),o=C(o,n,"inputIndex",i-1))}}return{wordlist:o,crosswordArray:r}}(e,t),r=n.wordlist,o=n.crosswordArray,i=m(r);if(i&&i.selected&&void 0!==i.inputIndex){var a=i.coords[i.inputIndex];o=A(o,a.x,a.y,"letter",void 0)}return{wordlist:r,crosswordArray:o}},B=function(e){return e.map(function(e){return e.filter(function(e){return e}).map(function(e){return{x:e.x,y:e.y,letter:e.letter}}).filter(function(e){return void 0!==e.letter&&null!=e.letter})}).filter(function(e){return e}).reduce(function(e,t){return e.concat(t)})},P=function(e,t){return!e.some(function(e){var n;return void 0===(null===(n=h(t,e.x,e.y))||void 0===n?void 0:n.x)})},N=function(e,t){var n=s(e);return t.forEach(function(e){e.letter&&(n=A(n,e.x,e.y,"letter",e.letter))}),n},L=function(e,t,n){var r=g(t),o=e.map(function(e){return e?e.map(function(e){var t=Object.assign({},e);if(e&&(e.x||0===e.x)&&(e.y||0===e.y)){var o=h(r,e.x,e.y),a=Object(i.matchesOneOfAnswers)(e.letter,null==o?void 0:o.letter,n);t.isCorrect=a}return t}):e});return w(e,t).forEach(function(e){e.coords.forEach(function(e){o=A(o,e.x,e.y,"isCompleteWord",!0)})}),o}},28:function(e,t){e.exports=function(){var e={0:"debug",1:"info",2:"error"};function t(t,n,r){return n>=r?function(){!function(t,n,r){var o=Array.prototype.slice.call(r);o.unshift(t+" ("+e[n]+"):"),console.log.apply(console,o)}(t,n,arguments)}:function(){}}return{DEBUG:0,INFO:1,ERROR:2,createLogger:function(e,n){return void 0===n&&(n=1),{debug:t(e,0,n),info:t(e,1,n),error:t(e,2,n)}}}}()},29:function(e,t,n){"use strict";n.r(t),n.d(t,"process",function(){return l}),n.d(t,"isEmptyRichText",function(){return d});var r=n(48),o=n(49),i=n(0),a=n.n(i),s=n(43),u=(n(77),n(20)),c=n(4);function l(e){e.addClass("bw-richtext"),r.processRichTextImages(e),o.processRichTextWidgetPlayLinks(e,!0),function(e){e.find("video").each(function(){Object(u.adjustRichTextVideoSize)(a()(this))})}(e),function(e){e.find("a.rtlink").each(function(){var e=a()(this),t=e.attr("target");!1!==t&&void 0!==t||e.attr("target","_top")})}(e),function(e){e.find(".iframeplaceholder").each(function(){var e=a()(this),t=e.attr("src");e.replaceWith(a()(document.createElement("iframe")).addClass("rt-iframe").attr("src",t))})}(e),Object(s.processEmbeddedIframes)(e.find(".rt-iframe")),function(e){e.find("table").addClass("bw-richtext-table").each(function(){var e=this.parentNode,t=document.createElement("div");t.style.overflowX="scroll",e.insertBefore(t,this),t.appendChild(this)})}(e)}function d(e){return null==e||(""===e.trim()||-1===e.indexOf("img")&&-1===e.indexOf("audio")&&-1===e.indexOf("iframe")&&-1===e.indexOf("video")&&-1===e.indexOf("src=")&&""===Object(c.appSafeUnescape)(e).trim())}},30:function(e,t,n){e.exports={DialogWrapper:"_1REoWBm7O1Lv3dqYWAojMJ",Dialog:"_2dLXcKIj7-JZALkC3G3xB6",DialogBody:"_1yB6efsB9CUVFYsupNL_CE",DialogCloseButton:"_3LHyUPySjNQLuoBOX9mQae"}},32:function(e,t,n){n(78);var r,o,i,a=n(33),s=a.loadJS,u=a.loadCSS;e.exports=(r=n(21),o=n(0),i={},window.BWAUDIO=i,i.loaded=!1,i.queue=[],i.elementqueue=[],i.process=function(e){!0===i.loaded?0===e.find(".mejs-container.mejs-audio").length&&e.mediaelementplayer({enableKeyboard:!1}):i.queue.push(e)},i.createElement=function(e){var t={play:function(e){if(void 0===this.element)return!1;var t;try{return e&&(t=this.element,this.element.addEventListener("playing",function n(){t.removeEventListener("playing",n),e()})),this.element.play()}catch(e){return null}},pause:function(){if(void 0===this.element)return!1;try{return this.element.pause(),!0}catch(e){return!1}},paused:function(){return void 0!==this.element&&this.element.paused},toggle:function(){void 0!==this.paused()&&!0===this.paused()?this.play():this.pause()},rewind:function(){if(void 0===this.element)return!1;try{return this.element.setCurrentTime(0),!0}catch(e){return!1}},setVolume:function(e){if(void 0===this.element)return!1;try{return this.element.setVolume(e),!0}catch(e){return!1}},on:function(e,t){if(void 0===this.element)return!1;try{return this.element.addEventListener(e,t),!0}catch(e){return!1}},onLoaded:function(e){this.element?e():this.onLoadedCB=e}};return t.obj=e,!0===i.loaded?t.element=new window.MediaElement(e,{startVolume:1}):i.elementqueue.push(t),t},i.createPlayer=function(e,t){if(t){var n=o(document.createElement("div")).addClass("audiowrapper");return o(document.createElement("div")).addClass("audio-placeholder").attr("data-src",e).appendTo(n),n}n=o(document.createElement("div")).addClass("audiowrapper");var r=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",e)).appendTo(n);return i.process(r),n},i.replaceAudioByPlaceholder=function(e){var t=this;o(e).find(":not(.audiowrapper) > audio:not(.no-audio-wrap)").each(function(){var e=o(this),n=e.find("source").attr("src");e.replaceWith(t.createPlayer(n,!0))})},i.processAudioTags=function(e){e instanceof o?i.process(e.find(":not(.mejs-mediaelement) > audio:not(.no-audio-wrap)")):i.process(o(e+" audio"))},i.replacePlaceholders=function(e){o(e).find("div.audio-placeholder").each(function(){var e=o(document.createElement("audio")).attr("controls","").append(o(document.createElement("source")).attr("src",o(this).attr("data-src"))).insertAfter(o(this));i.process(e)})},i.removeAudioElements=function(){o("audio:not(.no-audio-wrap), .mejs-container.mejs-audio").remove()},i.processqueue=function(){for(i.loaded=!0;i.queue.length>0;){var e=i.queue.shift();i.process(e)}for(;i.elementqueue.length>0;){var t=i.elementqueue.shift();t.element=new window.MediaElement(t.obj,{startVolume:1}),t.onLoadedCB&&t.onLoadedCB(t)}},i.loadMediaElement=function(){u("external/mediaelement/css/mediaelementplayer.min.css"),s("external/mediaelement/js/mediaelement-and-player.min.js").then(i.processqueue.bind(i))},i.addElement=function(e,t){var n=o(document.createElement("audio")).append(o(document.createElement("source")).attr("src",e)).appendTo(t);return i.createElement(n[0])},r.getConfig().then(function(e){e.hasOwnProperty("modules")&&-1!==e.modules.indexOf("bwaudio")&&i.loadMediaElement()}),i)},33:function(e,t,n){"use strict";n.r(t),n.d(t,"adaptWidgetLoadPath",function(){return s}),n.d(t,"loadJS",function(){return u}),n.d(t,"loadCSS",function(){return c});var r=n(0),o=n.n(r),i=n(5);function a(e){if(window.WidgetParams){if(e&&window.WidgetParams.externalRootURL)return window.WidgetParams.externalRootURL;if(window.WidgetParams.rootURL)return window.WidgetParams.rootURL}return Object(i.isWebPreview)()||window.location.protocol.startsWith("http")&&null!=window.bwshortcode?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/",window.location.pathname.lastIndexOf("/")-1)):window.location.protocol.startsWith("http")&&null==window.bwshortcode?window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/")):""}function s(e,t){return e.startsWith("../")?a(t)+e.substring(2):e.startsWith("http://")||e.startsWith("https://")?e:window.WidgetParams&&window.WidgetParams.rootURL?a(t)+"/"+e:e}function u(e,t,n){e=s(e);var r=o.a.Deferred(),i=document.createElement("script");if(i.setAttribute("type","text/javascript"),n)for(var a in n)n.hasOwnProperty(a)&&i.setAttribute(a,n[a]);return i.onload=function(){r.resolve()},i.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),r.reject()},i.setAttribute("src",e),document.getElementsByTagName(t||"head")[0].appendChild(i),r}function c(e,t){e=s(e);var n=o.a.Deferred(),r=document.createElement("link");return r.setAttribute("rel","stylesheet"),r.setAttribute("type","text/css"),r.onload=function(){n.resolve(r)},r.onerror=function(){window.navigator&&window.navigator.userAgent&&-1===window.navigator.userAgent.indexOf("PhantomJS")&&-1===window.navigator.userAgent.indexOf("HeadlessChrome")&&console.error("Could not load: "+e),n.reject()},r.setAttribute("href",e),document.getElementsByTagName(t||"head")[0].appendChild(r),n}window.adaptWidgetLoadPath=s},336:function(e,t,n){e.exports=function(e,t){function n(t,n){for(var r=t.find("span"),o=0;o<r.length;++o){if(e(r[o]).width()>n)return!1}return!0}function r(t,n,r,o,i){for(var a=e(document.createElement("div")).css({position:"absolute",top:"0px",left:"0px",width:o}),s=r;s>n;s-=i){for(var u=e(document.createElement("div")).css("font-size",s+"px").attr("size",s),c=0;c<t.length;++c)e(document.createElement("span")).text(t[c]).appendTo(u),u.append(" ");u.appendTo(a)}return a}function o(t,r,o,i){for(var a=r,s=t.find("div"),u=0;u<s.length;++u){var c=e(s[u]);if(!(c.height()>i)&&n(c,o)){a=c.attr("size");break}}return parseInt(a)}return{scaleToBox:function(t,n,i,a,s,u){for(var c=parseInt(Math.sqrt(a-i-1))+1,l=e(document.createElement("div")).addClass(n).css({"border-width":"0px",padding:"0px"}),d=[],f=[],p=0;p<t.length;++p){var g=e(t[p]).text().split(" ").filter(function(e){return 0!==e.length});d.push(g);var h=r(g,i,a,s,c);f.push(h),h.appendTo(l)}l.appendTo("body");var m=[];for(p=0;p<t.length;++p)m.push(o(f[p],i,s,u));for(l.remove(),f=[],l=e(document.createElement("div")).addClass(n),p=0;p<t.length;++p)h=r(d[p],m[p],Math.min(m[p]+c-1,a),s,1),f.push(h),h.appendTo(l);l.appendTo("body");var v=[];for(p=0;p<t.length;++p)v.push(o(f[p],m[p],s,u));for(p=0;p<t.length;++p)e(t[p]).css("font-size",v[p]+"px");l.remove()},scaleMathToBox:function(n,r,o){console.log("scaling maths to: ",r,o,n.length);for(var i=0;i<n.length;++i){var a=e(n[i]);(u=t.findMathElems(a)).css("font-size","")}var s=[];for(i=0;i<n.length;++i){a=e(n[i]);var u=t.findMathElems(a),c=Math.max(u.width(),1),l=Math.max(u.height(),1);s.push(Math.min(100*r/c,100*o/l))}for(console.log(s),i=0;i<n.length;++i)a=e(n[i]),(u=t.findMathElems(a)).css("font-size",parseInt(s[i])+"%")}}}(n(0),n(25))},34:function(e,t,n){"use strict";n.r(t),n.d(t,"createRandomSeed",function(){return r}),n.d(t,"shuffleArray",function(){return i}),n.d(t,"randomIndexList",function(){return a}),n.d(t,"randomId",function(){return u}),Math.imul||(Math.imul=function(e,t){var n=(4194303&e)*(t|=0);return 4290772992
/*!== 0*/&e&&(n+=(4290772992&e)*t|0),0|n});var r=function(e){for(var t=1779033703^e.length,n=0;n<e.length;n++)t=(t=Math.imul(t^e.charCodeAt(n),3432918353))<<13|t>>>19;return function(){return t=Math.imul(t^t>>>16,2246822507),t=Math.imul(t^t>>>13,3266489909),(t^=t>>>16)>>>0}}((new Date).toLocaleString()+Math.random());function o(e){return e=e||r(),t=e,function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296};var t}function i(e,t){var n=o(t);return e.sort(function(){return.5-n()})}function a(e,t){for(var n=[],r=0;r<e;++r)n.push(r);return i(n,t)}var s={};function u(e){for(;;){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));if(!s.hasOwnProperty(t))return s[t]=!0,t}}},35:function(e,t,n){"use strict";n.r(t),n.d(t,"isRTL",function(){return o}),n.d(t,"setAutoDirection",function(){return i}),n.d(t,"isRtlOrRtlMixed",function(){return a}),n.d(t,"isUseMixedTextDirection",function(){return s}),n.d(t,"setAutoDirectionIfRequired",function(){return u});var r=n(4);function o(e){for(var t=[],n=new RegExp("^[֐-׾؀-۾܀-ݎݐ-ݾހ-޾߀-߾ࠀ-࠾ࡀ-࡞ࢠ-ࣾऀ-ॾ]|\ud802[\udf60-\udf7e]+$"),r=1,o=0;o<=r;o++)if(t[o]=e.substring(o-1,o),/\s/.test(t[o])&&r++,n.test(t[o]))return!0;return!1}function i(e,t,n){null==t?t=e.text():n&&(t=Object(r.appSafeUnescape)(t)),t.length>0?o(t)?e.css("direction","rtl"):e.css("direction","ltr"):console.log("setAutoDirection: no text")}function a(e){return null!=e&&e.startsWith("right-to-left")}function s(e){return null!=e&&e.endsWith("mixed")}function u(e,t,n,r){s(t)&&i(e,n,r)}},37:function(e,t,n){"use strict";n.d(t,"a",function(){return v});var r=n(1),o=n.n(r),i=n(0),a=n.n(i),s=n(29),u=n(35),c=n(25),l=n(20),d=n(32);function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return!t||"object"!==f(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var v=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,h(t).apply(this,arguments))}var n,r,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(t,o.a.PureComponent),n=t,(r=[{key:"setWrapperDivRef",value:function(e){if(null!=e){var t=a()(e);t.safeHtml(c.prepare(this.props.text)),l.resolveYoutubePlaceholders(t),s.process(t),c.processMathElems(t),d.processAudioTags(t),this.props.direction&&Object(u.setAutoDirectionIfRequired)(this.props.directionSelector?t.find(this.props.directionSelector):t,this.props.direction)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.onClick,r=e.style;return o.a.createElement("div",{className:t,onClick:n,style:r,ref:this.setWrapperDivRef.bind(this)})}}])&&p(n.prototype,r),i&&p(n,i),t}()},39:function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return d});var r=n(1),o=n.n(r),i=n(11),a=n.n(i),s=n(7),u=n(30),c=n.n(u);function l(e){var t=e.title,n=e.children,r=e.OK,i=e.onOk,u=e.Cancel,l=e.onCancel,d=e.onClose,f=e.className;return o.a.createElement("div",{className:a()("bw-centered bw-row-container ui-dialog ui-widget ui-widget-content ui-corner-all bw-dialog",c.a.Dialog,f)},o.a.createElement("div",{className:"bw-row-fixed ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"},o.a.createElement("span",{className:"i-dialog-title",id:"ui-dialog-title-1"},t)),d&&o.a.createElement("button",{className:c.a.DialogCloseButton,onClick:d,"aria-label":Object(s.b)("Cancel")},"×"),o.a.createElement("div",{className:a()("bw-row-expanding ui-dialog-content ui-widget-content",c.a.DialogBody)},n),o.a.createElement("div",{className:"bw-row-fixed ui-dialog-buttonpane"},o.a.createElement("div",{className:"ui-dialog-buttonset"},l&&o.a.createElement("button",{className:"ui-button ui-widget ui-state-default ui-button-text-only",onClick:l},o.a.createElement("span",{className:"ui-button-text"},u)),o.a.createElement("button",{className:"ui-button ui-widget ui-state-default ui-button-text-only",onClick:i},o.a.createElement("span",{className:"ui-button-text"},r||Object(s.b)("OK"))))))}function d(e){var t=e.children;return o.a.createElement("div",{className:a()("bw-centering-container",c.a.DialogWrapper)},t)}},4:function(e,t,n){"use strict";n.r(t),n.d(t,"MATCH_TYPE_WORD",function(){return d}),n.d(t,"MATCH_TYPE_PIC",function(){return f}),n.d(t,"MATCH_TYPE_AUDIO",function(){return p}),n.d(t,"isDefined",function(){return g}),n.d(t,"safeArray",function(){return h}),n.d(t,"safeString",function(){return m}),n.d(t,"appSafeUnescape",function(){return v}),n.d(t,"arrayContains",function(){return b}),n.d(t,"removeNonNumbers",function(){return w}),n.d(t,"isMatchDistractor",function(){return y}),n.d(t,"matchElemId",function(){return D}),n.d(t,"questionTableSplitRow",function(){return C}),n.d(t,"questionTableRowQuestion",function(){return E}),n.d(t,"questionTableRowAnswer",function(){return A}),n.d(t,"questionTableRowAnswers",function(){return _}),n.d(t,"numericGetMatrixElem",function(){return S}),n.d(t,"BCE_YES_LABEL",function(){return k}),n.d(t,"BCE_NO_LABEL",function(){return x}),n.d(t,"bceBalancedLabelToYesNo",function(){return O}),n.d(t,"bceCreateTableData",function(){return I}),n.d(t,"bceReactantsEditableFields",function(){return T}),n.d(t,"bceProductsEditableFields",function(){return F}),n.d(t,"bceFormatQuestion",function(){return P}),n.d(t,"getDateString",function(){return N});var r=n(64),o=n.n(r),i=n(26),a=n.n(i),s=n(10),u=n(9),c=n(0),l=n.n(c),d=0,f=1,p=2;function g(e){return null!=e&&((!a()(e)||""!==e.trim())&&(o()(e)&&console.log("isDefined returns true for ",e),!0))}function h(e){return null==e?[]:e}function m(e){return null==e?"":e}function v(e){return l()(document.createElement("div")).safeHtml(e).text()}function b(e,t){return-1!==e.indexOf(t)}function w(e){return e.replace(/\D/g," ")}function y(e,t){return t===f?null==e.sources||0===e.sources.length:""===e}function D(e,t,n){return e===d?t:e===f?Object(s.pictureId)(t):e===p?n+"":(console.error("Invalid element type: ",e),0)}function C(e,t){return e.rows[t].split(/##/)}function E(e,t){return C(e,t)[0].trim()}function A(e,t){var n=C(e,t);return n.length>1?n[1].trim():null}function _(e,t){for(var n=C(e,t),r=[],o=1;o<n.length;++o)r.push(n[o].trim());return r}function S(e,t,n){if(null==e)return null;if(e.length<=t)return null;var r=e[t].split(" ");return r.length<=n?null:r[n]}var k="Yes, this equation is balanced",x="No, this equation is not balanced";function O(e,t){return null==e||""===e?"":"yes"===e||"no"===e?e:e===(t=t||function(e){return e})(k)?"yes":"no"}function I(e,t){var n,r=[];switch(t){case"none":break;case"all":r=function(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n}(0,e.length-1);break;case"odd":for(n=1;n<e.length;n+=2)r.push(n);break;case"even":for(n=0;n<e.length;n+=2)r.push(n)}var o={values:[],layout:{rows:[],columns:[{width:100},{width:100}]},answers:[]};for(n=0;n<e.length;++n){var i="readonly",a=""+e[n].qty;r.length>0&&n===r[0]&&(i="checked",r.shift()),o.values.push([{value:e[n].atom,CellRole:"readonly"},{value:a,CellRole:i}]),o.layout.rows.push({height:30}),o.answers.push(""+e[n].qty)}return o}function T(e){return"type1"===e?"none":"odd"}function F(e){return"type1"===e?"all":"even"}function B(e,t,n){for(var r=[],o=0;o<e.length;++o)n?r.push("<span class='nowrap'>_____ $$"+e[o].formula+"$$</span>"):t?r.push("<span class='nowrap bce-field empty'><input type='text' /> $$"+e[o].formula+"$$</span>"):r.push("<span class='nowrap'>$$"+e[o]+"$$</span>");return r}function P(e,t){var n=u.parseEquation(e.Equation),r="type3"===e.SubType,o=u.formatEquation(n,r||t),i="";return i+=B(o.reactants,r,t).join("$$\\, + \\,$$"),i+=" <span class='nowrap'>$$\\: \\rightarrow \\:$$</span> ",i+=B(o.products,r,t).join("$$\\, + \\,$$")}function N(){var e=new Date,t=e.getDate(),n=e.getMonth()+1,r=e.getYear();return r<1900&&(r+=1900),(1===n?"January":2===n?"February":3===n?"March":4===n?"April":5===n?"May":6===n?"June":7===n?"July":8===n?"August":9===n?"September":10===n?"October":11===n?"November":"December")+" "+t+", "+r}},41:function(e,t){e.exports=function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]()}return{executeCssUpdateCallbacks:t,CssUpdateCallbacks:e,updateConfigCSS:function(e){for(var n=document.getElementsByTagName("link"),r=0,o=n.length;r<o;r++){var i=n[r],a=i.rel;if("string"!=typeof a||0===a.length||"stylesheet"===a){var s=i.getAttribute("href");0===s.indexOf("config")&&-1!==s.indexOf(".css")&&(i.setAttribute("href","config"+e+".css"),setTimeout(t,100))}}},addAllDesignInfo:function(){void 0!==window.addAllDesignInfo&&window.addAllDesignInfo()},addCSSUpdateCallback:function(t){e.push(t)}}}()},419:function(e,t,n){n(69);var r=(0,n(106).createDefaultContext)(),o=r.widgetstorage,i=r.StudentWorkSubmitter,a=n(82);e.exports=function(e,t,n,r,s,u,c,l,d,f,p){var g,h=e.getConfigSync(),m={tries:0,reset:function(){this.tries=0},addTry:function(){this.tries++},get:function(){return{tries:this.tries}},set:function(e){this.tries=e.tries}},v=p();return{create:function(e,p,b,w,y){for(var D=h.pairs||[],C=D.length,E=[],A=0;A<D.length;++A){var _=D[A];"TextText"===_.Type?(E.push({pair:A,img:_.card_1,type:"text",language:h.t2s_language_1}),E.push({pair:A,img:""===_.card_2?_.card_1:_.card_2,type:"text",language:h.t2s_language_2})):"ImageText"===_.Type?(E.push({pair:A,img:_.card_1,type:"image",language:h.t2s_language_2}),E.push({pair:A,img:""===_.card_2?_.card_1.origbase:_.card_2,type:"text",language:h.t2s_language_1})):"ImageImage"===_.Type&&(E.push({pair:A,img:_.card_1,type:"image",language:h.t2s_language_1}),E.push({pair:A,img:""===_.card_2.origbase?_.card_1:_.card_2,type:"image",language:h.t2s_language_2})),console.log("added pair")}function S(e,t,r){a.whenVoiceAvailable(t,function(){n(document.createElement("div")).addClass("speech_button bw-centering-container").makeButton(s("Play audio")).tapOrClick(function(e){var o=this;e.preventDefault(),e.stopPropagation(),n("body").addClass("disableevents"),setTimeout(function(){n("body").removeClass("disableevents")},500),a.speak(t,r,{onstart:function(){n(o).addClass("pound")},onend:function(){n(o).removeClass("pound")}})}).append(n(document.createElement("div")).addClass("bw-icon bw-icon-music-play-3 bw-centered")).appendTo(e)})}!function(){for(var e=E.length;e;){var t=Math.floor(Math.random()*e),n=E[--e];E[e]=E[t],E[t]=n}}();var k=[];for(A=0;A<E.length;++A)k.push(n(document.createElement("td")).append(e(E[A].pair,E[A].img,E[A].type,A,E[A].language,S)));function x(e,t,r){var o=function(e,t,n){for(var r=1,o=1;r*o<n;)e/(o+1)>t/(r+1)?++o*(r-1)>=n&&--r:++r;return r}(t,r,2*C),i=Math.ceil(2*C/o);n("#bottom-container table").remove();for(var a=n(document.createElement("table")).addClass("cardtable").appendTo("#bottom-container"),s=-Math.floor((o*i-E.length)/2),u=0;u<o;++u)for(var c=n(document.createElement("tr")).appendTo(a),l=0;l<i;++l)s>=0&&s<E.length?c.append(e[s]):c.append(n(document.createElement("td"))),++s;return{colcount:i,rowcount:o}}x(k,n("#bottom-container").width(),n("#bottom-container").height()),t.processAll();var O=[16,84,273,146,56,341,325,170,511,365,455,186,130,48,68,257,466,151,121,316,191,506,251,446,473,500,311,95,447,255,507,510,495,487,493,367,463],I=[{key:64,x:0,y:0},{key:128,x:1,y:0},{key:256,x:2,y:0},{key:8,x:0,y:1},{key:16,x:1,y:1},{key:32,x:2,y:1},{key:1,x:0,y:2},{key:2,x:1,y:2},{key:4,x:2,y:2}];function T(){n(".card.imagecard").each(function(){var e=n(this),t=e.width(),r=e.hasClass("done")?10:0,o=t-2*r;e.find(".back").css({width:o,height:o,left:r,top:r})})}function F(e,t){var r=function(e){for(var t=O[e],n=[],r=0;r<I.length;++r){var o=I[r];t&o.key&&n.push('<circle cx="'+(10*o.x+5)+'" cy="'+(10*o.y+5)+'" r="4"/>')}return'<svg class="symbol" xmlns="http://www.w3.org/2000/svg" version="1.1">'+n.join("")+"</svg>"}(t);n(r).appendTo(e)}var B="0_flipped";function P(){n(".card").removeClass("flipped").removeClass("done").removeClass("shadow"),n(".cardtable").removeClass("alldone"),n(".symbol").remove(),T(),m.reset(),g.hide()}function N(){P(),window.saveMemoryGame(),v.restart()}function L(){console.log("resizing..."),u.centerTitle(!0);var e=n("body").width(),t=n("#bottom-container").height(),r=[];n("td").each(function(){var e=n(this);e.is(":empty")||r.push(e.detach())});var o=x(r,e,t),i=parseInt(n(".card").css("margin-left"));console.log("margin = "+i);var a=(e-2*i)/o.colcount-2*i,s=(t-2*i)/o.rowcount-2*i,c=a>s?s:a;console.log("cardsize = "+c),n(".card").css({width:c,height:c}),T();var l=b();"yes"===h["autoscale-text"]&&(f.scaleToBox(n(".textcard:not(.hasmath)"),"card",8,30,l.width,l.height),f.scaleMathToBox(n(".textcard.hasmath.onlymath"),l.width-4,l.height-4)),n(".cardtable").css({left:(n("#bottom-container").width()-n(".cardtable").width())/2,top:(n("#bottom-container").height()-n(".cardtable").height())/2}),g.adjustPosition(),y&&y(c)}n(".card").makeButton().tapOrClick(function(){var e=n(this);e.hasClass("debouncing")||e.hasClass("done")||(function(e){e.addClass("debouncing"),setTimeout(function(){e.removeClass("debouncing")},250)}(e),"0_flipped"===B?e.hasClass("flipped")?(e.removeClass("flipped"),console.error("Problem... this should not be possible...")):(e.addClass("flipped"),B="1_flipped"):"1_flipped"===B?e.hasClass("flipped")?(e.removeClass("flipped"),B="0_flipped"):(e.addClass("flipped"),B="2_flipped",m.addTry(),function(){var e=n(".card.flipped");if(2==e.length){var t=n(e[0]).data("pairid");t==n(e[1]).data("pairid")&&(e.addClass("done"),"COLSYMS"==h["show-matches-using"]&&F(e,t),T(),p(e)),window.saveMemoryGame();var r=n(".card").length,o=n(".card.done").length;v.setProgress(o,r)}}()):"2_flipped"==B&&(n(".card").removeClass("flipped"),B="0_flipped",e.hasClass("flipped")?(e.removeClass("flipped"),console.log("Problem... this should not be possible...")):(e.addClass("flipped"),B="1_flipped")),t.redrawAll())}),g=d.createRewardWord(n("#bottom-container"),h.rewardWord,h.rewardAudio),n("#clearbutton").makeButton(s("Clear and restart")).tapOrClick(function(){r.showConfirmationDialog(s("All cards will be cleared, this can not be undone. Are you sure?"),s("Clear the cards and start over?"),N,null,s("Yes, clear"),s("No, keep"))}),window.onresize=L,L(),t.schedule(L),window.saveMemoryGame=function(){if("yes"===h.save_answers){var e=[];n(".done").each(function(){e.push(n(this).data("pairid"))});var t={pairs:e,score:m.get()};o.write(JSON.stringify(t))}},o.init({type:w,group:""==h.book_title?"_no_name_":h.book_title,name:h.title,id:h.uuid2,updateCallback:function(e){if(P(),"yes"===h.save_answers&&null!==e&&""!=e){var r,o=JSON.parse(e);console.log(o),Array.isArray(o)?(r=o,m.reset()):(r=o.pairs,m.set(o.score));for(var i=0;i<r.length;++i){var a=n(".pair_"+r[i]);a.addClass("done").addClass("shadow"),"COLSYMS"==h["show-matches-using"]&&F(a,r[i])}T()}0==n(".card:not(.done)").length&&n(".cardtable").addClass("alldone"),t.redrawAll()},singleKey:!0,extension:"."+w}),T(),c({config:h,defaultName:"PairGame",getAnswers:function(){var e=D.length,t=n(".done").length/2,r=[],o=[],i={};n(".done").each(function(){i[n(this).data("pairid")]=!0});for(var a=0;a<D.length;++a){var u=D[a];if(i.hasOwnProperty(a+"")){switch(u.Type){case"TextText":r.push(l.createPairAnswer(u.card_1,void 0,u.card_2,void 0));break;case"ImageText":r.push(l.createPairAnswer(u.card_1.origbase,u.card_1.filename,u.card_2,void 0));break;case"ImageImage":r.push(l.createPairAnswer(u.card_1.origbase,u.card_1.filename,""!==u.card_2.origbase?u.card_2.origbase:u.card_1.origbase,""!==u.card_2.origbase?u.card_2.filename:u.card_1.filename))}o.push(1)}else{switch(u.Type){case"TextText":r.push(l.createPairAnswer(u.card_1,void 0,"",void 0));break;case"ImageText":case"ImageImage":r.push(l.createPairAnswer(u.card_1.origbase,u.card_1.filename,"",void 0))}o.push(-1)}}return[{answer:r,annotatedtable:'<br><span style="font-weight: normal">'+s("Number of tries")+": "+m.tries+"<span><br>",question:h.title,score:t,outof:e,correctness:o,nr_of_tries:m.tries,config:{Type:"PicturePictureMatch"}}]},submitSuccessMessage:s("Your answers were sent successfully!"),submitFailedTitle:s("Your answers could not be sent."),submitFailedMessage:s("Unable to send answers. Make sure you're connected to the internet."),sendDialogMessage:s("Complete the form and click send to submit your answers to your teacher."),shareDialogMessage:s("Complete the form and click send to email your answers.")},i,r)},setAllDone:function(){n(".cardtable").addClass("alldone"),v.registerQuantity("tries",s("Number of tries"),m.tries),g.show()}}}(n(21),n(25),n(0),n(22),n(18),n(42),n(169),n(80),n(231),n(336),n(105).default)},42:function(e,t,n){var r=n(15).isEmpty,o=n(45).valueOrCacheValue,i=n(76),a=i.instructionsAreEmpty,s=i.prepareInfoPopup,u=i.showInfoPopup;e.exports=function(e,t,n,i,c,l,d,f,p,g,h,m){function v(e){if(-1===e.indexOf("?"))return e;var t=/^([^?]*)\?/.exec(e);if(t&&2===t.length)return t[1];throw Error("Shoudln't happen")}function b(e,t){if(r(t))return e;var n=v(e),o=[];return d.each(t,function(e,t){o.push(e+"="+t)}),n+"?"+o.join("&")}function w(){var e=t.getUrlParams(window.location.href);return{backlink:e.hasOwnProperty("backlink")?o(e.backlink):null,backbutton:e.hasOwnProperty("backbutton")?o(e.backbutton):null}}function y(){var t=w().backlink,n=e.getPlatform();if("ibw-platform-osx-preview"===n||"ibw-platform-win32-preview"===n)console.log("Moving back by using history.back()"),window.history.back();else{var r=window.location.origin;t.startsWith(r)&&(t=t.substr(r.length)),console.log("Moving back by setting window.location to: "+t),window.location=t}}function D(){var e=w(),t=e.backlink,n=e.backbutton;null!=t&&(null!=n?d(document.createElement("div")).addClass("widget-backlink widget-backlink-text").safeHtml("&#9664; ").text(n).appendTo(d("body")):d(document.createElement("div")).addClass("widget-backlink widget-backlink-icon").appendTo(d("body"))).click(y)}var C=!1;function E(e){if(!C){var t=d("#top-container"),n=t.height(),r=t.width(),o=d(".closebutton-container"),i=d("#top-container .bw-toolbar");o.css("min-width",""),i.css("min-width","");var a=o.width(),s=i.width();if(i.css("min-width",a),o.css("min-width",s),d(".title-container").css("max-width",r-2*Math.max(a,s)),!0!==e&&d("#top-container").height()!==n){C=!0;try{window.onresize&&window.onresize()}catch(e){console.error("Error when calling onResize during centerWidgetTitle"),console.error(e)}C=!1}}}function A(){d("#top-container").removeClass("bw-show-popup-menu"),d("#title-toolbar").appendTo(d("#top-container .bw-toolbar")),d(".bw-menu-overlay").remove()}function _(){if(!(d("#menubutton").length>0)){var e=d("#top-container .bw-toolbar");if(e.children(":not(.outside-popup)").length>1){e.removeClass("bw-toolbar");var t=d(document.createElement("div")).addClass("bw-toolbar").appendTo(d(".titlebar-layout"));e.find(".outside-popup").each(function(){d(this).appendTo(t)}),e.appendTo(t).addClass("bw-button-group"),d(document.createElement("div")).attr("id","menubutton").addClass("bw-toolbutton").append(d(document.createElement("div")).addClass("bw-icon bw-icon-menu")).makeButton(l("Menu")).tapOrClick(function(){d("#top-container").hasClass("bw-show-popup-menu")?A():setTimeout(function(){d("#top-container").addClass("bw-show-popup-menu");var e=d(document.createElement("div")).addClass("bw-menu-overlay").appendTo("#container");setTimeout(function(){e.on("click touchend",function(){setTimeout(A,500)})},350),d("#title-toolbar").appendTo(e)},100)}).appendTo(t)}}}function S(e,t,n){var r=d(e),o=d(document.createElement("div")).attr("id","container").prependTo(r).addClass("top-bottom-layout"),i=d(document.createElement("div")).attr("id","top-container").appendTo(o).addClass("top-container"),a=d(document.createElement("div")).appendTo(i).addClass("titlebar-layout");return d(document.createElement("div")).addClass("closebutton-container").appendTo(a),d(document.createElement("div")).addClass("title-container").append(d(document.createElement("span")).attr("id","title")).appendTo(a),n?d(n).addClass("bw-toolbar").appendTo(a):d(document.createElement("div")).attr("id","title-toolbar").addClass("bw-toolbar").appendTo(a),_(),d(t).appendTo(o).addClass("bottom-container"),E(),o}function k(){var t=d(document.createElement("div")).addClass("bw-debug-window bw-row-container").appendTo("body"),n=d(document.createElement("div")).addClass("bw-debug-output bw-row-resizing").appendTo(t);function r(e){e.appendTo(n),n[0].scrollTop=n[0].scrollHeight-n[0].getBoundingClientRect().height}function o(e){for(var t=[],n=0;n<e.length;++n)t.push(JSON.stringify(e[n]));return t.join(" ")}d(document.createElement("div")).addClass("bw-debug-close").text("X").tapOrClick(function(){t.remove(),localStorage.removeItem("bw-debug-enabled")}).appendTo(t),console.log=function(){r(d(document.createElement("p")).safeHtml(o(arguments)))},console.error=function(e,t){r(d(document.createElement("p")).css("color","red").safeHtml(o(arguments)))},window.onerror=function(e,t,n){return r(d(document.createElement("p")).attr("style","color: red").safeHtml(e+" ("+t+":"+n+")")),!0},console.log(e.getPlatform(),navigator.platform,navigator.userAgent,window.innerWidth,window.innerHeight);var i=d(document.createElement("input")).addClass("bw-debug-input bw-row-fixed").appendTo(t),a=[],s=0;i.keypress(function(e){var t,n;13===(e.keyCode?e.keyCode:e.which)&&(t=i.val(),n=t.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"'),console.log((0,eval)(n)),a.push(n),s=a.length,i.val(""))}),i.keydown(function(e){var t=e.keyCode?e.keyCode:e.which;38===t?s>0&&(--s,i.val(a[s])):40===t&&s<a.length&&(++s===a.length?i.val(""):i.val(a[s]))});try{t.draggable()}catch(e){console.error("No drag support")}}function x(e){var t=0;e.clickOrHold(function(){t=0},function(){3==++t&&(function(){if(!(d(".bw-debug-window").length>0)){var e=d(document.createElement("div")).addClass("bw-debug-wrapper").appendTo("body"),t=d(document.createElement("div")).addClass("bw-debug-dialog").appendTo(e);d(document.createElement("p")).text("Enter your support key:").appendTo(t);var n=d(document.createElement("input")).attr("placeholder","key").appendTo(t);d(document.createElement("br")).appendTo(t),d(document.createElement("button")).attr("type","button").text("Cancel").tapOrClick(function(){e.remove()}).appendTo(t),d(document.createElement("button")).attr("type","button").text("OK").tapOrClick(function(){"bw-magic"===n.val()&&(k(),e.remove(),localStorage.setItem("bw-debug-enabled","true"))}).appendTo(t)}}(),t=0)},2e3);try{"true"===localStorage.getItem("bw-debug-enabled")&&k()}catch(e){}}return d(function(){var t=e.getPlatform(),n=d("html");n.hasClass("ibw-platform-custom")||n.addClass(t)}),window.custom_alert=c.showAlert,window.criticalAlert=c.showCriticalAlert,window.bw_confirmation_dialog=c.showConfirmationDialog,window.tr=l,window.getUrlParams=t.getUrlParams,window.getNakedURL=v,window.setQueryParameters=b,window.createLabeledCheckbox=f.createLabeledCheckbox,window.createProgressBar=f.createProgressBar,window.createSimpleCheckbox=f.createSimpleCheckbox,window.createNumberButtons=f.createNumberButtons,window.createSimpleRadiobutton=f.createSimpleRadiobutton,window.createLabeledRadiobutton=f.createLabeledRadiobutton,window.createProgressCircle=f.createProgressCircle,window.URIEncodeImage=p,window.BWAdaptToPageProtocol=h,window.updateConfigCSS=g.updateConfigCSS,{makeWidget:function(t){t=t||{},function(){if("ibw-platform-osx-ibooks"===e.getPlatform()){var t=["html.ibw-platform-osx-ibooks, .ibw-platform-osx-ibooks .bw-popup-zoomable-image {","width: "+window.innerWidth+"px;","height: "+window.innerHeight+"px;","}"],n=document.createElement("style");n.id="osx_ibooks_workaround",n.type="text/css",n.appendChild(document.createTextNode(t.join("\n"))),document.head.appendChild(n)}}(),s(t.instructions),a(t.instructions)||"title_layout"!==t.layout||(t.layout="title_toolbar_layout");var n=d("body");n.addClass("bw"),t.hasOwnProperty("no-user-select")&&!0===t["no-user-select"]&&n.addClass("no-user-select");var r,o=t.layout||"";if("title_layout"===o?(r=S("body","#bottom-container")).find(".top-container").addClass("title-only"):"title_overlay_layout"===o?((r=S("body","#bottom-container")).addClass("title-overlay"),r.find(".top-container").addClass("title-only")):r="title_toolbar_layout"===o?S("body","#bottom-container","#title-toolbar"):d("#container"),t.hasOwnProperty("title")&&""!==t.title){var i=r.find("#title");i.safeHtml(t.title),x(i)}else{var c=r.find(".top-container");c.addClass("title-empty"),x(c)}"ibw-platform-ipad-ibooks-epub"===e.getPlatform()&&(t.hasOwnProperty("epubBlockTouchEndCheck")||(t.epubBlockTouchEndCheck=function(e){return e.srcElement instanceof SVGElement||d(e.srcElement).hasClass("epub-block")}),document.addEventListener("touchend",function(e){var n=d(window).width();(e.layerX<50||n-e.layerX<50||t.epubBlockTouchEndCheck(e))&&e.preventDefault()},!1),t.hasOwnProperty("epubBlockTouchStartCheck")&&document.addEventListener("touchstart",function(e){t.epubBlockTouchStartCheck(e)&&e.preventDefault()},!1)),D(),u(t.instructions)},getNakedURL:v,setQueryParameters:b,prependToTitleToolbar:function(e){var t=d("#title-toolbar");e.prependTo(t),_(),E()},centerTitle:E,getBacklinkInfo:w,moveBackToPreviousWidget:y,ShowBacklinkIfRequired:D}}(n(5),n(13),n(79),n(65),n(22),n(18),n(0),n(55),n(57),n(41),n(23).default,n(67))},43:function(e,t,n){"use strict";n.r(t),n.d(t,"processEmbeddedIframes",function(){return d}),n.d(t,"hasIframeConfiguration",function(){return f}),n.d(t,"createIframe",function(){return p});var r=n(20),o=n(0),i=n.n(o),a=n(23),s=n(4),u=n(52);function c(e){var t=["allow-downloads","allow-forms","allow-modals","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-same-origin","allow-scripts","allow-top-navigation-by-user-activation"];null!=document.hasStorageAccess&&t.push("allow-storage-access-by-user-activation");try{e.attr({allow:"microphone; camera",sandbox:t.join(" ")})}catch(e){console.log()}}function l(e){e.attr("src").toLowerCase().endsWith("mp4")?function(e){e.replaceWith(r.createHtml5VideoPlayer(e.attr("src")))}(e):(c(e),e.attr("src",e.attr("src")))}function d(e){e.each(function(){l(i()(this))})}function f(e){return null!=e.url&&""!==e.url&&"I have a URL"===e.linktype||null!=e.iframe_embed_code&&""!==e.iframe_embed_code&&"I have an iframe embed code"===e.linktype}function p(e,t){var n;if(null==(n="I have a URL"===e.linktype?e.url:Object(u.default)(Object(s.appSafeUnescape)(e.iframe_embed_code)))||""===n)return null;var r={};null!=e.width&&""!==e.width&&(r.width=e.width),null!=e.height&&""!==e.height&&(r.height=e.height);var o=i()(document.createElement("iframe")).attr(r).appendTo(t);return c(o),o.safeAttr("src",Object(a.default)(n)),d(o),o}},44:function(e,t,n){var r,o,i;e.exports=(r=n(13),o=r.getParameters(),i=!!o.lti_authenticated,{isLTI:function(){return!!o.lti||!!o.lti_version},isEmbeddedLTI:function(){return!!o.lti_version},isEmbeddedLTIAuthenticated:function(){return i},setEmbeddedLTIAuthenticated:function(){i=!0,null==window.WidgetParams&&r.updateWindowQueryParameter("lti_authenticated","1")}})},45:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceParamsBySessionLink",function(){return a}),n.d(t,"valueOrCacheValue",function(){return s});var r=n(2),o=n.n(r),i=["backbutton","backlink","q"];function a(e){if(""===e)return e;if("undefined"==typeof sessionStorage)return e;var t=e.substring(1).split("&"),n="cache_"+(new Date).getTime()+"_";return"?"+o()(t,function(e){for(var t=0;t<i.length;++t)if(e.startsWith(i[t]+"=")&&!e.startsWith(i[t]+"=cache_")){var r=n+t;return sessionStorage.setItem(r,decodeURIComponent(e.substring(i[t].length+1))),i[t]+"="+r}return e}).join("&")}function s(e){return null==e?e:e.startsWith("cache_")?sessionStorage.getItem(e):e}},47:function(e,t){e.exports={BWDS_ERROR_INTERNAL:0,BWDS_ERROR_UNKNOWN:1,BWDS_ERROR_UNAVAILABLE:2,BWDS_ERROR_WRONG_ATTRIB:3,BWDS_ERROR_FULL:4,BWDS_ERROR_SECURITY:5}},48:function(e,t,n){e.exports=function(e){return{getImageSize:function(e,t){var n=new window.Image;n.onload=function(){var e=this.width,n=this.height;t(e,n)},n.onerror=function(){t()},n.src=e},processRichTextImages:function(t){t.find("img").attr({height:"",draggable:"false"}).css("max-width","100%").each(function(){var t=e(this),n=t.css("float");"left"===n?t.css({"margin-right":"10px","margin-bottom":"10px"}):"right"===n&&t.css({"margin-left":"10px","margin-bottom":"10px"})})},calculateScaleAndOffset:function(e,t,n,r,o){var i,a,s,u,c,l;return"Cover entire area, keep aspect ratio"===e?((c=t/r)<(l=n/o)?(i=l,a=l):(i=c,a=c),s=(t-r*i)/2,u=(n-o*a)/2):"Contain entire picture, keep aspect ratio"===e?((c=t/r)>(l=n/o)?(i=l,a=l):(i=c,a=c),s=(t-r*i)/2,u=(n-o*a)/2):"Cover entire area with entire picture"===e?(s=0,u=0,i=t/r,a=n/o):(i=1,a=1,s=(t-r)/2,u=(n-o)/2),{scale_x:i,scale_y:a,offset_x:s,offset_y:u}}}}(n(0))},49:function(e,t,n){var r=n(45),o=r.valueOrCacheValue,i=r.replaceParamsBySessionLink,a=n(15);e.exports=function(e,t,n,r,s){function u(r,u){var c=e.getParameters();delete c.design,delete c.content,delete c.translation,delete c.sig,s.isEmbeddedLTIAuthenticated()&&(c.lti_authenticated=1);var l=n.getProviderId(),d=window.location.protocol+"//"+window.location.host+window.location.pathname+i(window.location.search);if(null==c.login_hint&&l&&""!==l&&(window.location.search.length>1?d+="&":d+="?",d+="login_hint="+encodeURIComponent(l)),d+=e.getHash(),""===r||"?"===r.charAt(0))return t.showAlert("The widget is not included.","Broken link"),r;function f(e){return-1===e.indexOf("?")?"?":"&"}if(u&&(r+=f(r)+"backlink="+encodeURIComponent(d),window.bwbackbuttonlabel&&(r+="&backbutton="+encodeURIComponent(window.bwbackbuttonlabel))),r.indexOf("/play/")>=0)c.q&&""!==c.q&&(r+=f(r)+function(e,t){if(null==e)return"";var n=a.isArray(t)?t:[t];return a.filter(e.split("&"),function(e){for(var t=0;t<n.length;++t)if(e.startsWith(n[t]+"="))return!1;return!0}).join("&")}(o(c.q),["context_id","backlink","backbutton"])),null!=c.toplevel&&(r+=f(r)+"toplevel="+encodeURIComponent(c.toplevel)),l&&""!==l&&(r+=f(r)+"login_hint="+encodeURIComponent(l));else{var p={},g={};for(var h in c)"sid"!==h&&c.hasOwnProperty(h)&&(e.LEGACY_HASH_PARAMETERS.indexOf(h)>=0?p[h]=c[h]:g[h]=c[h]);l&&""!==l&&(p.login_hint=l),Object.keys(g).length>0&&(r+=f(r)+e.urlencode(g)),Object.keys(p).length>0&&(r+="#"+e.urlencode(p))}return r}function c(e,t,n){if(console.log("Widget link: "+e),e=u(e,t),n){var o=r(n.target),i=0===o.length?{left:0,top:0}:o.offset(),a=o.clone();r("body").append(a),a.css({position:"absolute",left:i.left+"px",top:i.top+"px",width:o.width()+"px",height:o.height()+"px","border-left":o.css("border-left"),"border-right":o.css("border-right"),"border-top":o.css("border-top"),"border-bottom":o.css("border-bottom"),"border-top-left-radius":o.css("border-top-left-radius"),"border-top-right-radius":o.css("border-top-right-radius"),"border-bottom-left-radius":o.css("border-bottom-left-radius"),"border-bottom-right-radius":o.css("border-bottom-right-radius"),"-webkit-border-top-left-radius":o.css("-webkit-border-top-left-radius"),"-webkit-border-top-right-radius":o.css("-webkit-border-top-right-radius"),"-webkit-border-bottom-left-radius":o.css("-webkit-border-bottom-left-radius"),"-webkit-border-bottom-right-radius":o.css("-webkit-border-bottom-right-radius"),"box-shadow":o.css("box-shadow"),"-webkit-box-shadow":o.css("-webkit-box-shadow")});a.css({"-webkit-transition":"all .5s linear","-moz-transition":"all .5s linear","-o-transition":"all .5s linear",transition:"all .5s linear","box-sizing":"border-box"});var s=r(document).width(),c=r(document).height(),l=s/o.width(),d=c/o.height(),f=l>d?d:l,p="translate("+(s/2-i.left-o.width()/2)+"px, "+(c/2-i.top-o.height()/2)+"px) scale("+f+")";a.css({"-webkit-transform":p,"-moz-transform":p,"-o-transform":p,transform:p,opacity:.1}),setTimeout(function(){window.location=e},500),o.closest("span[onclick]").attr("onclick","")}else window.location=e}function l(e){return null!=e&&-1!==e.indexOf("bookwidgets.com/play/")}return{isWidgetPlayLink:l,openLinkOrWidgetLink:function(e,t,n){if(l(e)){var o=-1===e.indexOf("?")?"?":"&";c(e+=o+"noiframe=1",t)}else r().isSafeURLForNavigation(e)&&(n?(console.log("open link in new tab ",e),window.open(e,"_blank")):(console.log("open link in same tab ",e),top.location.href=e))},processRichTextWidgetPlayLinks:function(e,t){e.find("a").filter(function(){return l(r(this).attr("href"))}).each(function(){var e=r(this),n=e.attr("href");console.log("make link widget play link",n);var o=-1===n.indexOf("?")?"?":"&";n+=o+"noiframe=1",e.before(r(document.createElement("div")).css("display","inline-block").tapOrClick(function(){return c(n,t),!1}).safeHtml(e.html())),e.after("&nbsp;"),e.hide()})},openWidget:c,addLinkIcon:function(e){r(document.createElement("div")).addClass("link-icon").css({width:"24px",height:"24px",position:"absolute",top:"10px",right:"10px",opacity:"0.6",background:"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAAXNSR0IArs4c6QAAA+JJREFUeAHlm8tLIzEcx2Nb67M3wZsXb7uw91UPHv0f/AdEEEEEUUQQRBBE0a4PfKJWEV+IiIgUEfHmraxXBa/e3NvCbjbf2oiPTZv5zWRm0gn8GoyTmXw+ySTttGHsc/oqiqZF3Il4FsEtDzCABUxgU6ak+E9axB8RtkOr2g82MIL1XUJBVoSqYrmVg/WdhB8RgpediZHAKkTgvsiJiImIUvorYL/FxcuQiO9RIi+wovN/4wUz5JdCYdSyOwjAMpGKGnmB9xcEYFKIbEpQyJubm1ljY6NW1YoKOKYnav1cLseenzG4Sye5LGjnTU1N/P7+noc5tbW1afGQlr7Hx0fW3t7OHh4eSusN+REkAWAqFwlkAeUiwZWAcpDgWoDtEjwRYLMEzwTYKsFTATZK8FyAbRKMCLBJgjEBtkgwKsAGCcYFhF2CLwLeSnh6esKfxpP4pKp1Dd8EoDUdHR2soaFBq2F+HeSbgK6uLra4uMioDzhMCfFFQHd3N5ufnw8dPKQaF9DT08Pm5uZCCW9cQG9vL5udnTU1ej07r9azM3E1R8f19fUF+siwtbVVt73OwHRE9Pf3BwqPiwcmYGBgIHD4wAQMDg6GAj4QAcPDw6GB913AyMiI5/C3t7dcfO9APq9vc8Do6Ci5kaqKNzc3PJVKcTffQPkiYGxsTMVALr++vub19fWvSxhVgnEB4+PjZEhVxaurK15XV/cKL5dcigSjAiYmJlQM5PLLy0teW1v7CZ4qwZiAyclJMqSqYjabLQpPkdDS0qKUKc9XyPXfCU5NTakYyOUXFxe8pqZGt7HaE6PnAmZmZsiQqorn5+e8urpaG172nM6c4KmAdDqtYiCXn52d8aqqKsfwuhI8ESCe3nDxWZ4Mqap4enrqCl5HgmsBgBePsFQM5PKTkxOeTCbJPS/hZa66HVwJAPzS0hIZUlXx+PjYU/hiElwJ6OzsVDGQy4+OjnhlZaVnPS/hZf5xJLgS4PXwPzg44IlEwhj8/yS4EoATQsLy8jK5x2XFvb09X+A/SnAtQEpYXV2VLI7z3d1dHo/Hjfe8hJc5bgfxY07d6xZ/JxiLxfj6+rpj+O3t7UDgpQQHeXEBOBEkbG5uakvY2tqyBR6jpLQAKSGTyZSUsLGxkReme94QHKcnAA3F/byzs6OUsLa2Zhu8/giQPQUJmNw+ppWVlfzKIY+zKHe+NxBr+v7+/qsDvGvEsmkRtGxr/vf02DIjC7RzSDg8POQLCwu2woP1p4j8jkpt8LeyIMHSnpe809jOEeltcxgBSJHdOPmC/7KNNNJbZyECe2kxEiK5eRoCZMKcEJnt8/8AtqIJGXRoCukAAAAASUVORK5CYII=)","background-size":"cover"}).appendTo(e)},widgetCoverImage:function(e){return e?e.replace("/play/","/cover/"):null}}}(n(13),n(22),n(59),n(0),n(44))},5:function(e,t,n){e.exports=function(e){function t(){var e=window.navigator.userAgent,t=e.indexOf("OS ");return(e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1)&&t>-1?window.Number(e.substr(t+3,3).replace("_",".")):0}function n(){return window.BW_PLATFORM_HACK?window.BW_PLATFORM_HACK:"iPad"===navigator.platform||"iPhone"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-ipad-ibooks-epub":-1!==navigator.userAgent.indexOf("SEB")?"ibw-platform-ipad-seb":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-ipad-safari":-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-ipad-bookwidgets":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-ipad-ibooks":"ibw-platform-ipad":"MacIntel"===navigator.platform?void 0!==navigator.epubReadingSystem&&"iBooks"===navigator.epubReadingSystem.name?"ibw-platform-osx-ibooks-epub":-1!==navigator.userAgent.indexOf("PhantomJS")?"ibw-platform-osx-phantomjs":-1!==navigator.userAgent.indexOf("HeadlessChrome")?"ibw-platform-osx-headlesschrome":-1!==navigator.userAgent.indexOf("ibookwidgets")?"ibw-platform-osx-preview":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-osx-chrome":-1!==navigator.userAgent.indexOf("Safari")?"ibw-platform-osx-safari":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-osx-firefox":"http:"!==window.location.protocol&&"https:"!==window.location.protocol?"ibw-platform-osx-ibooks":"ibw-platform-osx":"Win32"===navigator.platform?-1!==navigator.userAgent.indexOf("BookWidgets")?"ibw-platform-win32-preview":"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Trident")||"Netscape"===navigator.appName&&-1!==navigator.userAgent.indexOf("Edge")?"ibw-platform-win32-ie":-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-win32-chrome":-1!==navigator.userAgent.indexOf("Firefox")?"ibw-platform-win32-firefox":"ibw-platform-win32":"iPad Simulator"===navigator.platform||"iPhone Simulator"===navigator.platform?"ibw-platform-ipad-bookwidgets":-1!==navigator.userAgent.indexOf("Android")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-android-chrome":"ibw-platform-android":-1!==navigator.userAgent.indexOf("CrOS")?-1!==navigator.userAgent.indexOf("Chrome")?"ibw-platform-chromebook-chrome":"ibw-platform-chromebook":"ibw-platform-unknown"}function r(){return-1!==n().indexOf("preview")}function o(){return"1"===e.getUrlParams(window.location.href).preview||window.WidgetParams&&window.WidgetParams.preview}function i(){var e=n();return 0===e.indexOf("ibw-platform-ipad")||0===e.indexOf("ibw-platform-android")}return{getPlatform:n,supportsAppFeature:function(e){var t=/BookWidgets\/([0-9]+)\.([0-9]+)\.([0-9]+)/g.exec(navigator.userAgent),n=t&&4===t.length?1e4*parseInt(t[1])+100*parseInt(t[2])+parseInt(t[3]):0;return console.log(e+" "+n),"audiorecording"===e&&n>=20800},isToolPreview:r,isWebPreview:o,isPreview:function(){return r()||o()},isTopLevelPlay:function(){return"1"===e.getUrlParams(window.location.href).toplevel},usesCredentialProxy:function(){return-1!==window.location.search.substring(1).indexOf("bwds-secure-proxy")},isAndroidIosDevice:i,isTouchDevice:function(){return i()||(t=" -webkit- -moz- -o- -ms- ".split(" "),"ontouchstart"in window||(e=["(",t.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(e).matches));var e,t},isIOS:function(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&/MacIntel/.test(navigator.platform)},isInternetExplorer:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||/rv:11.0/i.test(window.navigator.userAgent)},getIOSIBooksRestartInfo:function(){return t()>=7?'To close iBooks:<ol style="text-align: left;"><li>Double-click the Home button.</li><li>Swipe left or right until you have located iBooks.</li><li>Swipe the app\'s preview up to close it.</li></ol>':t()>=5?"To close iBooks:<ol style=\"text-align: left;\"><li>Double-click the Home button.</li><li>Touch-and-hold the iBooks icon to put it into 'jiggly mode'.</li><li>Tap the red minus-sign icon that appears at the top left corner of iBooks.</li><li>Click the Home button to exit 'jiggly mode'.</li></ol>":""},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}}}}(n(13))},50:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i,a;e.exports=(o=n(28).createLogger("CallbackBridge"),i=1,(a=function(){this.id=i++,this.listening=!1,this.nextCallbackID=1,this.callbacks={},this.handleMessage=this._handleMessage.bind(this)}).prototype.getMessagePrefix=function(){return"bw-CBBridge-"+this.id+"-"},a.prototype.startListening=function(){window.addEventListener("message",this.handleMessage)},a.prototype.stopListening=function(){window.removeEventListener("message",this.handleMessage)},a.prototype._handleMessage=function(e){var t=this.getMessagePrefix();"object"===r(e.data)&&"string"==typeof e.data.command&&e.data.command.substr(0,t.length)===t&&(e.data.hasOwnProperty("err")?this.processCallback(e.data.command,e.data.err,e.data.data):this.processCallback(e.data.command,e.data.arg))},a.prototype.registerCallbacks=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={ok:e,error:t},{ok:this.getMessagePrefix()+n+"-ok",error:this.getMessagePrefix()+n+"-error"}},a.prototype.registerCallback=function(e,t){var n=""+this.nextCallbackID++;return this.callbacks[n]={cb:e,singleshot:!t},this.getMessagePrefix()+n+"-cb"},a.prototype.processCallback=function(e,t,n){try{var r=e.match(/bw-CBBridge-.*-(.*)-(ok|error|cb)$/);if(r){var i,a=r[1],s=this.callbacks[a];return s?"cb"===r[2]?((i=s.cb)(t,n),void(s.singleshot&&delete this.callbacks[a])):(i="ok"===r[2]?s.ok:s.error,delete this.callbacks[a],void i(t)):void o.error("Cannot find callback with ID "+a+" Bridge "+this.id+this.callbacks)}o.error("Malformed callback: "+e)}catch(e){o.error(e)}},a)},51:function(e,t,n){"use strict";n.r(t),n.d(t,"isLetterRegexp",function(){return r}),n.d(t,"isLetter",function(){return o});var r=function(){try{return RegExp(/^\p{L}/,"u")}catch(e){return/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312E\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEA\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE83\uDE86-\uDE89\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0\uDFE1]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])/}}();function o(e){return null!=e.match(r)}},52:function(e,t,n){"use strict";n.r(t),t.default=function(e){if("undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)){e=e.replace(/&quot;/g,'"');var t=/src='([^']+)'/.exec(e);return t?t[1]:(t=/src="([^"]+)"/.exec(e))?t[1]:null}var n=(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").getElementsByTagName("iframe");return n.length>0?n[0].src:null}},53:function(e,t,n){e.exports={InstructionsDialog:"ATif7bfHOw26idmP24THn"}},55:function(e,t,n){e.exports=function(e,t){return{createLabeledCheckbox:function(t,n,r,o){var i=e(document.createElement("table")).addClass("bw-checkbox").appendTo(t),a=e(document.createElement("tr")).appendTo(i),s=e(document.createElement("td")).addClass("bw-checkbox-cell").appendTo(a);function u(){return null!=o&&o>0&&e(t).find("[role=checkbox][checked=checked]").length>=o}function c(){e(t).toggleClass("bw-check-limit-reached",u())}return e(document.createElement("div")).addClass("bw-checkbox-checkbox bw-icon bw-icon-accept").appendTo(s),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(a),i.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"}),c()}),i.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"}),c()}),i.makeButton({role:"checkbox"}).tapOrClick(function(){var t=e(this);if("disabled"!==t.attr("disabled"))if("checked"===t.attr("checked"))t.trigger("clear"),r&&r.call(t[0],!1);else{if(u())return;t.trigger("check"),r&&r.call(t[0],!0)}}),i.trigger("clear"),i},createProgressBar:function(t,n){var r={};r.parent=t,r.max=n,e(document.createElement("div")).addClass("bw-progress-bar").css("left","-100%").appendTo(e(t));var o=100/n;return e(document.createElement("div")).addClass("bw-progress-bar-marker").css({left:"-100%",width:o+"%"}).appendTo(e(t)),r.setProgress=function(n,r,o){r=r||400;var i=100*-(this.max-parseFloat(n))/this.max,a=e(this.parent+"> .bw-progress-bar"),s=e(t).width(),u=-(this.max-parseFloat(n))*s/this.max;a.css("left",a.css("left")),a.animate({left:u},r,"swing",function(){a.css("left",i+"%"),o&&o()})},r.setPosition=function(n,r){r=r||400;var o=e(this.parent+"> .bw-progress-bar-marker"),i=100*parseFloat(n)/this.max,a=e(t).width()*n/this.max;o.css("left",o.css("left")),o.animate({left:a},r,"swing",function(){o.css("left",i+"%")})},r.clear=function(){e(this.parent+" .bw-progress-bar").css("left","-100%"),e(this.parent+" .bw-progress-bar-marker").css("left","-100%")},r},createSimpleCheckbox:function(t,n,r,o,i){var a=e(document.createElement("div")).addClass("bw-simple-checkbox bw-icon bw-icon-accept").appendTo(e(t)),s={role:"checkbox"};function u(){return null!=i&&i>0&&e(o).find("[role=checkbox][checked=checked]").length>=i}function c(){e(o).toggleClass("bw-check-limit-reached",u())}return r&&(s.labelledby=r),a.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"}),c()}),a.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"}),c()}),a.makeButton(s).tapOrClick(function(){var t=e(this);if("disabled"!==t.attr("disabled"))if("checked"===t.attr("checked"))t.trigger("clear"),n&&n.call(t[0],!1);else{if(u())return;t.trigger("check"),n&&n.call(t[0],!0)}}),a.trigger("clear"),a},createNumberButtons:function(n,r,o,i,a){function s(t){if(e(".buttonslot").removeClass("selected"),r<=9)e("#BS_"+t).addClass("selected");else if(t<5){e("#BS_1").removeClass("hide_number"),e("#BS_7").addClass("hide_number");for(var n=1;n<8;++n)e("#BS_"+n).find(".number-button").safeHtml(n+1);e("#BS_"+t).addClass("selected")}else if(r-t<6){e("#BS_1").addClass("hide_number"),e("#BS_7").removeClass("hide_number");for(var o=2;o<8;++o)e("#BS_"+o).find(".number-button").safeHtml(r-8+o);e("#BS_"+(9-(r-t))).addClass("selected")}else{e("#BS_1").addClass("hide_number"),e("#BS_7").addClass("hide_number");for(var s=1;s<8;++s)e("#BS_"+s).find(".number-button").safeHtml(s+t-3);e("#BS_4").addClass("selected")}0===t?e(i).addClass("hidden"):e(i).removeClass("hidden"),t===r-1?e(a).addClass("hidden"):e(a).removeClass("hidden")}e(n).addClass("bw-column-container");for(var u=0,c=Math.min(r,9),l=e(n),d=0;d<c;++d)e(document.createElement("div")).addClass("buttonslot bw-column-resizing").attr("id","BS_"+d).append(e(document.createElement("div")).addClass("number-button bw-button").text(d+1)).appendTo(l).find(".number-button").makeButton().tapOrClick(function(){s(u=parseInt(e(this).safeHtml())-1),o(u)});function f(){--u<0&&(u=0),s(u),o(u)}function p(){++u>=r&&(u=r-1),s(u),o(u)}return r>9&&(e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_1")),e(document.createElement("div")).addClass("ellipsis").appendTo(e("#BS_7")),e("#BS_7").addClass("hide_number"),e("#BS_7").find(".number-button").safeHtml(r-1),e("#BS_8").find(".number-button").safeHtml(r)),e("#BS_0").addClass("selected"),e(i).addClass("hidden"),e(i).makeButton(t("previous")).tapOrClick(f),e(a).makeButton(t("next")).tapOrClick(p),{updateButtons:s,next:p,prev:f}},createSimpleRadiobutton:function(t,n,r){var o=e(document.createElement("div")).addClass("bw-simple-radiobutton bw-icon").appendTo(e(t));o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})});var i={role:"radio"};return r&&(i.labelledby=r),o.makeButton(i).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),n&&n.call(t[0],!1)):(t.trigger("check"),n&&n.call(t[0],!0)))}),o.trigger("clear"),o},createLabeledRadiobutton:function(t,n,r){var o=e(document.createElement("table")).addClass("bw-radiobutton").appendTo(t),i=e(document.createElement("tr")).appendTo(o),a=e(document.createElement("td")).addClass("bw-radiobutton-cell").appendTo(i);return e(document.createElement("div")).addClass("bw-radiobutton-radiobutton bw-icon bw-icon-largedot").appendTo(a),e(document.createElement("td")).addClass("bw-button-label-cell").append(e(document.createElement("div")).addClass("bw-button-label").safeHtml(n)).appendTo(i),o.bind("check",function(){e(this).attr({checked:"checked","aria-checked":"true"})}),o.bind("clear",function(){e(this).attr({checked:null,"aria-checked":"false"})}),o.makeButton({role:"radio"}).tapOrClick(function(){var t=e(this);"disabled"!==t.attr("disabled")&&("checked"===t.attr("checked")?(t.trigger("clear"),r&&r.call(t[0],!1)):(t.trigger("check"),r&&r.call(t[0],!0)))}),o.trigger("clear"),o},createProgressCircle:function(t,n,r){var o={},i=30,a=40,s=40;o.id=n,o.progress=Array(r);var u=e(document.createElement("div")).addClass("bw-progress-circle bw-centering-container").attr("id",n).appendTo(e(t));e(document.createElement("div")).addClass("bw-progress-circle-text bw-centered").appendTo(u);var c=[];function l(e,t){if(-1===e)return"";var n=2*Math.PI*e/r,o=2*Math.PI*(e+1)/r,i=a+Math.sin(n)*t,u=s-Math.cos(n)*t,c=a+Math.sin(o)*t,l=s-Math.cos(o)*t;return"M X1 Y1 A R R 0 0 1 X2 Y2".replace("X1",i).replace("Y1",u).replace("X2",c).replace("Y2",l).replace("D",n).replace("R",t).replace("R",t)}function d(e){return'<path d="'+l(e,i)+'"/>'}for(var f=0;f<r;++f)c.push(d(f));return e('<svg class="bw-progress-circle-drawing" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 80 80">'+c.join("")+'<path class="the marker"/></svg>').appendTo(u),o.setProgress=function(t,n){e("#"+this.id+" path:nth-child("+(t+1)+")").attr("class",n)},o.setTextAndPosition=function(t,n){var r=e("#"+this.id+" .bw-progress-circle-text");r.animate({opacity:0},200,"swing",function(){r.empty().append(t).animate({opacity:1},200)});var o=e("#"+this.id+" path.the.marker");o.animate({opacity:0},200,"swing",function(){o.attr("d",l(n,i)).animate({opacity:1},200)})},o}}}(n(0),n(18))},56:function(e,t){e.exports=window.$},57:function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return"string"==typeof(t=e)||"object"===n(t)&&t.constructor===String?0===e.indexOf("http://")||0===e.indexOf("https://")||0===e.indexOf("//")?e.replace(/\(/g,"_").replace(/\)/g,"_").replace(/'/g,"%27"):encodeURIComponent(e).replace(/%2F/g,"/").replace(/'/g,"%27"):"";var t}},59:function(e,t){var n;e.exports={_creds:n={username:null,userid:null,email:null,providerid:null,providerhumanid:null,provider:null,school:null,token:null,sid:null,coaccount:null},credentials:function(){return this._creds},clear:function(){this._creds=n},setCredentials:function(e){this._creds=e},getUserToken:function(){return this._creds.token},getUserSid:function(){return this._creds.sid},getUserName:function(){return this._creds.username},getUserClassName:function(){return this._creds.className},getUserId:function(){return this._creds.userid},getEmail:function(){return this._creds.email},getProviderId:function(){return this._creds.providerid},getProviderHumanId:function(){return this._creds.providerhumanid},isCoAccount:function(){return this._creds.coaccount}}},6:function(e,t,n){"use strict";n.r(t),n.d(t,"replaceBadQuotes",function(){return l}),n.d(t,"removeDiacritics",function(){return g}),n.d(t,"removePunctuationMarks",function(){return v}),n.d(t,"simplifyWhitespace",function(){return C}),n.d(t,"prepareForCompare",function(){return _}),n.d(t,"trimAll",function(){return k}),n.d(t,"matchesOneOfAnswers",function(){return x}),n.d(t,"createCaseSensitiveKeywordListMatchRegexpForNFKC",function(){return P});var r=n(2),o=n.n(r),i=n(16),a=n.n(i),s=n(51),u=n(40),c=n.n(u);function l(e){return e.replace(/[\u2018\u2019]/g,"'")}var d=[{base:"A",letters:"AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"BⒷＢḂḄḆɃƂƁ"},{base:"C",letters:"CⒸＣĆĈĊČÇḈƇȻꜾ"},{base:"D",letters:"DⒹＤḊĎḌḐḒḎĐƋƊƉꝹÐ"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ"},{base:"F",letters:"FⒻＦḞƑꝻ"},{base:"G",letters:"GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ"},{base:"H",letters:"HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"JⒿＪĴɈ"},{base:"K",letters:"KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"MⓂＭḾṀṂⱮƜ"},{base:"N",letters:"NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"OE",letters:"Œ"},{base:"oe",letters:"œ"},{base:"P",letters:"PⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"QⓆＱꝖꝘɊ"},{base:"R",letters:"RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"VⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"WⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"XⓍＸẊẌ"},{base:"Y",letters:"YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"bⓑｂḃḅḇƀƃɓ"},{base:"c",letters:"cⓒｃćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"dⓓｄḋďḍḑḓḏđƌɖɗꝺ"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ"},{base:"f",letters:"fⓕｆḟƒꝼ"},{base:"g",letters:"gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ"},{base:"h",letters:"hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"jⓙｊĵǰɉ"},{base:"k",letters:"kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"mⓜｍḿṁṃɱɯ"},{base:"n",letters:"nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ"},{base:"oi",letters:"ƣ"},{base:"ou",letters:"ȣ"},{base:"oo",letters:"ꝏ"},{base:"p",letters:"pⓟｐṕṗƥᵽꝑꝓꝕ"},{base:"q",letters:"qⓠｑɋꝗꝙ"},{base:"r",letters:"rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ"},{base:"t",letters:"tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"vⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"wⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"xⓧｘẋẍ"},{base:"y",letters:"yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"zⓩｚźẑżžẓẕƶȥɀⱬꝣ"}],f=null;var p=null;function g(e){return null==f&&(f=function(){for(var e={},t=0;t<d.length;t++)for(var n=d[t].letters,r=0;r<n.length;r++)e[n[r]]=d[t].base;return e}()),e.replace(/[\u0301\u0060]/gi,"").replace(/[^\u0000-\u007E]/g,function(e){return f[e]||e})}var h=/[!,-.:;?"'`()[\]{}\u2026\u2014]/g,m="[!,-.:;?\"'`()[\\]{}\\u2026\\u2014]*";function v(e){return e.replace(h,"")}var b=/\s+/g,w="\\s+",y=/ ([!,-.:;?"'`()[\]{}\u2026\u2014])/g,D=/([!,-.:;?"'`()[\]{}\u2026\u2014]) /g;function C(e){return e.replace(b," ").replace(y,"$1").replace(D,"$1")}var E="\\s+[!,-.:;?\"'`()[\\]{}\\u2026\\u2014\\s]*";function A(e){if("string"==typeof e||e instanceof String)switch(e){case"no":e={case:"1",accent:"0",white:"0",punct:"0"};break;case"yes_ignore_accents":e={case:"0",accent:"1",white:"0",punct:"0"};break;case"no_ignore_accents":e={case:"1",accent:"1",white:"0",punct:"0"};break;case"yes":default:e={case:"0",accent:"0",white:"0",punct:"0"}}return e}function _(e,t){return e?(t=A(t),e.normalize&&(e=e.normalize("NFKC")),t&&("1"===t.case&&(e=e.toLowerCase()),"1"===t.accent&&(e=g(e)),"1"===t.punct&&(e=v(e)),"1"===t.white&&(e=C(e))),e):""}function S(e){return e.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F-\x9F\u200B]/g,"")}function k(e){for(var t=0;t<e.length;++t)e[t]=e[t].trim();return e}function x(e,t,n){e=_(e,n),t=_(t,n),e=l(e);var r=k((t=l(t)).split(/##/));r.length>1&&(r=a()(r));for(var o=0;o<r.length;++o)if(S(e.trim())===S(r[o].trim()))return!0;return!1}var O=function(e){return(e+"").replace(/([\\.+*?[^\]$(){}=!<>|:])/g,"\\$1")},I=/\s/g,T=null;function F(e){return!(null==e.match(I))}function B(e){return!(null==e.match(h))}function P(e,t){var n=(t=A(t))&&"1"===t.case?"gi":"g",r=t&&"1"===t.punct,i=t&&"1"===t.white,a=t&&"1"===t.accent;if(e=o()(e,function(e){return e.normalize?e.normalize("NFKC"):e}),!r&&!i&&!a){var u=o()(e,O).join("|");return new RegExp("("+u+")",n)}null==T&&(T=new c.a),a&&null==p&&(p=function(){for(var e={},t=0;t<d.length;t++)if(1===d[t].base.length)for(var n=d[t].letters+d[t].base,r="["+n+"]",o=0;o<n.length;o++)e[n[o]]=r;return e}());var l=o()(e,function(e){for(var t=T.splitGraphemes(e),n=[],o=0;o<t.length;++o){var u=t[o];if(Object(s.isLetter)(u)){var c;if(a)n.push(null!==(c=p[u])&&void 0!==c?c:u);else n.push(u);r&&o!==t.length-1&&n.push(m)}else if(F(u))if(i)if(r){for(;o+1<t.length&&(F(t[o+1])||B(t[o+1]));)++o;n.push(E)}else{for(;o+1<t.length&&F(t[o+1]);)++o;n.push(w)}else n.push(u),r&&n.push(m);else B(u)&&r||n.push(O(u))}return n.join("")}).join("|");return new RegExp("("+l+")",n)}},63:function(e,t,n){e.exports=function(e){var t={},n=null,r=[];function o(){0!=r.length?(n=r.shift())():n=null}return t.pushAsyncFunc=function(t){var i=e.Deferred();return r.push(function(){t().always(function(){i.resolve(),o()})}),null===n&&o(),i},t.pushSyncFunc=function(t){this.pushAsyncFunc(function(){return t(),e.when()})},t}(n(0))},65:function(e,t,n){"use strict";n.r(t),n.d(t,"setPreparePrint",function(){return l});var r=n(5);function o(e,t,n){return n?t?t(e):e:(e&&e.then||(e=Promise.resolve(e)),t?e.then(t):e)}function i(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return Promise.resolve(e.apply(this,t))}catch(e){return Promise.reject(e)}}}var a=i(function(){return function(e){if(e&&e.then)return e.then(c)}(function(e,t){try{var n=e()}catch(e){return t(e)}if(n&&n.then)return n.then(void 0,t);return n}(function(){return u(s,function(){window.print()})},c))}),s=function(){return o(!0)};function u(e,t,n){if(n)return t?t(e()):e();try{var r=Promise.resolve(e());return t?r.then(t):r}catch(e){return Promise.reject(e)}}function c(){}function l(e){s=e}window.addEventListener("message",i(function(e){return"print"===e.data.command&&a(),o()})),Object(r.isToolPreview)()&&(window.doPrint=function(){return u(s,function(){window.clientApp&&window.clientApp.doPrint&&window.clientApp.doPrint()})})},66:function(e,t){e.exports={GetItem:function(e){return window.localStorage.getItem(e)},RemoveItem:function(e){window.localStorage.removeItem(e)},SetItem:function(e,t){window.localStorage.setItem(e,t)},Clear:function(){window.localStorage.clear()}}},67:function(e,t,n){function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o,i,a;e.exports=(o=n(5),i=n(0),-1!==(a=o.getPlatform()).indexOf("android")?i.fn.extend({clickOnDraggable:function(e){return this.each(function(){var t=!1;this.ClickOnDraggableCallback=e,i(this).on("touchstart",function(e){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&1===n.touches.length&&n.changedTouches[1]===n.touches[1]?(t=!0,setTimeout(function(){t&&(console.error("touch takes too long"),t=!1)},100)):t=!1}),i(this).on("touchend",function(e){if(t){var n=e.originalEvent?e.originalEvent:e;1===n.changedTouches.length&&0===n.touches.length?(t=!1,this.ClickOnDraggableCallback()):t=!1}})})}}):i.fn.extend({clickOnDraggable:function(e){return this.each(function(){i(this).click(e)})}}),-1!==a.indexOf("android")||-1!==a.indexOf("preview")||-1!==a.indexOf("phantomjs")||-1!==a.indexOf("headlesschrome")||-1!==a.indexOf("chrome")||"ibw-platform-osx-safari"===a||"ibw-platform-osx-ibooks"===a||"ibw-platform-osx-ibooks-epub"===a||"ibw-platform-unknown"===a?i.fn.extend({tapOrClick:function(e){return this.each(function(){i(this).click(e);var t=this,n=i(this);n.is("button")||n.is("a")||n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){i(this).unbind("click");var e=i(this);e.is("button")||e.is("a")||e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){i(this).trigger("click",e)})}}):i.fn.extend({tapOrClick:function(e){return this.each(function(){var t=this,n=i(this);n.addClass("epub-block"),n.find("*").each(function(){this instanceof SVGElement&&i(this).addClass("epub-block")});var r=!1;n.hammer?"ibw-platform-ipad-bookwidgets"===a||"ibw-platform-ipad-seb"===a||"ibw-platform-ipad-ibooks-epub"===a||"ibw-platform-ipad-ibooks"===a?n.hammer().on("tap",function(o){!1===r&&(e.bind(t)(o),r=!0,setTimeout(function(){r=!1},500)),n.blur(),o.stopImmediatePropagation()}):n.hammer().on("tap",function(r){e.bind(t)(r),n.blur(),r.stopImmediatePropagation()}):n.click(function(r){e.bind(t)(r),n.blur()}),(n.hammer||!n.is("button")&&!n.is("a"))&&n.on("keydown",function(n){var r=n.which;13!==r&&32!==r||e.bind(t)({preventDefault:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})})})},tapOrClickOff:function(){return this.each(function(){var e=i(this);e.hammer?e.hammer().off("tap"):e.unbind("click"),(e.hammer||!e.is("button")&&!e.is("a"))&&e.off("keydown")})},triggerTapOrClick:function(e){return this.each(function(){var t=i(this);t.hammer?t.hammer().trigger("tap",e):t.trigger("click",e)})}}),i.fn.extend({clickOrHold:function(e,t,n){return n=n||3e3,this.each(function(){var r=!1,o=null;i(this).click(function(t){r||e.bind(this)(t),r=!1}),i(this).on("keydown",function(t){var n=t.which;13!==n&&32!==n||e.bind(this)({prevent:function(){},stopPropagation:function(){},stopImmediatePropagation:function(){}})}),i(this).on("mousedown touchstart",function(){var e=this;o=setTimeout(function(){o=null,r=!0,t.bind(e)()},n)}),i(this).on("mouseup touchend",function(){null!==o&&(clearTimeout(o),o=null),r&&setTimeout(function(){r=!1},400)})})}}),void i.fn.extend({makeButton:function(e){"string"==typeof(e=e||{})&&(e={label:e}),this.attr({role:e.hasOwnProperty("role")?e.role:"button"});var t=this.attr("tabindex");return"undefined"!==r(t)&&!1!==t||this.attr({tabindex:"0"}),e.hasOwnProperty("label")&&this.attr({"aria-label":e.label}),e.hasOwnProperty("labelledby")&&this.attr({"aria-labelledby":e.labelledby}),this},makeLink:function(e){return this.attr({role:"link",tabindex:"0"}),e&&this.attr({"aria-label":e}),this}}))},69:function(e,t,n){"use strict";n.r(t),function(e){n(123),n(124),n(125),n(126),n(127),n(128),n(72),n(129),n(130);void 0===e&&(window.global=window)}.call(this,n(104))},7:function(e,t,n){"use strict";n.d(t,"a",function(){return o}),n.d(t,"b",function(){return i});n(0);var r=[];function o(e){r=e}function i(e){return r[e]&&""!==r[e]?r[e]:e}},70:function(e,t,n){"use strict";n.r(t),n.d(t,"addWeblinkIframe",function(){return i});var r=n(0),o=n.n(r);function i(e,t,n,r){var i=r&&""!==r?"onclick=\"setTimeout(function() { parent.postMessage({ msg:'"+r+"'}, '*');}, 1000);\" ":"",a=document.createElement("iframe");a.className="bwexternallink";var s='<body style="margin: 0px"><a style="display: block; width: 100%; height: 100%; background:red;" '+i+'href="'+t+'" target="_blank">&nbsp;</a></body>';e.appendChild(a),a.contentWindow.document.open(),a.contentWindow.document.write(s),a.contentWindow.document.close(),o()(a).css({position:"absolute",left:0,top:0,width:"100%",height:"100%"})}},71:function(e,t,n){var r=n(15).map;e.exports={url:function(e,t){var n="js2objc://"+e;return t&&(n+="?"+r(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")),n}}},72:function(e,t){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){"use strict";if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r){r=Object(r);for(var o=Object.keys(Object(r)),i=0,a=o.length;i<a;i++){var s=o[i],u=Object.getOwnPropertyDescriptor(r,s);void 0!==u&&u.enumerable&&(t[s]=r[s])}}}return t}})},73:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(13),i=n(33),a=i.loadJS,s=i.loadCSS,u=!1,c=!1,l=new RegExp("https://www.bookwidgets.com/create/api/widgets/[0-9]+/preview/config.(css||js)?"),d=new RegExp("http://localhost(:[0-9]+)?/create/api/widgets/[0-9]+/preview/config.(css||js)?");function f(e){return window.WidgetParams?e:0===window.location.pathname.indexOf("/_ah/gcs/bookwidgets-eu--widgets/")?0===e.search(d)?e:window.location.origin+"/_ah/gcs/bookwidgets-eu--widget-assets"+e:window.location.host.startsWith("widgets-eu.")?0===e.search(l)?e:window.location.host.replace("widgets-eu.","//widget-assets-eu.")+e:e}t.default=function(){var e=o.getParameters(!1);e.dbg5&&n(132)({apiKey:e.dbg5,autoCaptureSessions:!1,notifyReleaseStages:["production"],releaseStage:"production",beforeSend:function(e){return 1!==e.stacktrace.length||1!==e.stacktrace[0].lineNumber}});var t=r.Deferred();if(!1===c&&!1===u){u=!0;var i=f(e.content)||"config.js",l=f(e.design)||"config.css";r.when(a(i),s(l)).fail(function(){t.reject(new Error("Unable to load config file"))}).always(function(e,n){n&&r(n).attr("id","designconfig"),u=!1,c=!1;var o=window.widgetconfig;t.resolve(o),-1===navigator.userAgent.indexOf("ibookwidgets")&&(window.widgetconfig=void 0)})}return t}},74:function(e,t,n){function r(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var o=n(15).uniq;e.exports=function(e){var t=[];var n=0,i=0,a=null;function s(e){console.log("Select design element",e),void 0!==window.previewsidebar?window.previewsidebar.setSelectedItem(e):window.parent.postMessage({command:"select-design-element",element:e})}function u(){e(".bw-design-tooltip").remove()}function c(c){var l=c.target;e(l).is(".bw-design-tooltip")||e(l).is(".bw-design-tooltip a")||n!==l&&(0===i&&u(),clearTimeout(i),n=l,i=setTimeout(function(n){i=0;var u=!1,c=e(n),l=function(){var n={};e.each(t,function(e,t){var o=r(t,2),i=o[0],a=o[1];if(c.is(i)){var s=c.offset().top+"_"+c.offset().left;n[s]?n[s].elements.push(a):n[s]={offset:c.offset(),elements:[a]},u=!0}}),e.each(n,function(t,n){var r=e(document.createElement("div")).addClass("bw-design-tooltip").attr("data-design-element",n.elements[0]).css({position:"absolute",top:n.offset.top,left:n.offset.left}).appendTo("body");e.each(o(n.elements),function(t,n){e(document.createElement("a")).text(a&&a[n]?a[n]:n).attr("href","#").click(function(e){s(n),e.stopPropagation(),e.preventDefault()}).appendTo(r)})}),c=c.parent()};do{l()}while(!1===u&&c.length>0)}.bind(null,l),400))}function l(){var t=e(".bw-design-tooltip");0!==t.length&&s(t.attr("data-design-element"))}window.activateDesignInfoTooltips=function(e){a=e,window.addEventListener("mousemove",c),window.addEventListener("click",l)},window.disableDesignInfoTooltips=function(){u(),window.removeEventListener("mousemove",c),window.removeEventListener("click",l)};var d=[],f=!1;var p=!1;window.BwNotifyWidgetLoaded=function(){p||(p=!0,window.parent.postMessage("BwWidgetLoaded","*"),window.clientApp&&window.clientApp.widgetLoaded&&window.clientApp.widgetLoaded())};var g=!0;function h(){for(;d.length>0;){d.shift()()}g&&window.BwNotifyWidgetLoaded()}return window.BwUseManualWidgetLoadedNotification=function(){g=!1},function(n){if("bwshortcode"in n&&(window.bwshortcode=n.bwshortcode),"pre"in n&&(console.log("Preview"),"designinfo"in n)){for(var r=0;r<n.designinfo.length;++r)o=n.designinfo[r].s,i=n.designinfo[r].d,t.push([o,i]);"undefined"!=typeof previewsidebar?(console.log("Previewsidebar is defined, immediately set design config"),e(function(){var e;e=function(){window.CssUpdateCounter&&(console.log("has CssUpdateCounter -> updating configCss"),window.updateConfigCSS(window.CssUpdateCounter)),setTimeout(function(){window.activateDesignInfoTooltips()},3e3)},f?setTimeout(e,0):d.push(e)})):(window.parent.postMessage({command:"enable-design-config-support"}),window.addEventListener("beforeunload",function(){window.parent.postMessage({command:"disable-design-config-support"})}))}var o,i;if("bra"in n&&e(function(){"iPad"===navigator.platform&&-1!==navigator.userAgent.indexOf("BookWidgets")||e(document.createElement("div")).addClass("branding").appendTo("body")}),"tri"in n&&e(function(){if("iPad"===navigator.platform||-1===navigator.userAgent.indexOf("BookWidgets")&&-1===navigator.userAgent.indexOf("ibookwidgets")){e(document.createElement("div")).addClass("dialog-sheet").attr("id","preview_alert").css({color:"red","text-shadow":"none"}).append(e(document.createElement("p")).safeHtml(" <b></b>")).append(e(document.createElement("p")).text("")).appendTo("body");var t=e(document.createElement("div")).addClass("dialog-sheet-shadow");e(document.body).append(t),window.CreateDialogSheetFor("#preview_alert"),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},2e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},6e3),setTimeout(function(){e("#preview_alert").data("dialogSheet").show()},3e4),setTimeout(function(){e("#preview_alert").data("dialogSheet").hide()},34e3)}}),void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),window.getWidgetUrl=function(){return window.location.href},window.bwbackbuttonlabel=null,"performance"in window==!1&&(window.performance={}),"now"in window.performance==!1){var a=Date.now();window.performance.timing&&window.performance.timing.navigationStart&&(a=window.performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}return n.hasOwnProperty("backbutton_label")&&""!==n.backbutton_label&&(window.bwbackbuttonlabel=n.backbutton_label),"Vertical"===n.widget_orientation?e("html").addClass("vertical"):e("html").addClass("horizontal"),null!=n.widget_language&&""!==n.widget_language&&e("html").attr("lang",n.widget_language),n.hasOwnProperty("LocalizationMap")&&(window.bwlocalizationmap=n.LocalizationMap),setTimeout(h,0),null}}(n(0))},75:function(e,t,n){"use strict";n.r(t),t.default=function(e){return"undefined"==typeof window||window.navigator&&window.navigator.userAgent&&(window.navigator.userAgent.indexOf("PhantomJS")>=0||window.navigator.userAgent.indexOf("ibookwidgets")>=0)?e:(new window.DOMParser).parseFromString("<html>"+e+"</html>","text/html").documentElement.textContent}},76:function(e,t,n){"use strict";n.r(t),n.d(t,"instructionsAreEmpty",function(){return g}),n.d(t,"showInfoPopup",function(){return h}),n.d(t,"prepareInfoPopup",function(){return m});var r=n(1),o=n.n(r),i=n(54),a=n.n(i),s=n(0),u=n.n(s),c=n(39),l=n(37),d=n(53),f=n.n(d),p=n(29);function g(e){return!e||(!e.instructions||!!Object(p.isEmptyRichText)(e.instructions))}function h(e){if(!g(e)){var t=u()(document.createElement("div")).css({position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%"}).appendTo("body"),n=o.a.createElement(c.b,null,o.a.createElement(c.a,{className:f.a.InstructionsDialog,title:e.instructions_title||"",onOk:function(){t.remove()},onClose:function(){t.remove()}},o.a.createElement(l.a,{text:e.instructions||""})));a.a.render(n,t[0])}}function m(e){if(!g(e)){var t=u()("#title-toolbar");0===t.length&&(t=u()(document.createElement("div")).attr("id","title-toolbar").prependTo("body")),u()(document.createElement("div")).addClass("bw-toolbutton").append(u()(document.createElement("div")).addClass("bw-icon bw-icon-info")).makeButton(e.instructions_title||"").tapOrClick(h.bind(null,e)).prependTo(t)}}},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){var r=n(41);e.exports=function(e){window.addEventListener("message",function(t){var n=t.data;"set-css"===n.command?(!function(t){e("style[id='designconfig'], link[id='designconfig']").remove();var n=document.createElement("style");n.id="designconfig",n.type="text/css",n.appendChild(document.createTextNode(t)),document.head.appendChild(n)}(n.css),r.executeCssUpdateCallbacks()):"show-css-config-elements"===n.command?window.activateDesignInfoTooltips(n.translations):"hide-css-config-elements"===n.command&&window.disableDesignInfoTooltips()})}(n(0))},8:function(e,t,n){"use strict";function r(e){for(var t={},n=e.split("&"),r=0;r<n.length;r++){var o=n[r].indexOf("=");if(!(o<0)){var i=[n[r].substr(0,o),n[r].substr(o+1)],a=decodeURIComponent(i[0]);if(void 0===t[a])t[a]=decodeURIComponent(i[1]);else if("string"==typeof t[a]){var s=[t[a],decodeURIComponent(i[1])];t[a]=s}else t[a].push(decodeURIComponent(i[1]))}}return t}function o(e){return-1===e.indexOf("?")?{}:r(e.replace(/[^?]*\?/,"").replace(/#.*/,""))}var i=/^(https?:\/\/)?((www\.)?youtube\.com\/(v|embed|u|w)|youtu\.be)\/([^?&#]+)/,a=/^(https?:\/\/)?(www\.)?youtube\.com\/watch\?(.*)/;function s(e){var t;return null!=(t=e.match(i))?t[5]:null!=(t=e.match(a))?r(t[3].split("#")[0]).v:null}function u(e){return-1!==(e=e.split("#")[0]).indexOf("?")?e:e.replace("&","?")}function c(e){var t=o(u(e));return null!=t.t?function(e){var t=e.match(/(([0-9]+)m)?([0-9]+)s/);if(null==t)return 0;var n=parseInt(t[3]);return t[2]&&(n+=60*parseInt(t[2])),n}(t.t)+"":null!=t.start?t.start:null}function l(e){var t=o(u(e));return null!=t.end?t.end:null}function d(e){return o(e).cc_load_policy}function f(e){return o(e).cc_lang_pref}function p(e){var t=[],n=c(e);null!=n&&t.push("start="+n);var r=l(e);null!=r&&t.push("end="+r);var o=d(e);null!=o&&t.push("cc_load_policy="+o);var i=f(e);return null!=i&&t.push("cc_lang_pref="+i),0===t.length?"":"?"+t.join("&")}function g(e){return null!=s(e)}var h=[/^(https?:\/\/)?vimeo.com\/(\d+)/,/^(https?:\/\/)?vimeo.com\/album\/[^/]+\/video\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/channels\/[^/]+\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/groups\/[^/]+\/video\/([0-9]+)/,/^(https?:\/\/)?vimeo.com\/ondemand\/[^/]+\/video\/([0-9]+)/];function m(e){for(var t=0;t<h.length;++t){var n=e.match(h[t]);if(null!=n)return n[2]}return null}var v=/^(https?:\/\/)?(www\.)?giphy\.com\/(embed|gifs)\/([^/?]+)/,b=/^((https?:)?\/\/)?media.giphy.com\/media\/([^/]+)/;function w(e){var t=e.match(v);return null!=t?t[4]:null!=(t=e.match(b))?t[3]:null}function y(e){return g(e)}function D(e){return g(e)}function C(e){var t=s(e);return null!=t?t:e}function E(e){return function(e){return null!=m(e)}(e)}function A(e){var t=m(e);return null!=t?t:e}function _(e){return function(e){return null!=w(e)}(e)}function S(e){var t=w(e);return null!=t?t:e}n.d(t,"l",function(){return y}),n.d(t,"k",function(){return D}),n.d(t,"g",function(){return C}),n.d(t,"j",function(){return E}),n.d(t,"d",function(){return A}),n.d(t,"i",function(){return _}),n.d(t,"c",function(){return S}),n.d(t,"f",function(){return c}),n.d(t,"e",function(){return l}),n.d(t,"b",function(){return d}),n.d(t,"a",function(){return f}),n.d(t,"h",function(){return p})},80:function(e,t){e.exports=function(){function e(e){return window.location.origin+window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/")+1)+e}return{createTextOrPictureAnswer:function(t,n){return"undefined"==typeof bwshortcode?t:{type:"Image",url:e(n),name:t}},createPairAnswer:function(t,n,r,o){return"undefined"==typeof bwshortcode?""!==r?t+" - "+r:t+" -":""===r?void 0===n||""===n?{type:"WordPair",name1:t,name2:""}:{type:"ImageWordPair",url1:e(n),name1:t,name2:""}:void 0===n||""===n?void 0===o||""===o?{type:"WordPair",name1:t,name2:r}:{type:"WordImagePair",name1:t,name2:r,url2:e(o)}:void 0===o||""===o?{type:"ImageWordPair",name1:t,url1:e(n),name2:r}:{type:"ImagePair",name1:t,url1:e(n),name2:r,url2:e(o)}},createWordListAnswer:function(t,n){if("undefined"==typeof bwshortcode){for(var r=[],o=0;o<n.length;++o)r.push(n[o].name);return t+" - "+r.join(" ")}for(var i={name:t,list:[],type:"WordImageListPair"},a=0;a<n.length;++a)void 0!==n[a].pic&&""!==n[a].pic?i.list.push({name:n[a].name,url:e(n[a].pic)}):(i.list.push({name:n[a].name}),i.type="WordWordListPair");return i}}}()},81:function(e,t,n){e.exports=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=e(document.createElement("div")).addClass("bw-throbber-wrapper bw-centering-container").appendTo(t),i=e(document.createElement("canvas")).addClass("bw-throbber bw-centered").attr({width:n,height:n}).appendTo(o),a=i[0].getContext("2d");a.translate(n/2,n/2);for(var s=30*n/100,u=0;u<s;++u){a.rotate(2*-Math.PI/s);var c=r?0:255;a.strokeStyle="rgba("+c+","+c+","+c+","+(1/s).toFixed(2)+")",a.lineWidth=3,a.moveTo(n/5,0),a.lineTo(2*n/5,0),a.stroke()}var l=null,d=!1;return window.requestionAnimationFrame&&window.requestAnimationFrame(function e(t){if(l||(l=t),!d){var n="rotate("+360*Math.floor(t/1e3*s)/s+"deg)";i.css({transform:n,"-webkit-transform":n,"-moz-transform":n,"-ms-transform":n}),window.requestionAnimationFrame&&window.requestAnimationFrame(e)}}),{close:function(){o.remove(),d=!0}}}}(n(0))},813:function(e,t,n){n(69);var r,o,i,a,s,u,c=n(76),l=(c.prepareInfoPopup,c.showInfoPopup,n(82),n(4).appSafeUnescape);e.exports=(r=n(21),o=n(419),i=n(25),a=n(42),s=n(0),u=n(101),void s(function(){r.getConfig().then(function(e){a.makeWidget({layout:"title_toolbar_layout",title:e.title,"no-user-select":!0,instructions:e.instructions}),o.create(function(t,n,r,o,a,c){var d=s(document.createElement("div")).addClass("card").addClass("pair_"+t).data("pairid",t),f=s(document.createElement("div")).addClass("front").append(s(document.createElement("div")).addClass("image bw-centering-container")).appendTo(d);if("yes"===e["number-cards"]&&s(document.createElement("div")).addClass("card-number bw-centered").text(o+1).appendTo(f.find(".image")),"image"===r){d.addClass("imagecard");var p=u.create({img:n,type:"div",disable_click:!0,resize_policy:e["resize-policy"]}).addClass("back").appendTo(d);n.alttext&&"browser"===e.text_to_speech&&c(p,a,n.alttext)}else{var g=i.prepare(n),h=[];g!==n&&(h.push("hasmath"),i.isOnlyMath(n)&&h.push("onlymath"));var m=s(document.createElement("div")).addClass("back").appendTo(d),v=s(document.createElement("div")).addClass("content text").appendTo(m);s(document.createElement("div")).addClass("centered textcard "+h.join(" ")).safeHtml(g).appendTo(v),"browser"===e.text_to_speech&&c(m,a,l(n))}return d},function(e){setTimeout(function(){e.animate({opacity:"0.6"},500,function(){e.addClass("shadow"),e.css("opacity","")}),0===s(".card:not(.done)").length&&(s(".card").css("opacity","0.2"),s(".card").removeClass("shadow"),s(".card").animate({opacity:"1"},500),setTimeout(function(){o.setAllDone()},500))},2e3)},function(){var e=s(".content.text").parent();return{width:e.innerWidth()-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right")),height:e.innerHeight()-parseInt(e.css("padding-top"))-parseInt(e.css("padding-bottom"))}},"MemoryGame",function(e){s(".card-number").css("font-size",e/2)})})}))},82:function(e,t,n){"use strict";function r(){return!!window.speechSynthesis}function o(){window.speechSynthesis.getVoices()}function i(e,t){var n=t.lang.toLowerCase().replace("-","_");return e===n?4+(t.default?1:0):e.substring(0,2)===n.substring(0,2)?2===n.length?3:1+(t.default?1:0):0}function a(e){if(null==e)return null;e=e.toLowerCase().replace("-","_");for(var t=window.speechSynthesis.getVoices(),n=0,r=null,o=0;o<t.length;o++){var a=i(e,t[o]);a>n&&(n=a,r=t[o])}return r}function s(e,t,n){if(null==e)return!1;var r=new SpeechSynthesisUtterance(t),o=a(e);return null!=o&&(r.voiceURI=o.voiceURI,r.lang=o.lang,r.voice=o,r.onstart=n.onstart,r.onend=n.onend,window.speechSynthesis.speak(r),!0)}function u(){window.speechSynthesis.cancel()}function c(){window.speechSynthesis.pause()}function l(){window.speechSynthesis.resume()}n.r(t),n.d(t,"isAvailable",function(){return r}),n.d(t,"init",function(){return o}),n.d(t,"speak",function(){return s}),n.d(t,"stopSpeech",function(){return u}),n.d(t,"pauseSpeech",function(){return c}),n.d(t,"resumeSpeech",function(){return l}),n.d(t,"whenVoiceAvailable",function(){return g}),n.d(t,"clearVoiceAvailableCbs",function(){return h});var d=[];function f(){for(var e=0;e<d.length;)a(d[e].language)?(d[e].cb(),d.splice(e,1)):++e}var p=!1;function g(e,t){r()&&(null==a(e)?(d.push({language:e,cb:t}),p||(window.speechSynthesis.onvoiceschanged=f,p=!0)):t())}function h(){d.splice(0,d.length)}},84:function(e,t,n){e.exports=function(e){var t={},n=function(e){return e<10?"0"+e:""+e};function r(e){var t=Array.prototype.slice.call(arguments,1);try{e&&e.apply(null,t)}catch(e){console.log("Received error when executing callback: "+e)}}return t.getDateTime=function(){var e=new Date;return n(e.getFullYear())+"-"+n(1+e.getMonth())+"-"+n(e.getDate())+" "+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds())},t.error=function(e,t){return{code:e,message:t}},t.trimLeadingSlash=function(e){return e.length>0&&"/"==e[0]?e.substr(1):e},t.newCallbackQueue=function(){var e={executeList:[],executing:!1,executeNext:function(){e.executeList.length>0?(e.executing=!0,e.executeList.shift().cb(e.executeNext)):e.executing=!1},executeSequential:function(t,n){if(null!=n&&!1!==n&&null!=n&&e.executeList.length>0)for(var r=0;r<e.executeList.length;++r)e.executeList[r].tag==n&&e.executeList.splice(r,1);e.executeList.push({cb:t,tag:n}),e.executing||e.executeNext()}};return e},t.callSafe=r,t.handleException=function(n,o,i){18==n.code?r(o,t.error(e.BWDS_ERROR_SECURITY,"AsyncBWDS Security Error: problem when accessing: "+JSON.stringify(n))):r(o,t.error(e.BWDS_ERROR_INTERNAL,"AsyncBWDS Error: problem when accessing: "+JSON.stringify(n))),i&&i()},t}(n(47))},85:function(e,t,n){var r=n(71);e.exports=function(e,t){var o=n(28).createLogger("NativeSQLAsyncKeyStore"),i=new e;i.startListening();return function(e){e=e||function(e){var t=document.createElement("IFRAME");t.setAttribute("src",e),t.setAttribute("height","1px"),t.setAttribute("width","1px"),document.documentElement.appendChild(t),t.parentNode.removeChild(t),t=null};var t={};function n(e){var t=String.fromCharCode(29);return(e=e.map(function(e){return e.replace(new RegExp(",","g"),t)})).join()}return t.resultForCallback=function(e,t){i.processCallback(e,t)},t.runningInIframe=function(){try{return window.self!==window.top}catch(e){return!0}},t.callObjC=function(n,o,a,s){var u=r.url(n,o),c=i.registerCallbacks(a,s),l="'"+c.ok+"'",d="'"+c.error+"'",f="window.BWKSNativeSQL.resultForCallback";t.runningInIframe()&&(f="function BWKSNativeSQL_callback_wrapper(callbackID, arg) { window.postMessage({ 'command': callbackID, 'arg': arg, 'to': '_widget' }, '*'); }; BWKSNativeSQL_callback_wrapper"),e(u+"&okCallbackId="+l+"&errorCallbackId="+d+"&callbackFunc="+f)},t.getItemsAsync=function(e,r,i){if(0==e.length)return o.error("NativeSQL Error: getItemsAsync without names"),void i({message:"NativeSQL Error: getItemsAsync without names"});t.callObjC("getItemsAsync",{names:n(e)},r,i)},t.getDirAttribs=function(e,n,r){t.callObjC("getDirAttribsAsync",{dirname:e},n,r)},t.setItemsAsync=function(e,n,r){if(0==e.length)return o.error("NativeSQL Error: setItemsAsync without names"),void r({message:"setItemsAsync without names"});if(e.length>1)return o.error("NativeSQL Error: setItemsAsync can only handle 1 item"),void r({message:"setItemsAsync can only handle 1 item"});var i=e[0];t.callObjC("setItemAsync",{keyname:i.key,value:i.value,attribs:i.attribs},n,r)},t.removeItemsAsync=function(e,r,i){if(0==e.length)return o.error("NativeSQL Error: removeItemsAsync without names"),void i({message:"NativeSQL Error: removeItemsAsync without names"});t.callObjC("removeItemsAsync",{names:n(e)},r,i)},t}}(n(50))},86:function(e,t,n){var r,o;e.exports=(r=n(113),n(13),(o=function(e,t,n,o){this.sender=new r(e,"*"),this.useSessionStorage=o,this.token=n}).prototype.postMessage=function(e,t,n){this.token&&(e.token=this.token),this.useSessionStorage&&(e.useSessionStorage=!0),this.sender.send(e,function(e,r){return e?n(e):t(r)})},o.prototype.getItemsAsync=function(e,t,n){this.postMessage({command:"getItems",names:e},t,n)},o.prototype.setItemsAsync=function(e,t,n){this.postMessage({command:"setItems",items:e},t,n)},o.prototype.removeItemsAsync=function(e,t,n){this.postMessage({command:"removeItems",names:e},t,n)},o.prototype.clearAllAsync=function(e,t){this.postMessage({command:"clear"},e,t)},o.prototype.getDirAttribs=function(e,t,n){this.postMessage({command:"getDirAttribs",name:e},t,n)},o)},87:function(e,t,n){var r,o,i,a,s,u,c,l,d,f,p,g,h,m,v,b;e.exports=(r=n(5),o=n(109).f(),i=n(110),a=n(111),s=n(85),u=n(86),n(47),c=n(114),d=new(n(115))(o),f=new i,p=new c(f),g=new a,h=new c(g),m=new s,v=new c(m),b=r.getPlatform(),-1!==window.location.search.substring(1).indexOf("bwds-proxy")?(l=new c(new u("_storage")),console.log("BWDS: Proxy")):"ibw-platform-ipad-bookwidgets"===b?(l=v,window.BWKSNativeSQL=m,console.log("BWDS: Native")):"ibw-platform-ipad-ibooks"!==b&&"ibw-platform-osx-chrome"!==b&&"ibw-platform-win32-chrome"!==b&&"ibw-platform-chromebook-chrome"!==b&&"ibw-platform-android-chrome"!==b&&"kotobee:"!==window.location.protocol||!window.indexedDB?"ibw-platform-osx-preview"!==b&&"ibw-platform-win32-preview"!==b||!window.openDatabase?(l=d,console.log("BWDS: Local")):(console.log("BWDS: WebSQL"),l=p):(console.log("BWDS: IndexedDB"),l=h),l.test={BWKSIDB:g,BWKSWebSQL:f,BWDSLocal:d,BWDSWebSQL:p},-1!==navigator.userAgent.indexOf("ibookwidgets")&&(window.BWDS=l),l)},88:function(e,t,n){e.exports=function(e,t,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:n(5),a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:n(66),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n(85),u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:n(86);function c(t){this._storage=t,this.setCredentials=function(t){var n=this;return e.Deferred(function(e){n._storage.setItemsAsync([{key:"BwCredentials",value:JSON.stringify(t),attribs:""}],function(){e.resolve()},function(){e.reject()})})},this.getCredentials=function(){var t=this;return e.Deferred(function(e){t._storage.getItemsAsync(["BwCredentials"],function(t){try{var n=JSON.parse(t.BwCredentials.value);e.resolve(n)}catch(t){e.reject()}},function(){e.reject()})})}}var l=r.isLTI()||t.getParameters().sso;return l&&console.log("Using session storage for credentials"),"ibw-platform-ipad-bookwidgets"===i.getPlatform()?new c(new s):i.usesCredentialProxy()?new c(new u("_secureStorage",!0,t.getQueryParams(window.location.search)["bwds-secure-proxy-token"],l)):new function(t){this.setCredentials=function(n){return e.Deferred(function(e){try{t.SetItem("BwCredentials",JSON.stringify(n)),e.resolve()}catch(t){e.reject()}})},this.getCredentials=function(){return e.Deferred(function(e){try{var n=JSON.parse(t.GetItem("BwCredentials"));e.resolve(n)}catch(t){e.reject()}})}}(l?o:a)}.bind(null,n(0),n(13),n(44),n(117))},89:function(e,t,n){var r=function(e,t,n){var r=n.bwConfig,o=n.studentaccount,i=n.bwdsstorage,a=n.writecachingonlinestorage,s={},u=e.Deferred();s.initialized=function(){return u};var c=t.getParameters(),l=c.hasOwnProperty("teacher_id")?c.teacher_id:"",d=c.hasOwnProperty("school_id")?c.school_id:"";return r.getConfig().then(function(t){var n="no"!==t.save_answers;function r(e){return"student_name"==e||"student_email"==e||"student_id"==e}var c=null,f=-1;function p(r){if(u.resolve(),r==f)return console.log("Warning: setting identical storage state, ignoring"),e.when();var s=t.book_title&&""!==t.book_title?t.book_title:"_no_name_";switch(r){case o.ANONYMOUS:c=i.createInfoStorage(s,"",n);break;case o.OFFLINE:c=i.createInfoStorage(s,o.getUserId(),n);break;case o.ONLINE:c=a.createInfoStorage(s,l,d)}return f=r,e.when()}s.get=function(e,t){if(f!=o.ANONYMOUS&&o.hasProperty(e))t(o.getProperty(e));else if(n){var i=function(n){t(n[e])};if(null==c)return void t(null);r(e)?c.getCommonProperties(i):c.getGroupProperties(i)}else t(null)},s.set=function(e,t){if(f!=o.ANONYMOUS&&o.hasProperty(e))console.log("Request setting read-only property... skipping");else if(n){var i={};i[e]=t,r(e)?c.setCommonProperties(i):c.setGroupProperties(i)}},s.hasStudentAccount=function(){return f==o.OFFLINE||f==o.ONLINE},s.getStudentAccountUserId=function(){return o.getUserId()},s.getStudentAccountUserName=function(){return o.getUserName()},s.getStudentAccountEmail=function(){return o.getEmail()},s.getStudentAccountProviderId=function(){return o.getProviderId()},s.getStudentAccountProviderHumanId=function(){return o.getProviderHumanId()},s.getStudentAccountToken=function(){return o.getUserToken()},s.getStudentAccountClassName=function(){return o.getUserClassName()},s.isCoAccount=function(){return o.isCoAccount()},o.initialized().then(function(){p(o.getState()),o.registerStateChangeCallback(p)},function(){p(o.ANONYMOUS)})}),s}.bind(null,n(0),n(13));e.exports={bindToContext:r}},9:function(e,t,n){"use strict";n.r(t),n.d(t,"parseCharge",function(){return l}),n.d(t,"parseFormula",function(){return d}),n.d(t,"parseEquation",function(){return p}),n.d(t,"formatFormula",function(){return g}),n.d(t,"formatIon",function(){return h}),n.d(t,"formatEquation",function(){return v}),n.d(t,"matchOrder",function(){return D}),n.d(t,"reduceReactantsAndProducts",function(){return C}),n.d(t,"isBalanced",function(){return E}),n.d(t,"matchIon",function(){return A}),n.d(t,"splitFormulaInIons",function(){return _}),n.d(t,"reduceIons",function(){return S}),n.d(t,"joinIonsToFormula",function(){return k}),n.d(t,"totalCharge",function(){return x}),n.d(t,"equalFormulas",function(){return O});var r=n(12),o=n.n(r),i=function(e){return!isNaN(1*e)},a=function(e){var t=e.charCodeAt(0);return t>=65&&t<=90||t>=97&&t<=122},s=function(e){return a(e)&&e===e.toUpperCase()},u=function(e){return a(e)&&e===e.toLowerCase()},c=function(e,t,n,r,i){var a;if(t)if(""===n&&(n=1),o()(t)&&"1"===n)for(var s=0;s<t.length;++s)a={atom:t[s].atom,qty:parseInt(t[s].qty)},s===t.length-1&&(0!==r&&(a.charge=r),""!==i&&(a.phase=i)),e.push(a);else a={atom:t,qty:parseInt(n)},0!==r&&(a.charge=r),""!==i&&(a.phase=i),e.push(a)},l=function(e){for(var t="",n=0,r=0;r<e.length;++r){var o=e.charAt(r);if(i(o))t+=o;else if("+"===o){if(n=1,r!==e.length-1)return 0}else{if("-"!==o)return 0;if(n=-1,r!==e.length-1)return 0}}return parseInt(t)*n},d=function e(t){var n=[],r="",o="",a=0,d="";if(-1!==t.indexOf("!")||-1!==t.indexOf("@")||-1!==t.indexOf("#")||-1!==t.indexOf("$"))return[];var f=t+"H";f=f.replace(/\(s\)/g,"!").replace(/\(aq\)/g,"@").replace(/\(g\)/g,"#").replace(/\(l\)/g,"$");for(var p=0;p<f.length;++p){var g=f.charAt(p);if(s(g))c(n,r,o,a,d),r=g,o="",d="",a=0;else if(u(g)){if(!r)return[];r+=g}else if(i(g)){if(!r)return[];o+=g}else if("("===g){for(var h=!1,m=p+1;m<f.length;++m)if(")"===f.charAt(m)){h=!0;break}if(!h)return[];if(!i(f.charAt(m+1)))return[];if(c(n,r,o,a,d),0===(r=e(f.substring(p+1,m))).length)return[];o="",d="",a=0,p=m}else if("{"===g){for(h=!1,m=p+1;m<f.length;++m)if("}"===f.charAt(m)){h=!0;break}if(!h)return[];var v=f.substring(p+1,m);a=l(v),p=m}else if("!"===g){if(""!==d)return[];d="s"}else if("@"===g){if(""!==d)return[];d="aq"}else if("#"===g){if(""!==d)return[];d="g"}else{if("$"!==g)return[];if(""!==d)return[];d="l"}}return n},f=function(e,t){for(var n="",r=0;r<e.length;++r){var o=e.charAt(r);if(!i(o)){n=""===n?1:parseInt(n);var a=d(e.substring(r));return 0!==a.length&&(t.push({formula:a,qty:n}),!0)}n+=o}return console.error("Chemistryparser parseTerm: This should never happen"),!1},p=function(e){var t=e.replace(/ /g,"").split("=");if(2!==t.length)return{reactants:[],products:[]};for(var n=t[0].replace(/\+\}/g,"*}").split("+"),r=t[1].replace(/\+\}/g,"*}").split("+"),o=[],i=[],a=0;a<n.length;++a){var s=n[a].replace(/\*\}/g,"+}");if(!f(s,o))return{reactants:[],products:[]}}for(a=0;a<r.length;++a){s=r[a].replace(/\*\}/g,"+}");if(!f(s,i))return{reactants:[],products:[]}}return{reactants:o,products:i}},g=function e(t){for(var n="",r=0;r<t.length;++r){var i=t[r];o()(i.atom)?i.qty>1?n=n+"("+e(i.atom)+")":n+=e(i.atom):n+=i.atom,i.qty>1&&(n=n+"_{"+i.qty+"}"),i.phase&&(n=n+"("+i.phase+")")}return n},h=function(e){var t=g(d(e.ion))+"^{";return 1===e.charge?t+="+":-1===e.charge?t+="-":e.charge>0?t+=e.charge+"+":t+=-e.charge+"-",t+="}"},m=function(e,t){for(var n=[],r=0;r<e.length;++r){var o=e[r],i="";t||1===o.qty||(i=o.qty+" \\, "),i+=g(o.formula),t?n.push({formula:i,qty:o.qty}):n.push(i)}return n},v=function(e,t){return{reactants:m(e.reactants,t),products:m(e.products,t)}},b=function(e){for(var t=[],n=0;n<e.length;++n)for(var r=e[n].formula,i=e[n].qty,a=0;a<r.length;++a){var s=r[a];if(o()(s.atom))for(var u=0;u<s.atom.length;++u)t.push({atom:s.atom[u].atom,qty:s.atom[u].qty*s.qty*i});else t.push({atom:s.atom,qty:s.qty*i})}return t},w=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,i=0;i<t.length;++i){var a=t[i];if(r.atom===a.atom){a.qty=a.qty+r.qty,o=!0;break}}o||t.push(r)}return t},y=function(e,t){for(var n=0;n<e.length;++n)if(e[n].atom===t)return n;return-1},D=function(e,t){for(var n=0,r=0;r<e.length;++r){var o=y(t,e[r].atom);if(o===n)++n;else if(o>=n){var i=t.splice(o,1)[0];t.splice(n,0,i),++n}}},C=function(e){var t=b(e.reactants),n=b(e.products);return t=w(t),n=w(n),D(t,n),{reactants:t,products:n}},E=function(e){var t=p(e),n=C(t);if(0===n.reactants.length)return!1;if(n.reactants.length!==n.products.length)return!1;for(var r=0;r<n.reactants.length;++r){var o=n.reactants[r],i=n.products[r];if(i.atom!==o.atom||i.qty!==o.qty)return!1}return!0},A=function(e,t){var n=1;if(o()(e[0].atom)){if(n=e[0].qty,e=e[0].atom,t.pattern.length!==e.length)return 0}else if(t.pattern.length>e.length)return 0;for(var r=0;r<t.pattern.length;++r){var i=t.pattern[r],a=e[r];if(i.atom!==a.atom)return 0;if(1===t.pattern.length)n=a.qty;else if(i.qty!==a.qty)return 0}return n},_=function(e,t){for(var n=[],r=d(e);r.length>0;){for(var o={ion:{pattern:[]}},i=0;i<t.length;++i){var a=t[i],s=A(r,a);s>0&&a.pattern.length>o.ion.pattern.length&&(o={ion:a,qty:s})}if(!(o.ion.pattern.length>0))return console.error("Error: formula contains unknown ions!"),console.error("Partial match: "),console.error(n),console.error("Head of parsedFormula:"),console.error(r),[];n.push({ion:o.ion.ion,charge:o.ion.charge,qty:o.qty}),o.qty>1?r.splice(0,1):r.splice(0,o.ion.pattern.length)}return n},S=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],o=!1,i=0;i<t.length;++i){var a=t[i];if(r.ion===a.ion.ion&&r.charge===a.ion.charge){a.qty++,o=!0;break}}o||t.push({ion:r,qty:1})}return t},k=function(e){e=S(e);for(var t=[],n=0;n<e.length;++n){var r=e[n];1===r.ion.pattern.length?t.push({atom:r.ion.pattern[0].atom,qty:r.qty}):t.push({atom:r.ion.pattern,qty:r.qty})}return function(e){for(var t=[],n=0;n<e.length;++n){var r=e[n];if(o()(r.atom))if(1===r.qty)for(var i=0;i<r.atom.length;++i)t.push({atom:r.atom[i].atom,qty:r.atom[i].qty});else t.push(r);else t.push(r)}return t}(t)},x=function(e){for(var t=0,n=0;n<e.length;++n)t+=e[n].charge;return t},O=function e(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;++r){if(t[r].qty!==n[r].qty)return!1;if(o()(t[r].atom)){if(!o()(n[r].atom))return!1;if(!e(t[r].atom,n[r].atom))return!1}else if(t[r].atom!==n[r].atom)return!1}return!0}},90:function(e,t,n){var r=n(45).valueOrCacheValue,o=(n(70).addWeblinkIframe,n(118).displayName),i=function(e,t,n,i,a,s,u,c,l,d,f){var p=f.bwConfig,g=f.credentialstorage,h=f.studentaccountui,m=f.throbber,v={INIT:-1,ANONYMOUS:0,OFFLINE:1,ONLINE:2},b=t.Deferred(),w=t.Deferred();return v.initialized=function(){return b.resolve(),w},p.getConfig().then(function(s){var f=u.getParameters(),p=l.isLTI(),y=f.sso,D=f.login_hint,C=u.getParameters(!1).toplevel,E=p&&!C||f.no_logout||y,A=v.INIT,_=!1;v.stateChangeCallbacks=[],v.registerStateChangeCallback=function(e){this.stateChangeCallbacks.push(e)},v.triggerStateChangeCallbacks=function(){for(var e=[],n=0;n<this.stateChangeCallbacks.length;++n)e.push(this.stateChangeCallbacks[n](A,_));return t.when.apply(null,e)},v.onlinecheck_enabled=!1;var S=null,k=2;function x(){return"no"!==s.support_student_account||l.isLTI()||y}v.isStudentAccountsSupported=x,v.setCredentials=function(e,t){var n={username:o(e),userid:e.id,email:e.email,providerid:e.providerID,providerhumanid:e.providerHumanID,provider:e.provider,school:t,className:e.className,token:e.token,sid:null,coaccount:e.isCoAccount};c.setCredentials(n),g.setCredentials(c.credentials())},v.clearCredentials=function(){c.clear(),g.setCredentials(c.credentials())},v.loadCredentials=function(){return t.Deferred(function(e){g.getCredentials().done(function(t){null!==t?c.setCredentials(t):c.clear(),e.resolve(c.credentials())}).fail(function(){console.log("credentials load failure"),c.clear(),e.resolve(c.credentials())})}).promise()},v.getStudentInfo=function(e,n){var r=null,o=null;return null!=e&&""!==e?o={Authorization:"BWWAAuthToken "+e}:null!=n&&""!==n&&(r={sid:n}),t.ajax({type:"GET",dataType:"json",data:r,url:s.student_account_server+"/student/GetInfo",headers:o,timeout:1e4})},v.checkIfOnline=function(){if(!this.onlinecheck_enabled)return t.when();var e=t.Deferred(),n=c.getUserToken();return this.getStudentInfo(n,null).done(function(t){console.log("Got back online !"),v.goOnline(),e.resolve()}).fail(function(){e.reject()}),e},v.goOffline=function(t){console.log("goOffline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOffline"),n.setState(v.OFFLINE)})},v.goOnline=function(t){console.log("goOnline");var n=this;e.pushAsyncFunc(function(){return console.log("Executing goOnline"),n.setState(v.ONLINE)})},v.scheduleOnlineCheck=function(){var e=this;k=Math.min(2*k,20),this.onlinecheck_enabled&&(S=setTimeout(function(){e.checkIfOnline().always(function(){e.scheduleOnlineCheck()})},1e3*k))},v.startOnlineCheck=function(){this.onlinecheck_enabled=!0,k=2,this.scheduleOnlineCheck()},v.stopOnlineCheck=function(){this.onlinecheck_enabled=!1,null!==S&&clearTimeout(S)},v.setState=function(e){return e===A?(console.log("Warning: setting identical storage state, ignoring"),t.when()):(A===v.OFFLINE&&this.stopOnlineCheck(),e===v.OFFLINE&&this.startOnlineCheck(),A=e,this.triggerStateChangeCallbacks())},v.setForceOfflineStorage=function(){return!1===_&&(_=!0),this.triggerStateChangeCallbacks()},v.setUserInfo=function(e,t){console.log("Log in successfull"),this.setCredentials(e,t),this.setState(this.ONLINE)},v.waitForExternalLogin=function(e,n){return n=n||2e3,t.Deferred(function(r){var o=null,a=null;var u=h.createPollingUI(function(){o&&clearTimeout(o),a&&a.abort(),c(),r.reject()});function c(){u.close()}!function u(){o=null;var l={sid:e.sid};a=t.ajax({type:"GET",dataType:"json",data:l,url:s.student_account_server+"/student/GetInfo",timeout:1e4,success:function(e){a=null,c(),r.resolve(e)},error:function(e,t,s){if(a=null,"abort"!==t)if(401===e.status||0===e.status)try{0===e.status||"authenticating"===JSON.parse(e.responseText).auth.status?o=setTimeout(u,n):(c(),r.reject({msg:i("Authentication error.")}))}catch(e){c(),r.reject({msg:i("Server error when signing in.")})}else c(),r.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})}})}()}).promise()},v.serverLogin=function(e,n,r){return t.Deferred(function(o){var a={schoolCode:e,username:n,password:r};return t.ajax({type:"POST",data:a,url:s.student_account_server+"/student/Login",timeout:1e4}).done(function(e){o.resolve(e)}).fail(function(e){401==e.status?o.reject({msg:i("Wrong username or password, please try again.")}):o.reject({msg:i("Received error trying to sign in")+" ("+e.status+")"})})}).promise()},v.login=function(e,n,r){var o=this;return t.Deferred(function(t){"oauth"===n||"signup"===r.action?o.waitForExternalLogin(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):"login"===r.action?o.serverLogin(r.school,r.username,r.password).done(function(e){t.resolve(e,r.school)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login action"})}).promise()},v.getLoginCredentials=function(e,n){return t.Deferred(function(t){"oauth"===n?t.resolve(e,n):"bw"===n?h.queryBWCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):"school"===n?h.querySchoolCredentials(e).done(function(r){t.resolve(e,n,r)}).fail(function(e){t.reject(e)}):t.reject({msg:"Unsupported login type: "+n})}).promise()},v.hasSchool=function(){return s.hasOwnProperty("student_account_school")&&s.student_account_school.hasOwnProperty("code")&&null!==s.student_account_school.code&&""!==s.student_account_school.code&&"null"!==s.student_account_school.code},v.selectLoginType=function(e){var r=this;return t.Deferred(function(t){if(e.oauth_links.length>0||!r.hasSchool()){if(y)for(var o=0;o<e.oauth_links.length;++o){var a=e.oauth_links[o];if(a.provider===y)return void n.navigateAlert(i("You need to be signed in to use this widget."),i("Please sign in"),i("OK"),a.url)}h.queryLoginMethod(e).done(function(n){t.resolve(e,n)}).fail(function(e){t.reject(e)})}else t.resolve(e,"school")}).promise()},v.getLoginInfo=function(){var e=f.lfq?u.split(f.lfq):{};e.schoolCode=this.hasSchool()?s.student_account_school.code:"",y?e.providers=y:s.student_account_authrestrict&&"yes"===s.student_account_authrestrict&&(e.providers=(s.student_account_authproviders||[]).join(",")),e.source=function(e){var t=a.getPlatform();return"ibw-platform-ipad-ibooks"===t||"ibw-platform-ipad-ibooks-epub"===t?"ibooks-ios":"ibw-platform-ipad-bookwidgets"===t?a.isPreview()?"bwapp-preview":"bwapp":"ibw-platform-osx-ibooks"===t||"ibw-platform-osx-ibooks-epub"===t?"ibooks-osx":"ibw-platform-osx-preview"===t||"ibw-platform-win32-preview"===t?"bw-preview":"ibw-platform-android-chrome"!==t||e?a.isPreview()?"create-preview":a.isTopLevelPlay()?"play":"embed":"embed"}(!!y),s.kmuserid&&""!=s.kmuserid&&(e.creator=s.kmuserid),"undefined"!=typeof bwshortcode&&(e.widget=bwshortcode),a.isIOS()&&(e.ios="1"),e.q=r(f.q);var n=m("body");return t.Deferred(function(r){t.ajax({type:"GET",dataType:"json",data:e,url:s.student_account_server+"/student/GetLoginForm",timeout:1e4}).done(function(e){n.close(),r.resolve(e)}).fail(function(e){n.close(),400==e.status?r.reject({msg:i("Widget configuration error: school doesn't exist.")}):r.reject({msg:i("Could not connect to server, check your internet connection.")})})}).promise()},v.reportFailure=function(e){return e&&e.hasOwnProperty("msg")?h.showMessage(e.msg,i("Sign in failed")):t.when(!0)},v.requestSignin=function(){var e=this;return t.Deferred(function(t){e.getLoginInfo().then(e.selectLoginType.bind(e)).then(e.getLoginCredentials.bind(e)).then(e.login.bind(e)).then(e.setUserInfo.bind(e)).then(function(){t.resolve(!1)}).fail(function(n){e.reportFailure(n).done(function(e){t.resolve(!e)})})}).promise()},v.showLoginStateInfo=function(){return A===v.OFFLINE?h.queryLogout(i("Offline"),i("You're currently offline and logged in as user:"),this.getUserName(),E):A===v.ONLINE?h.queryLogout(i("Online"),i("You're currently online and logged in as user:"),this.getUserName(),E):t.when()},v.loopLoginUntilOnline=function(e){var t=this;this.requestSignin().done(function(n){A===t.ONLINE?e.resolve():n?t.loopLoginUntilOnline(e):h.showMessage(i("You need to be signed in to use this widget."),i("Please sign in")).done(function(){t.loopLoginUntilOnline(e)})})},v.forceLogin=function(){var e=t.Deferred();return this.loopLoginUntilOnline(e),e},v.setAnonymousOrForceLogin=function(){l.isEmbeddedLTI()?this.loginLTI():"optional"===s.support_student_account?(this.setState(this.ANONYMOUS),w.resolve()):this.forceLogin().done(function(){w.resolve()})},v.initializeWithStoredCredentials=function(e){var t=this,n=e.token,r=e.sid,o=null!=n&&""!==n;if(!1===o&&!1===(null!=r&&""!==r)||x()&&this.hasSchool()&&s.student_account_school.code!==e.school)this.setAnonymousOrForceLogin();else{var i=m("body");t.getStudentInfo(n,r).done(function(n){if(i.close(),y&&!r&&(n.provider!==y||!D||0==D.length||n.providerID!==D&&n.providerHumanID!==D))return console.log("Logged in with incompatible credentials. Re-login."),void t.setAnonymousOrForceLogin();t.setCredentials(n,e.school),t.setState(v.ONLINE),w.resolve()}).fail(function(e){i.close(),console.log("Error getting student info -> either invalid token or wrong connection"),o&&401!==e.status?(t.setState(v.OFFLINE),w.resolve()):t.setAnonymousOrForceLogin()})}},v.loginLTI=function(){var e=m("body"),r=this;t.ajax({type:"POST",data:{lti:u.urlencode(u.getParameters()),url:window.location.protocol+"//"+window.location.host+window.location.pathname,wa:s.WA,id:s.uuid2},headers:d.getAJAXHeaders(),url:s.student_account_server+"/student/Login",timeout:1e4}).then(function(t){e.close(),l.setEmbeddedLTIAuthenticated(),r.setCredentials(t,null),r.setState(v.ONLINE),w.resolve()},function(t){e.close();try{var o=JSON.parse(t.responseText);if("noLTILicense"==o.code)return r.setState(r.ANONYMOUS),void w.reject();if(null!=o.message&&o.message.length>0)return void n.showFatalAlert(o.message,i("Error"))}catch(e){}0===t.readyState?n.showFatalAlert(i("You need an internet connection to access this widget."),i("Error")):n.showFatalAlert(i("Error signing in."),i("Error"))})},v.initialize=function(){var e=this;t(function(){if(!x())return e.setState(e.ANONYMOUS),void w.resolve();var t=f.sid;return t?(window.WidgetParams||history.replaceState("",document.title,window.location.pathname+window.location.search+u.removeQueryStringParameter(u.getHash(),"sid")),void e.initializeWithStoredCredentials({sid:t})):!l.isEmbeddedLTI()||l.isEmbeddedLTIAuthenticated()?!p&&a.isPreview()?(e.setState(e.ANONYMOUS),void w.resolve()):void e.loadCredentials().done(e.initializeWithStoredCredentials.bind(e)):void e.loginLTI()})},b.then(function(){v.initialize()}),v.logout=function(){return this.clearCredentials(),"optional"===s.support_student_account?this.setState(v.ANONYMOUS):(m("body"),window.location.reload(!1)),t.when().promise()},v.requestSignout=function(){return this.showLoginStateInfo().done(this.logout.bind(this))},v.getUserToken=function(){return c.getUserToken()},v.getUserSid=function(){return c.getUserSid()},v.getUserName=function(){return c.getUserName()},v.getUserClassName=function(){return c.getUserClassName()},v.getUserId=function(){return c.getUserId()},v.getEmail=function(){return c.getEmail()},v.getProviderId=function(){return c.getProviderId()},v.getProviderHumanId=function(){return c.getProviderHumanId()},v.isCoAccount=function(){return c.isCoAccount()},v.getState=function(){return A},v.getForceOfflineStorage=function(){return _},v.hasProperty=function(e){return"user_id"===e},v.getProperty=function(e){if("user_id"==e)return this.getUserId()}}),v}.bind(null,n(63),n(0),n(22),n(18),n(5),n(42),n(13),n(59),n(44),n(119));e.exports={bindToContext:i}},91:function(e,t,n){var r=function(e,t,n,r,o){var i=o.bwConfig,a=o.studentaccount,s=i.getConfigSync();return{init:function(o){var i=this;function u(){return a.getState()===a.ANONYMOUS?a.requestSignin():a.requestSignout()}this.studentAccountButtonUI=o;var c=function(e){var n="anonymous",r=t("Not signed in");switch(e){case a.OFFLINE:n="offline",r=t("You're offline");break;case a.ONLINE:n="online";var o=a.getUserName();-1!=o.indexOf("@")&&(o=o.substring(0,o.indexOf("@"))),r=o}i.studentAccountButtonUI.setState(n,r)};this.studentAccountButtonUI.create(function(){if(n.isPreview()){var o=a.hasSchool()?t("Students need school accounts associated with %(school)s (%(schoolCode)s) in order to sign in.").replace("%(school)s",s.student_account_school.name).replace("%(schoolCode)s",s.student_account_school.code)+"<br><br>":t("Any BookWidgets student account can be used to sign in.")+"<br><br>";r.showAlert(t("Your widget will require students to sign in.")+"<br><br>"+o+t("In widget preview mode sign in is not required / not supported."),t("Sign in not available"))}else e.pushAsyncFunc(u)}),c(a.ANONYMOUS),a.initialized().then(function(){c(a.getState()),a.registerStateChangeCallback(c)},function(){c(a.ANONYMOUS),i.studentAccountButtonUI.hide()})}}}.bind(null,n(63),n(18),n(5),n(22));e.exports={bindToContext:r}},92:function(e,t,n){var r=n(15).each,o=function(e,t,n,o){var i,a,s,u,c,l=o.bwConfig,d=o.studentaccount,f=o.studentaccountbutton,p=o.bwdsstorage,g=o.writecachingonlinestorage,h=o.StorageBusyMarker,m=o.throbber,v=o.StudentAccountButtonUI,b={},w="",y=!1,D=t.getParameters(),C=D.hasOwnProperty("teacher_id")?D.teacher_id:"",E=D.hasOwnProperty("school_id")?D.school_id:"",A=D.hasOwnProperty("course_id")?D.course_id:"",_=D.hasOwnProperty("student_class_id")&&!D.hasOwnProperty("iscid")?D.student_class_id:"",S=D.hasOwnProperty("context_id")?D.context_id:"";b.WIDGET_ANONYMOUS=0,b.WIDGET_OFFLINE=1,b.WIDGET_ONLINE=2;var k=null,x=-1,O=!1;function I(){x!==b.WIDGET_ONLINE||O||k.moveImageOnlineIfRequired().done(function(e){e&&I()})}function T(){var t=m("body"),n=e.Deferred();return h.start(),k.loadAll(function(e){h.end(),t.close(),Promise.resolve(i(e)).then(function(){I(),n.resolve()})}),n}b.stateChanged=function(t,n){if(t===x&&n===O)return console.log("Warning: setting identical storage state, ignoring"),e.when();if(x===b.WIDGET_OFFLINE&&t===b.WIDGET_ONLINE&&!0===n)return x=t,O=n,e.when();var r="no"!==l.getConfigSync().save_answers;switch(t){case b.WIDGET_ANONYMOUS:console.log("Using anonymous storage"),k=p.createWidgetStorage(s,a,c,y,"",w,r);break;case b.WIDGET_ONLINE:if(!1===n){console.log("Using online storage"),k=g.createWidgetStorage(s,a,u,c,y,d.getUserId(),w,C,E,A,null==_||""===_?d.getUserClassName()?d.getUserClassName():"":_,S);break}case b.WIDGET_OFFLINE:console.log("Using offline storage"),k=p.createWidgetStorage(s,a,c,y,d.getUserId(),w,r)}var o,f=x,m=O;return x=t,O=n,function(e,t){return-1!=e&&e+t<3}(f,t)?T():f===b.WIDGET_OFFLINE&&t===b.WIDGET_ONLINE?(o=e.Deferred(),h.start(),k.goneOnlineSync(function(e){h.end(),"CONFLICT"==e.status&&i(e.data),"OFFLINE"!==e.status&&I(),o.resolve()}),o):f===b.WIDGET_ONLINE&&t===b.WIDGET_OFFLINE||m!==O?function(){var t=e.Deferred();k.loadAll(function(e){t.resolve()})}():e.when()},b.init=function(e){var t=this;i=e.updateCallback,a=e.type,s=e.group,u=e.name,c=e.id,y=e.singleKey,w=e.extension,h.init(),d.initialized().then(function(){t.stateChanged(d.getState(),d.getForceOfflineStorage()),T(),d.registerStateChangeCallback(t.stateChanged.bind(t))},function(){t.stateChanged(d.ANONYMOUS,!0),T()});var n=!!e.hide_account;d.isStudentAccountsSupported()&&!n&&f.init(v)};var F,B=!1,P=null,N=!1;function L(e,t){var n=e||{};for(var r in t)n[r]=t[r];return n}return b.prepareStorageUpgrade=function(e){P=e},b.write=function(t){null!==k&&(null!=P&&(t=L(P,t),P=null),B?function(e){N?F=y?e:L(F,e):(F=e,N=!0)}(t):n.pushAsyncFunc(function(){return function t(n){var r=e.Deferred();return B=!0,h.start(),k.write(n,function(e){h.end(),e&&"CONFLICT"==e.status&&i(e.data),B=!1,N?(N=!1,t(F).done(function(){r.resolve()})):r.resolve()}),r}(t)}))},b.registerImage=function(t){var n=e.Deferred(),r=(new Date).getTime()+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(5);return k.writeImage(r,t).done(function(){n.resolve("bwimg:"+r)}).fail(function(){n.reject()}),n},b.clearImage=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);k.clearImage(r).done(function(){n.resolve()}).fail(function(){console.log("Could not clear image"),n.reject()})}else n.reject();return n},b.getImageUrl=function(t){var n=e.Deferred();if(0==t.indexOf("bwimg:")){var r=t.substring(6);k.readImage(r).done(function(e){n.resolve(e)}).fail(function(){n.reject("")})}else n.resolve(t);return n},b.sync=function(e){n.pushSyncFunc(e)},b.clear=function(){},b.throttlers=[],b.createThrottler=function(e){var t={cb:e,maxdelay:arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,timeout:null,flush:function(){null!=this.timeout&&(this.clear(),this.cb())},cancel:function(){null!=this.timeout&&(clearTimeout(this.timeout),this.clear())},clear:function(){this.timeout=null,h.end()},trigger:function(){var e=this;null!=this.cb&&null==this.timeout&&(h.start(),this.timeout=setTimeout(function(){e.flush()},this.maxdelay))}};return this.throttlers.push(t),t},b.cancelThrottlers=function(){r(this.throttlers,function(e){e.cancel()})},b.flushThrottlers=function(){r(this.throttlers,function(e){e.flush()})},b}.bind(null,n(0),n(13),n(63));e.exports={bindToContext:o}},93:function(e,t,n){var r=function(){return(new Date).getTime()},o=r(),i=function(e,t){var n=t.bwConfig,i=t.studentaccount,a=t.blob,s=t.dialog,u=t.tr,c=n.getConfigSync();function l(e){var t,n;s.showInfoMessage(u("Your working copy of %s was submitted by your teacher.").replace("%s",(t=new Date(e.storage_timestamp),n=window.navigator.userLanguage||window.navigator.language,new Intl.DateTimeFormat(n,{dateStyle:"full",timeStyle:"long"}).format(t))))}return{createWidgetStorage:function(t,n,d,f,p,g,h,m,v){var b={},w=null,y=null,D=-1,C=null;function E(t,n){var r=i.getUserToken();return e.ajax({type:"POST",data:t,url:n,headers:{Authorization:"BWWAAuthToken "+r},timeout:3e4,connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}}})}return b.loadAll=function(r){var o,a,b,E={"widget-id":d,"widget-type":t,"widget-name":n,"teacher-id":p,"school-id":g,"course-id":h,"class-id":m,"context-id":v};"undefined"!=typeof bwshortcode&&(E["widget-shortcode"]=bwshortcode),o=E,a=function(e){w=e.id,y=e.url,D=e.version,C=JSON.parse(e.data),e.isObserved&&s.showInfoMessage(u("Your progress on this activity will be shared with your teacher.")),e.submissionInfo&&e.submissionInfo.storage_timestamp&&l(e.submissionInfo);try{r(f?C.hasOwnProperty("DATA")?C.DATA:"":C,D)}catch(e){console.error("Error in widget load callback"),console.error(e)}},b=function(e){403===e.status?(console.log("Online  storage nog allowed in this case, use offline storage: ",e.responseText),i.setForceOfflineStorage()):(console.error("Got error reading widget data"),i.goOffline()),r(f?null:{},-1)},e.ajax({type:"GET",dataType:"json",data:o,timeout:3e4,headers:{Authorization:"BWWAAuthToken "+i.getUserToken()},url:c.student_account_server+"/widget-storage/",connectTimeout:2e3,beforeSend:function(e,t){var n=this,r=t.xhr;t.xhr=function(){var e=r();return n.connectTimeoutCB=setTimeout(function(){console.log("Connection timeout occurred !"),e.abort()},n.connectTimeout),e.onreadystatechange=function(){1==this.readyState&&clearTimeout(n.connectTimeoutCB)},e}},success:a,error:b})},b.overwrite=function(t,n){var a=f?{DATA:t}:t;!function(t,n,a,s,u,c){var l={version:a,data:JSON.stringify(s),i:1,"session-id":o,timestamp:r()},d=i.getUserToken();e.ajax({type:"PUT",contentType:"text/plain",data:JSON.stringify(l),url:n,headers:{Authorization:"BWWAAuthToken "+d},timeout:3e4,success:u,error:c})}(0,y,D,a,function(e){D=e.version,e.hasOwnProperty("url")&&(y=e.url),C=e.hasOwnProperty("data")?JSON.parse(e.data):a,n({status:"OK",data:f?C.hasOwnProperty("DATA")?C.DATA:null:C,version:D})},function(e,t,r){if(console.log("Got error putting widget data"),409==e.status){console.log("Conflict, someone wrote newer data");var o=JSON.parse(e.responseText);D=o.version,C=JSON.parse(o.data),n({status:"CONFLICT",data:f?C.hasOwnProperty("DATA")?C.DATA:null:C,version:D})}else i.goOffline(),n({status:"OFFLINE"})})},b.write=function(e,t){this.overwrite(f?e:function(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}(C,e),t)},b.writeImage=function(t,n){var r=e.Deferred();return function(e,t){return E({name:t,confirm:"1",contentType:"image/jpeg"},c.student_account_server+"/widget-storage/"+e+"/resources")}(w,t).done(function(t){(function(t,n,r){var o=new a([r],{type:"image/jpeg"});return e.ajax({url:t,data:o,processData:!1,contentType:o.type,type:"PUT"})})(t.upload_url,0,n).done(function(){var e;(e=t.confirm_url,E({},e)).done(function(){r.resolve()}).fail(function(){console.log("confirming upload failed"),r.reject()})}).fail(function(){console.log("upload resource failed"),r.reject()})}).fail(function(){console.log("getting image url failed"),r.reject()}),r},b.clearImage=function(t){return e.Deferred().resolve()},b.readImage=function(t){var n=c.student_account_server+"/widget-storage/"+w+"/resources/"+t,r=i.getUserToken(),o=e.Deferred();return e.ajax({url:n,headers:{Authorization:"BWWAAuthToken "+r},type:"GET"}).done(function(t){e.ajax({url:t.url,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()})}).fail(function(){o.reject()}),o},b.sync=function(e){e()},b}}}.bind(null,n(0));e.exports={bindToContext:i}},94:function(e,t,n){var r=function(e,t,n,r){var o=r.bwds,i=!1;function a(t){var r=n.Deferred();return o.remove(t,function(t){return null===t||t.code==e.BWDS_ERROR_UNKNOWN?r.resolve():(console.log("Remove failed: "+JSON.stringify(t)),r.reject()),r}),r}function s(r,a,s){var u=n.Deferred();return o.write(r,a,function(n){if(null===n)u.resolve();else{if(s&&!1===i){if(n.code==e.BWDS_ERROR_SECURITY){var r=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===r||"ibw-platform-ipad-ibooks"===r?window.criticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+r.getIOSIBooksRestartInfo(),"Storage error"):window.criticalAlert("Storing answers not supported on this platform.","Storage error")}else window.criticalAlert("Could not save your answer.","Storage problem");i=!0}console.log("Save failed"),u.reject()}}),u}function u(r,a){var s=n.Deferred();return o.read(r,function(n,r){if(null===n)r?s.resolve(r):(console.log("How did this happen?  No saved data on read!"),s.reject({}));else{if(a&&!1===i)if(n.code==e.BWDS_ERROR_SECURITY){var o=t.getPlatform();"ibw-platform-ipad-ibooks-epub"===o||"ibw-platform-ipad-ibooks"===o?window.criticalAlert("Unable to save your answer, please restart iBooks to solve this issue.<br>"+o.getIOSIBooksRestartInfo(),"Storage error"):window.criticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0}else n.code!=e.BWDS_ERROR_UNKNOWN&&(console.log("Error "+n.code+" occurred while loading data: "+n.message),window.criticalAlert("Storing answers not supported on this platform.","Storage error"),i=!0);s.reject({})}}),s}function c(e,t){var n=e||{};for(var r in t){var o=t[r];null===o?delete n[r]:n[r]=o}return n}return{createWidgetStorage:function(e,t,r,i,l,d,f){var p={},g=""==l?"":l+"/";function h(){return g+"books/"+e+"/"+t+"/"+r}var m={};function v(e){return h()+"/img/"+e}return p.loadAll=function(e){var t,r;i?u(h()+d,f).done(e).fail(function(){e(null)}):""!==l?u(h(),f).always(function(t){try{var n=JSON.parse(t);m=n,e(JSON.parse(t))}catch(t){console.log("Can't parse bwds user data"),console.log(t),e(m)}}):(t=h(),r=n.Deferred(),o.dir(t,function(e,t){null===e?r.resolve(t):r.reject(e)}),r).done(function(t){var r={},i=[];function a(e,t,n){o.read(e+"/"+t,function(e,o){null===e?r[t]=o:console.log("Received error reading: "+t),n.resolve()})}for(var s=0;s<t.length;++s){var u=n.Deferred();i.push(u),a(h(),t[s],u)}n.when.apply(null,i).done(function(){e(r)})}).fail(function(t){e({})})},p.write=function(e,t){if(i)null===e?a(h()+d).always(t):s(h()+d,e,f).always(t);else if(""!==l)m=c(m,e),s(h(),JSON.stringify(m),f).always(t);else{var r=[];for(var o in e){var u=e[o];null===u?r.push(a(h()+"/"+o)):r.push(s(h()+"/"+o,u,f))}n.when.apply(null,r).always(t)}},p.overwriteAndSetVersion=function(e,t){var r=n.Deferred();if(i)null===e?a(h()+d).always(function(){r.resolve()}):s(h()+d,e,f).always(function(){p.setVersion(t).always(function(){r.resolve()})});else if(""!==l){var o=JSON.stringify(e);m=JSON.parse(o),s(h(),o,f).always(function(){p.setVersion(t).always(function(){r.resolve()})})}else console.error("bwds_storage_if.overwriteAndSetVersion not implemented for this storage mode... only intended for local caching"),r.reject();return r},p.setVersion=function(e){var t=n.Deferred(),r=h();return i&&(r+=d),o.stat(r,function(n,i,a){null===n?o.setStat(r,{backup_date:i.modified,backup_version:e},function(e){null===e?t.resolve():(console.log("Problem writing stat: "+JSON.stringify(e)),t.reject())}):(console.log("Got error reading stat for "+r+": means offline mode won't work"),t.reject())}),t},p.getVersion=function(e){var t=h();i&&(t+=d),o.stat(t,function(t,n,r){null===t?e({version:n.backup_version,offlinedata:n.backup_date!=n.modified,hasdata:!0}):(console.log("Error reading stat... assume there is no data"),e({version:0,offlinedata:!1,hasdata:!1}))})},p.writeImage=function(e,t){return s(v(e),t,f)},p.clearImage=function(e){return a(v(e))},p.isImageBackedUp=function(e){var t=n.Deferred();return o.stat(v(e),function(e,n,r){null===e?t.resolve(n.backup_date==n.modified):t.reject()}),t},p.listImagesAndBackupStatus=function(){var e=n.Deferred();return o.stat(h()+"/img",function(t,n,r){if(null===t){for(var o=[],i=0;i<r.length;++i){var a=r[i].name;o.push({id:a.substring(a.lastIndexOf("/")+1),backed_up:r[i].backup_date===r[i].modified})}e.resolve(o)}else e.resolve([])}),e},p.setImageBackedUp=function(e){var t=n.Deferred();return o.stat(v(e),function(n,r,i){null===n?o.setStat(v(e),{backup_date:r.modified},function(e){null===e?t.resolve():t.reject()}):t.reject()}),t},p.readImage=function(e){return u(v(e),f)},p.sync=function(e){o.executeSync(e)},p},createInfoStorage:function(e,t,n){var r={},o={},i={};function a(e){return(""==t?"":t+"/")+"info/"+e}return u(a("BWCommon"),n).always(function(e){try{o=JSON.parse(e)}catch(e){o={}}}),u(a(e),n).always(function(e){try{i=JSON.parse(e)}catch(e){i={}}}),r.getCommonProperties=function(e){e(o)},r.getGroupProperties=function(e){e(i)},r.setCommonProperties=function(e){o=c(o,e),s(a("BWCommon"),JSON.stringify(o),n)},r.setGroupProperties=function(t){i=c(i,t),s(a(e),JSON.stringify(i),n)},r}}}.bind(null,n(47),n(5),n(0));e.exports={bindToContext:r}},95:function(e,t,n){var r=function(e,t){var n=t.studentaccount,r=t.onlinestorage,o=t.bwdsstorage;return{createWidgetStorage:function(t,i,a,s,u,c,l,d,f,p,g,h){var m={};return m.os=r.createWidgetStorage(i,a,s,u,d,f,p,g,h),m.bs=o.createWidgetStorage(t,i,s,u,n.getUserId(),l,!1),m.loadAll=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],i=e[1];-1==i?(console.log("error accessing online data, return local data or null"),n.hasdata?o.bs.loadAll(t):t(u?null:{})):!1===n.offlinedata||n.version<i?o.bs.overwriteAndSetVersion(r,i).always(function(){t(r)}):o.bs.loadAll(function(e){o.os.overwrite(e,function(n){"OFFLINE"===n.status?t(e):o.bs.setVersion(n.version).always(function(){t(e)})})})})},m.goneOnlineSync=function(t){var n=e.Deferred(),r=e.Deferred();this.os.loadAll(function(e,t){n.resolve(e,t)}),this.bs.getVersion(function(e){r.resolve(e)});var o=this;e.when(n,r).done(function(e,n){var r=e[0],i=e[1];-1==i?(console.log("goneOnlineSync: Can't find online version"),t({status:"OFFLINE"})):n.version<i?(console.log("goneOnlineSync: local version out of date, need to use online version"),o.bs.overwriteAndSetVersion(r,i).always(function(){t({status:"CONFLICT",data:r})})):!0===n.offlinedata?(console.log("goneOnlineSync: latest version is local, pushing state online"),o.bs.loadAll(function(e){o.os.overwrite(e,function(e){"OFFLINE"===e.status?t({status:"OFFLINE"}):o.bs.setVersion(e.version).always(function(){t({status:"OK"})})})})):t({status:"OK"})})},m.write=function(e,t){var n=this;n.bs.write(e,function(){n.os.write(e,function(e){void 0!==e&&e.hasOwnProperty("data")?n.bs.overwriteAndSetVersion(e.data,e.version).always(function(){t(e)}):t(e)})})},m.writeImage=function(t,n){var r=e.Deferred(),o=this;return o.bs.writeImage(t,n).done(function(){r.resolve(),o.os.writeImage(t,n).done(function(){o.bs.setImageBackedUp(t)}).fail(function(){})}).fail(function(){o.os.writeImage(t,n).done(function(){r.resolve()}).fail(function(){r.reject()})}),r},m.clearImage=function(t){var n=e.Deferred();return e.when(this.bs.clearImage(t),this.os.clearImage(t)).done(function(){n.resolve()}).fail(function(){n.reject()}),n},m.readImage=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){n.resolve(e)}).fail(function(){r.os.readImage(t).done(function(e){n.resolve(e)}).fail(function(){n.reject()})}),n},m.moveImageOnline=function(t){var n=e.Deferred(),r=this;return r.bs.readImage(t).done(function(e){r.os.writeImage(t,e).done(function(){r.bs.setImageBackedUp(t),n.resolve()}).fail(function(){n.reject()})}).fail(function(){n.reject()}),n},m.moveImageOnlineIfRequired=function(){var t=e.Deferred(),n=this;return n.bs.listImagesAndBackupStatus().done(function(e){for(var r=0;r<e.length;++r)if(!1===e[r].backed_up)return void n.moveImageOnline(e[r].id).done(function(){t.resolve(!0)}).fail(function(){t.reject()});t.resolve(!1)}),t},m},createInfoStorage:function(e,t,r){var i={};return i.bs=o.createInfoStorage(e,n.getUserId(),!1),i.getCommonProperties=function(e){this.bs.getCommonProperties(function(t){e(t)})},i.getGroupProperties=function(e){this.bs.getGroupProperties(function(t){e(t)})},i.setCommonProperties=function(e){this.bs.setCommonProperties(e)},i.setGroupProperties=function(e){this.bs.setGroupProperties(e)},i}}}.bind(null,n(0));e.exports={bindToContext:r}},96:function(e,t,n){var r,o,i;e.exports=(r=n(0),(i={}).init=function(){0===r("#storage-busy-marker").length&&r(document.createElement("div")).attr("id","storage-busy-marker").appendTo(".closebutton-container"),o=0},i.start=function(){0==o&&r("#storage-busy-marker").addClass("busy"),++o},i.end=function(){0==--o&&r("#storage-busy-marker").removeClass("busy")},i)},97:function(e,t,n){var r=n(70).addWeblinkIframe;e.exports=function(e,t,n,o,i,a){var s={},u=e.getConfigSync();function c(){var e=i.getPlatform();return!!("ibw-platform-ipad-ibooks"===e||"ibw-platform-ipad-ibooks-epub"===e||"ibw-platform-osx-ibooks"===e||"ibw-platform-osx-ibooks-epub"===e||"ibw-platform-android-chrome"===e||i.isPreview()||"ibw-platform-ipad-bookwidgets"!==e&&!1===i.isTopLevelPlay())}function l(e){for(var t=0;t<e.bw_links.length;++t){var n=e.bw_links[t];if("bw-student"===n.name)return n}return null}function d(){return u.hasOwnProperty("student_account_school")&&u.student_account_school.hasOwnProperty("code")&&null!==u.student_account_school.code&&""!==u.student_account_school.code&&"null"!==u.student_account_school.code}return s.createDialog=function(e,n){var o=t(document.createElement("div")).addClass("bw-login-dialog-wrapper"),i=t(document.createElement("div")).css({position:"absolute",width:"100%",height:"100%",left:"0px",top:"0px"}).appendTo(o),a=t(document.createElement("div")).attr("id","bw-login-dialog").addClass("bw-row-container").appendTo(o);return n&&(o.addClass("bw-centering-container"),a.addClass("bw-centered")),o.appendTo("body"),e&&i.click(function(){o.remove(),e.reject()}),{close:o.remove.bind(o),show:function(e,n){var o;a.empty(),n&&t(document.createElement("div")).addClass("login-dialog-title bw-row-fixed").safeHtml(n).appendTo(a),e.appendTo(a),(o=a).find(".weblink").each(function(){r(t(this).parent()[0],t(this).attr("href"),!0,t(this).attr("message")),t(this).attr("href","")}),o.find(".external-link").each(function(){r(this,t(this).attr("href"),!1,t(this).attr("message")),t(this).attr("href","")})}}},s.queryLoginMethod=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=t(document.createElement("div")).addClass("login-type-selection login-dialog-body");var s,u=l(e),f=null!==u;function p(){removeEventListener("message",g),i.close()}function g(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(p(),r.resolve("oauth"))}e.oauth_links.length>0&&function(n,r){n=e.oauth_links;for(var i=0;i<n.length;++i){var a=n[i],s=c()&&a.toplevel,u=s?" weblink login-type-button":" login-type-button",l=s?"_blank":"_top",d=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";t(document.createElement("div")).addClass("web-link-wrapper"+u).append(t(document.createElement("a")).attr({message:"linkclicked",href:a.url,target:l,onclick:d}).safeHtml(o("Sign in using")+" "+a.name)).appendTo(r)}}(e.oauth_links,a),f&&(d()||(s=a,t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using email and password")).tapOrClick(function(){r.resolve("bw"),p()}).appendTo(s)),function(e,n){t(document.createElement("div")).addClass("login-type-button").safeHtml(o("Sign in using school account")).tapOrClick(function(){r.resolve("school"),p()}).appendTo(n)}(0,a)),i.show(a,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",g)}).promise()},s.queryBWCredentials=function(e){var n=this;return t.Deferred(function(r){var i=n.createDialog(r,!0),a=l(e),s=t(document.createElement("div")).addClass("login-form login-dialog-body");function u(){removeEventListener("message",d),i.close()}function d(e){var t=e.data;t.hasOwnProperty("msg")&&"linkclicked"===t.msg&&(u(),r.resolve({action:"signup"}))}!function(e,n){var i=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-email",placeholder:o("Email"),tabindex:"1"}).appendTo(n),a=t(document.createElement("input")).addClass("login-dialog-field").attr({id:"bw-password",type:"password",placeholder:o("Password"),tabindex:"2"}).appendTo(n);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","3").safeHtml(o("Sign in")).tapOrClick(function(){r.resolve({action:"login",school:"",username:i.val(),password:a.val()}),u()}).appendTo(n);var s=c(),l=s?" external-link":"",d=s?"_blank":"_top",f=s?"":"setTimeout(function() { window.postMessage({ msg:'linkclicked'}, '*');}, 1000);";e.hasOwnProperty("resetPasswordURL")&&t(document.createElement("a")).attr({href:e.resetPasswordURL,target:d,onclick:f}).safeHtml(o("Forgot password?")).addClass("bw-reset-password"+l).appendTo(n),e.hasOwnProperty("registerURL")&&(t(document.createElement("hr")).appendTo(n),t(document.createElement("p")).css("position","relative").appendSafe("Don't have an account?").append(t(document.createElement("br"))).append(t(document.createElement("a")).attr({message:"linkclicked",href:e.registerURL,target:d,onclick:f}).addClass("bw-signup"+l).safeHtml(o("Sign up here"))).appendTo(n))}(a,s),i.show(s,o("Sign in")),window.postMessage({msg:"requestlogin"},"*"),addEventListener("message",d)}).promise()},s.querySchoolCredentials=function(e){var n=this;return t.Deferred(function(e){var r,i=n.createDialog(e,!0),a=t(document.createElement("div")).addClass("login-form login-dialog-body");d()||(r=t(document.createElement("input")).attr({id:"school-school",placeholder:o("School code"),tabindex:"1"}).addClass("login-dialog-field").appendTo(a));var s=t(document.createElement("input")).attr({id:"school-username",placeholder:o("Username"),tabindex:"2"}).addClass("login-dialog-field").appendTo(a),c=t(document.createElement("input")).attr({id:"school-password",type:"password",placeholder:o("Password"),tabindex:"3"}).addClass("login-dialog-field").appendTo(a);t(document.createElement("button")).addClass("login-dialog-button").attr("tabindex","4").safeHtml(o("Sign in")).tapOrClick(function(){var t=d()?u.student_account_school.code:r.val();e.resolve({action:"login",school:t,username:s.val(),password:c.val()}),i.close()}).appendTo(a),i.show(a,d()?u.student_account_school.name:o("Sign in")),window.postMessage({msg:"requestlogin"},"*")}).promise()},s.queryLogout=function(e,n,r,i){var a=this;return t.Deferred(function(s){var u=a.createDialog(s),c=t(document.createElement("div")).attr("id","offline-dialog").addClass("login-dialog-body");t(document.createElement("p")).safeHtml(n).appendTo(c),t(document.createElement("div")).attr("id","login-current-user").appendTo(c).safeHtml(r||""),i||t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Sign out")).tapOrClick(function(){u.close(),s.resolve()}).appendTo(c),u.show(c,e)}).promise()},s.showMessage=function(e,r){return t.Deferred(function(t){n.showAlert(e,r,o("OK"),function(){t.resolve()})})},s.createPollingUI=function(e){var n=this.createDialog(null,!0),r=t(document.createElement("div")).addClass("login-pollingdialog");return t(document.createElement("p")).safeHtml(o("Waiting for account sign in to complete...")).appendTo(r),t(document.createElement("div")).addClass("login-dialog-button").safeHtml(o("Cancel")).tapOrClick(e).appendTo(r),n.show(r,o("Waiting")),n},s}(n(21),n(0),n(22),n(18),n(5),n(42))},98:function(e,t){e.exports=window.Blob},99:function(e,t,n){var r=n(4).getDateString,o=n(15).pick,i=function(e,t,n,i,a,s){var u=s.bwConfig,c=s.studentinfo,l=s.tr,d=u.getConfigSync(),f=i.getParameters();function p(e){return!e||0===e.length}function g(t){return t.indexOf("bookwidgets.com")>=0||t.indexOf("localhost")>=0?{"Bookwidgets-Platform":e.getPlatform()}:{}}function h(){return f.teacher_id}function m(){return f.school_id}function v(){return f.hasOwnProperty("wv")}return{createStudentWorkSubmitter:function(s,u,b,w){var y={FLD_STUDENT_NAME:"#student",FLD_STUDENT_ACCOUNT:"#student_account",FLD_STUDENT_EMAIL:"#student_email",FLD_STUDENT_ID:"#student_id",FLD_STUDENT_CLASS_ID:"#student_class_id",FLD_TEACHER_EMAIL:"#email",FLD_YOUR_NAME:"#you",FLD_YOUR_EMAIL:"#your_email",FLD_TO_EMAIL:"#to_email"},D={};D[y.FLD_STUDENT_NAME]="student_name",D[y.FLD_STUDENT_EMAIL]="student_email",D[y.FLD_STUDENT_ID]="student_id",D[y.FLD_STUDENT_CLASS_ID]="student_class_id",D[y.FLD_TEACHER_EMAIL]="teacher_email",D[y.FLD_YOUR_NAME]="student_name",D[y.FLD_YOUR_EMAIL]="student_email",D[y.FLD_TO_EMAIL]="to_email";var C=h(),E=m();y._postdata={test_name:s,uuid2:b,WA:w,book_title:u,submit_timestamp:(new Date).toISOString(),submit_date:r(),tzoffset:(new Date).getTimezoneOffset()/60*-1,include_grading:!0,submitted_via_shortcode:window.bwshortcode,answers:[]},"wv"in f&&(y._postdata.wv=f.wv),y._extradata={},y._answersComposer=void 0,y._assetUploadAgenda=[],y._eventCallbacks={},y._lastServerResponse="",y._lastServerData=null,y._leftButtons=[],y._rightButtons=[],y._dialogOptions={},y._endpoint="",y._fieldSettings={},y.setCompanyInfo=function(e,t,n,r){y._postdata.company_name=e,y._postdata.company_address=t,y._postdata.company_phone=n,y._postdata.company_website=r},y.setIncludeGrading=function(e){y._postdata.include_grading=e?"yes":"no"},y.setElapsedTime=function(e){y._postdata.time=e},y.setEndpoint=function(e){y._endpoint=e},y._storeField=function(e,t){var n=y._fieldSettings[e].isVisible,r=y._fieldSettings[e].isEditable;if(n&&r){var o=D[e];c.set(o,t)}},y._setStudentInfo=function(e,t,n,r){y._postdata.student_name=e,y._postdata.student_id=t,y._postdata.student_email=n,y._postdata.student_class_id=r,c.hasStudentAccount()&&(y._postdata.student_userid=c.getStudentAccountUserId(),y._postdata.student_name=c.getStudentAccountUserName(),y._postdata.student_email=c.getStudentAccountEmail(),y._postdata.student_id=c.getStudentAccountProviderHumanId(),y._postdata.student_token=c.getStudentAccountToken());var o=f.context_id;o&&(y._postdata.context_id=o),C&&(y._postdata.teacher_id=C),f.course_id&&(y._postdata.course_id=f.course_id),E&&(y._postdata.school_id=E),y._storeField(y.FLD_STUDENT_NAME,e),y._storeField(y.FLD_STUDENT_ID,t),y._storeField(y.FLD_STUDENT_EMAIL,n),y._storeField(y.FLD_STUDENT_CLASS_ID,r)},y._setTeacherEmail=function(e){y._postdata.teacher_email=e,y._storeField(y.FLD_TEACHER_EMAIL,e)},y._setShareInfo=function(e,t,n,r){y._postdata.student_name=e,y._postdata.student_email=t,y._postdata.to_email=n,y._postdata.message=r,y._storeField(y.FLD_YOUR_NAME,e),y._storeField(y.FLD_YOUR_EMAIL,t),y._storeField(y.FLD_TO_EMAIL,n)},y._setDownloadInfo=function(e,t,n,r){y._postdata.student_name=e,y._storeField(y.FLD_YOUR_NAME,e)},y.setAnswersComposer=function(e){y._answersComposer=e},y.addExtraData=function(e){for(var t in e)y._extradata[t]=e[t]},y.scheduleAssetUpload=function(e,t,n){y._assetUploadAgenda.push({assetFetcherCB:e,assetUploadCompleteCB:t,userdata:n})},y.configureFormField=function(e,t,n,r){y._fieldSettings[e]={isVisible:t,isEditable:n,defaultValue:r}},y.configureFormField(y.FLD_STUDENT_ACCOUNT,!0===c.hasStudentAccount(),!1,c.getStudentAccountUserName()||""),y.configureFormField(y.FLD_STUDENT_NAME,!1===c.hasStudentAccount()&&"yes"==d.student_name_isVisible,"yes"==d.student_name_isEditable,d.student_name_defaultValue),y.configureFormField(y.FLD_STUDENT_EMAIL,!1===c.hasStudentAccount()&&"yes"==d.student_email_isVisible,"yes"==d.student_email_isEditable,d.student_email_defaultValue),y.configureFormField(y.FLD_STUDENT_ID,!1===c.hasStudentAccount()&&"yes"==d.student_id_isVisible,"yes"==d.student_id_isEditable,d.student_id_defaultValue);var A=p(f.student_class_id)?p(c.getStudentAccountClassName())?void 0:c.getStudentAccountClassName():f.student_class_id,_="yes"==d.student_class_id_isEditable&&!A;function S(e,n,r,o){var i,a=t(document.createElement("label"));a.attr("for",n),a.attr("id",n+"_label"),a.text(e),o.append(a),"textarea"==r?(i=t(document.createElement("textarea"))).attr("rows",5):((i=t(document.createElement("input"))).attr("type",r),i.on("focus",function(){this.value=this.value})),i.attr("name",n),i.attr("id",n),i.attr("value",""),o.append(i)}function k(e){return e.split(",").length>1}function x(t,n){var r={content:"",ibw_platform:e.getPlatform()};for(var o in y._extradata)r[o]=y._extradata[o];void 0===y._submitPreparer&&(y._submitPreparer=function(e){e()}),y.showProgressDialog(n),setTimeout(function(){y._submitPreparer(function(){y.uploadAssets(function(){console.log("All assets uploaded, now sending answers"),y.composeAllAnswers(),r.content=JSON.stringify(y._postdata),t(r),y.trigger(y.EVT_AFTER_SEND),console.log("Submit complete")},function(){console.log("Asset upload failed, aborting"),y.closeProgressDialog(),y.trigger(y.EVT_SUBMIT_FAILED),y.trigger(y.EVT_AFTER_SEND)})},function(e){console.log("Aborted by client: "+e),y.closeProgressDialog(),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED),y.trigger(y.EVT_AFTER_SEND)})},100)}function O(){x(y.sendResults.bind(y),l("Sending, please wait..."))}function I(){var e=t(this),r=e.find("#student").val(),o=e.find("#student_id").val(),i=e.find("#student_email").val(),a=e.find("#student_class_id").val(),s=e.find("#email").val();if(!1!==c.hasStudentAccount()||""!==r){if(!C){if(!(null!=s&&""!==s||"yes"===d.teacher_email_isVisible&&"yes"===d.teacher_email_isEditable||!1!==v()))return void n.showAlert(l("This field is required:")+" "+l("Teacher Email"),l("Send Failed"));if(k(s))return void n.showAlert(l("You can't specify multiple addresses for field:")+" "+l("Teacher Email"),l("Send Failed"))}e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setStudentInfo(r,o,i,a),y._setTeacherEmail(s),O()}else n.showAlert(l("This field is required:")+" "+l("Student Name"),l("Send Failed"))}function T(){var e=t(this),r=e.find("#you").val(),o=e.find("#your_email").val(),i=e.find("#to_email").val(),a=e.find("#message").val();""!==r?""!==i?(e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setShareInfo(r,o,i,a),O()):n.showAlert(l("This field is required:")+" "+l("To Email"),l("Send Failed")):n.showAlert(l("This field is required:")+" "+l("Your Name"),l("Send Failed"))}function F(){var e=t(this),r=e.find("#you").val();""!==r?(e.dialog("close"),e.remove(),y.trigger(y.EVT_BEFORE_SEND),y._setDownloadInfo(r),x(y.generate.bind(y),l("Generating PDF, please wait..."))):n.showAlert(l("This field is required:")+" "+l("Your Name"),l("Download Failed"))}return y.configureFormField(y.FLD_STUDENT_CLASS_ID,"yes"==d.student_class_id_isVisible,_,p(A)?p(d.student_class_id_defaultValue)?"":d.student_class_id_defaultValue:A),y.configureFormField(y.FLD_TEACHER_EMAIL,"yes"==d.teacher_email_isVisible&&!C&&!E,"yes"==d.teacher_email_isEditable,C||d.teacher_email_defaultValue),y.configureFormField(y.FLD_YOUR_NAME,!0,!0,""),y.configureFormField(y.FLD_YOUR_EMAIL,!0,!0,""),y.configureFormField(y.FLD_TO_EMAIL,!0,!0,""),y.addButtonBeforeDefaultButtons=function(e,t){y._leftButtons.push({text:e,click:t})},y.addButtonAfterDefaultButtons=function(e,t){y._rightButtons.push({text:e,click:t})},y.addDialogOptions=function(e){for(var t in e)y._dialogOptions[t]=e[t]},y.setAsyncSubmitPreparer=function(e){y._submitPreparer=e},y.EVT_BEFORE_SHOW="beforeShow",y.EVT_BEFORE_SEND="beforeSend",y.EVT_AFTER_SEND="afterSend",y.EVT_SUBMIT_SUCCEEDED="submitSucceeded",y.EVT_SUBMIT_FAILED="submitFailed",y.on=function(e,t){y._eventCallbacks[e]?y._eventCallbacks[e].push(t):(y._eventCallbacks[e]=[],y._eventCallbacks[e].push(t))},y.trigger=function(e){if(y._eventCallbacks[e])for(var t=0;t<y._eventCallbacks[e].length;++t)y._eventCallbacks[e][t]()},y._applyFormFieldSettings=function(e){if(0!=(a=t(e)).length){var n=t(e+"_label"),r=y._fieldSettings[e].isVisible,o=y._fieldSettings[e].isEditable,i=y._fieldSettings[e].defaultValue;k(i)&&(r&&o?function(e,n){for(var r=t(e),o=t(document.createElement("select")).attr({id:r.attr("id"),name:r.attr("name")}),i=0;i<n.length;++i)t(document.createElement("option")).safeHtml(n[i]).appendTo(o);r.replaceWith(o),r.remove()}(e,function(e){for(var t=e.split(","),n=[],r=0;r<t.length;++r)n.push(t[r].trim());return n}(i)):i=i.split(",")[0]);var a=t(e);if(n=t(e+"_label"),!1===r&&(a.hide(),n.hide()),!1===o&&a.attr("disabled","true"),a.val(i),r&&o){var s=D[e];c.get(s,function(e){null!=e&&""!==e&&a.val(e)})}}},y.showSendDialog=function(e,r){c.initialized().done(function(){if(c.isCoAccount())n.showAlert(l("Submit is disabled because you're not logged in with a student account. e.g. a parent account."),l("Can't submit"));else{var o=function(){t("#student-work-submitter-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-submitter-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-submitter-dialog-info"),e.append(n),S("","student_account","text",e),S(l("Student Name"),"student","text",e),S(l("Student ID"),"student_id","text",e),S(l("Student Email"),"student_email","email",e),S(l("Class ID"),"student_class_id","text",e),S(l("Teacher Email"),"email","email",e),t("body").append(e),e}(),s=!1;for(var u in y._fieldSettings)y._applyFormFieldSettings(u),s=s||y._fieldSettings[u].isVisible&&y._fieldSettings[u].isEditable&&t(u).length>0;e?(t("#student-work-submitter-dialog-info").safeHtml(e),t("#student-work-submitter-dialog-info").removeClass("hidden")):t("#student-work-submitter-dialog-info").addClass("hidden");for(var d=[],f=0;f<y._leftButtons.length;++f)d.push(y._leftButtons[f]);for(d.push({text:l("Send"),click:I}),f=0;f<y._rightButtons.length;++f)d.push(y._rightButtons[f]);var p={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:l("Send Answer"),width:Math.min(450,.9*t(window).width())+"px",buttons:d};for(var g in y._dialogOptions)p[g]=y._dialogOptions[g];o.dialog(p);var h=i.getParameters(!1).toplevel;s||1!==d.length||!r||!a.isLTI()||h||I.call(o)}})},y.showShareDialog=function(e){console.log("showShare"),c.initialized().done(function(){var n=function(){t("#student-work-share-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-share-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-share-dialog-info"),e.append(n),S(l("Your Name"),"you","text",e),S(l("Your Email"),"your_email","email",e),S(l("To Email"),"to_email","email",e),S(l("Optional Message"),"message","textarea",e),t("body").append(e),e}();for(var r in y._fieldSettings)y._applyFormFieldSettings(r);e?(t("#student-work-share-dialog-info").safeHtml(e),t("#student-work-share-dialog-info").removeClass("hidden")):t("#student-work-share-dialog-info").addClass("hidden");for(var o=[],i=0;i<y._leftButtons.length;++i)o.push(y._leftButtons[i]);for(o.push({text:l("Send"),click:T}),i=0;i<y._rightButtons.length;++i)o.push(y._rightButtons[i]);var a={dialogClass:"bw-dialog bw-student-work-submitter",modal:!0,title:l("Share"),width:Math.min(450,.9*t(window).width())+"px",buttons:o};for(var s in y._dialogOptions)a[s]=y._dialogOptions[s];n.dialog(a)})},y.showDownloadDialog=function(e){console.log("showDownload"),c.initialized().done(function(){var n=function(){t("#student-work-download-dialog").remove();var e=t(document.createElement("div"));e.attr("id","student-work-download-dialog"),e.css("display","none");var n=t(document.createElement("div"));return n.attr("id","student-work-download-dialog-info"),e.append(n),S(l("Your Name"),"you","text",e),t("body").append(e),e}();for(var r in y._fieldSettings)y._applyFormFieldSettings(r);e?(t("#student-work-download-dialog-info").safeHtml(e+"<br>"),t("#student-work-download-dialog-info").removeClass("hidden")):t("#student-work-download-dialog-info").addClass("hidden");for(var o=[],i=0;i<y._leftButtons.length;++i)o.push(y._leftButtons[i]);for(o.push({text:l("Generate"),click:F}),i=0;i<y._rightButtons.length;++i)o.push(y._rightButtons[i]);var a={dialogClass:"bw-student-work-submitter",modal:!0,title:l("Download as PDF"),width:Math.min(450,.9*t(window).width())+"px",buttons:o};for(var s in y._dialogOptions)a[s]=y._dialogOptions[s];n.dialog(a)})},y.showProgressDialog=function(e){(function(){var e="student-work-submitter-progress-dialog";t("#"+e).remove();var n=t(document.createElement("div"));n.attr("id",e),n.css("display","none");var r=t(document.createElement("div"));r.addClass("spinner"),n.append(r);var o=t(document.createElement("div"));return o.addClass("progress-message"),o.text(l("Uploading your answers...")),n.append(o),t("body").append(n),n})().dialog({modal:!0,dialogClass:"no-close bw-dialog",title:e})},y.updateProgressMessage=function(e){t(".progress-message").text(e)},y.closeProgressDialog=function(){t("#student-work-submitter-progress-dialog").remove()},y.uploadAssets=function(e,t){var n=y._assetUploadAgenda,r=null,o=0,i=n.length;(r=function(){if(n.length>0){var a=n.shift(),s=a.assetFetcherCB(a.userdata);console.log("Uploading",s),++o,s?(y.updateProgressMessage(("audio/mpeg"===s.mimetype?l("Uploading audio"):l("Uploading image"))+" "+o+" / "+i),y.sendAsset(s,function(e){a.assetUploadCompleteCB(e,a.userdata),r()},function(){y._lastServerResponse=void 0,t()})):r()}else y.updateProgressMessage(l("Uploading your answers...")),e()})()},y.sendAssetAjax=function(e,n,r){var o={content:JSON.stringify({is_asset:!0,asset_data:e.data,asset_mimetype:e.mimetype})};for(var i in y._extradata)o[i]=y._extradata[i];t.ajax({type:"POST",headers:g(y._endpoint),url:y._endpoint,data:o,success:function(e){n(e)},error:function(){r()}})},y.genRandomString=function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t},y.sendAsset=y.sendAssetAjax,y.composeAllAnswers=function(){y._postdata.answers=y._answersComposer()},y.sendAudioPacket=function(e,n,r,o,i){var a=y._endpoint+".m4a?t="+e+"&d="+n+"&p="+r,s=new Audio;t(s).on("loadedmetadata",function(){var e=Math.floor(10*t(this)[0].duration);o(e)}),t(s).on("error",function(){console.log("Audio package load failure: "+s.error.code),i("Network or server problem")}),s.src=a},y.getPacket=function(e){for(var t=0,n=e.length,r=0,o="",i="";;){var a=n-t;if(0===a)break;var s=e.substr(t,100),u=encodeURIComponent(s),c=u.length;if(r+c>1900){i=e.substr(t);break}t+=a<100?a:100,o+=u,r+=c}return{packet:o,remaining:i}},y.sendAudio=function(e,t,n,r,o){void 0===r&&(r=y.genRandomString(20)),void 0===o&&(o=1);var i,a=y.getPacket(e);""===a.remaining?(i=t,o=0):i=function(e,t,n){return function(i){0===i?y.sendAudio(e,t,n,r,o+1):n("Wrong server response")}}(a.remaining,t,n),y.sendAudioPacket(r,a.packet,o,i,n)},y.sendResultsAudio=function(e){y.sendAudio(JSON.stringify(e),function(e){switch(console.log("sendAudio success handler called"),y.closeProgressDialog(),e){case 0:console.error("Oops, server expected another packet..."),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED);break;case 1:console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED);break;case 2:console.error("Network or server error"),y._lastServerResponse="NEWUSER",y.trigger(y.EVT_SUBMIT_FAILED);break;case 3:console.error("Network or server error"),y._lastServerResponse="USERNOTACTIVE",y.trigger(y.EVT_SUBMIT_FAILED);break;case 4:console.error("Network or server error"),y._lastServerResponse="INVALIDUSER",y.trigger(y.EVT_SUBMIT_FAILED);break;case 5:console.error("Network or server error"),y._lastServerResponse="STUDENTNOTAUTHORIZED",y.trigger(y.EVT_SUBMIT_FAILED);break;default:console.error("Unexpected server return value"),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED)}},function(e){console.error("sendAudio error handler called: "+e),y.closeProgressDialog(),y._lastServerResponse=void 0,y.trigger(y.EVT_SUBMIT_FAILED)})},y.sendResultsAjax=function(e){e.accept_json_response=!0,d.hasOwnProperty("widget_language")&&""!=d.widget_language&&(e.lang=d.widget_language),t.ajax({type:"POST",headers:g(y._endpoint),url:y._endpoint,data:e,success:function(e,t,n){console.log("Submit OK"),y.closeProgressDialog();var r=n.getResponseHeader("Content-Type");switch(y._lastServerResponse=e,y._lastServerMessage=null,y._lastServerData=null,r){case"application/json":e.hasOwnProperty("status")&&"OK"===e.status?(console.log("That's a success!"),y._lastServerData=o(e,["data","messages"]),y.trigger(y.EVT_SUBMIT_SUCCEEDED)):e.hasOwnProperty("code")?(console.log("That's a failure!",e),y._lastServerResponse=e.code,y._lastServerMessage=e.message,y.trigger(y.EVT_SUBMIT_FAILED)):(console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED));break;case"text/html":console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED);break;default:"OK"==e?(console.log("That's a success!"),y.trigger(y.EVT_SUBMIT_SUCCEEDED)):(console.log("That's a failure!"),y.trigger(y.EVT_SUBMIT_FAILED))}},error:function(e){console.error("AJAX error handler called");try{var t=JSON.parse(e.responseText);y._lastServerResponse=null,y._lastServerData=null,y._lastServerMessage=t.message}catch(e){console.error("Error msg not json"),y._lastServerResponse=void 0}y.closeProgressDialog(),y.trigger(y.EVT_SUBMIT_FAILED)}})},y.generate=function(e){t.ajax({type:"POST",headers:g(y._endpoint),url:y._endpoint,data:e,success:function(e,r,o){var i,a,s;console.log("AJAX success handler called"),y.closeProgressDialog(),"application/json"==o.getResponseHeader("Content-Type")?(console.log("That's a success!"),y._lastServerResponse=e,i=e.url,a=e.filename,s=t(document.createElement("div")).append(t(document.createElement("a")).attr({href:i,download:a}).safeHtml(l("Click here to download your PDF"))),n.showAlert(s.html(),l("PDF generated"))):(console.log("That's a failure!"),y._lastServerResponse=e,n.showAlert(l("Could not generate PDF.  Please try again later."),l("Generate PDF failed")))},error:function(){console.log("AJAX error handler called"),y.closeProgressDialog(),y._lastServerResponse=void 0,n.showAlert(l("Could not generate PDF.  Please try again later."),l("Generate PDF failed"))}})},y.sendResults="ibw-platform-ipad-ibooks-epub"==e.getPlatform()?y.sendResultsAudio:y.sendResultsAjax,y.getLastServerResponse=function(){return y._lastServerResponse},y.getLastServerMessage=function(){return y._lastServerMessage},y.getLastServerData=function(){return y._lastServerData},y.afterSubmitFailed=function(e,t){var r="",o=this.getLastServerResponse();if(o)if(r=e+"<br><br>","NEWUSER"===o)r+=l("The email address you provided has not been registered.")+"<br><br>",r+=l("To prevent abuse, results can only be sent to registered email addresses.")+" ",r+=l("Activate by clicking on the link in the email which was sent to the address provided.")+" ",r+=l("You can also register at www.bookwidgets.com.")+"<br>";else if("USERNOTACTIVE"===o)r+=l("The email address you provided has not been activated.")+"<br><br>",r+=l("To prevent abuse, results can only be sent to registered email addresses.")+" ",r+=l("Activate by clicking on the link in the email which was sent to the address provided.")+" ",r+=l("You can also register at www.bookwidgets.com.")+"<br>";else if("INVALIDUSER"===o)r+=l("Invalid user name")+"<br>";else{var i;r+=(i=this.getLastServerMessage())?i+"<br>":l("Unknown error")+"<br>"}else(i=this.getLastServerMessage())?r+=i+"<br>":r=t;n.showAlert(r,l("Send Failed"))},y},isTeacherEmailRequired:function(){return!h()&&!m()&&!v()}}}.bind(null,n(5),n(0),n(22),n(13),n(44));e.exports={bindToContext:i}}});